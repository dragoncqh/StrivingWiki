<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"760ac5b2c2c9d86973eb06d3f6a1345daf3d3d2448fa14e2827d2ea049cf650241918971f0b885e7a4d548e921f9f6f5c8662b6d2e5c371ea4c83c6b335a443b3f9a66a679e89a6008120dc3e40d9f2cc1107faa0f85d05f6b79513c906c06a8ad6f6c5bbe6550d4f34159492b8fd79fff43d38537750c9fcc1e68ef659afe2a3f42a916d2754a41c71cccd5b4561ddfc204a7ba27d7680a94bd6e42988d4968751a64c426a7ed009179bc0938d13ebbf6cbc136cb59a2c08ecfded5e67a7fad3b45d68ea9ea9b47e3c19e6525fca5d3bb62070d7d8aba6ef5f26ad9bad562bbf3769df7d2f77d19cef2a3cf70764d7ee356f95cfffe75773e4bd56cf1e4eb4b442fc4cf5fd7627526dba73c14095a85dadc091c64c1d284a70a08c6710c43c8a52688758f24e4be935aed9bc469cbb592fb4e66a776d4fc652cee1b30781b87431697f00e23600d604666cfa32c6446306fe447cb04ffc6f799d91f9cdfce958a67b82242200eac9d332f3b3b8a1421dfa6de2441607f602efb02c76a624764133e3a3f7f5fb6b869005dfb331fc206b7b487267e854dac8a3e7ccf99ccb0daf898f0b59bb884a4dc02ebdcd96dcfa9e8bf7760b8cfa380a957b8b4cc132e53d8da0fb7a2d2913ae28168e06d10c4d14a4cacdf058c5e3ced34985488e2cf8e56acde3348dc2f5609358f850c65804ec15df908044072a47bcb8df72ff7ff3e87b40a7daa9b75f488b7efeda72d93209350ac487ccb8726ec58ed55c98e613659f17c7e93655bd3e3620318fb6cdc95292e1073ec088f61416bbabfc8af0aad793d9059651a415ef49a5cb862616e894811cbe1fc63c540ae2be3d4f4e4ce1abec27a24cc8f9752e72323ba25699f51cfd4a86040744bc629a2c65e2efc321f53c5d36816843256e12bfac899f023708fafeb627a2a91fdf35a1b119fc80b90a46e3f38160f06a3d2ff09c8227218d0f89c00003fec2a91507aa46e110044077fa58e460e3165da57cb3e077f251902efca4cc78a5851c8d7ce4c7a1bd5813b08322ddec82de73bff25f668d7c083bad01795a79e0528ae927a3fa52ed001e3b0de82ad2f03e828bb1bb62581b3db0b03b150b13e356171751f916bcb587a268805d809377d3479685e245c018b62d60d27324eed07fdb2351142f4ce50b77fc90536f6d2793ce217da9a9819a49ca3c60277103b7945079939fba77bcd5efddf072331ccca5e179f5dbf43f48d7d44f6274e697be8cafdbf7872fd81c385f5b599574371e87018e9bc6410b330943ead22609bd3f5503856a96f0577db29d66f4ed76300a6599ec379128ebbd8fb7525634cf25e1a4a4f0b1f9da6c527f3a8c70c77149e7037fd06f0715107c33e9819acd7fed10476630769f55484f06ec0ddb4fe90127307472be826fd64527bf848609453cb583d6ccc9046574c0eee5b58a4029dad03ca913f634093e2ef9e36bfaa596d2b92acea3c4fd065fbe4434bf34e84dc76b44dddfea6344a4c9f3ca1657e0f07b240b69346b65bc8ea920c7948376eb34d21a210319a3a0e89e73fd6a150f30d165c91864f0b103b92f4837aa2feb2207fe1ebabe906b88f59a57510a80b39974b8533ff25ba7e2b899f416dee7a9394be407139ad7a50dd4885d5126c63e6aeb3e59ae7b6b4b206018bab85cd505a81441d8658577f32ec8209255f871dd93fa7fe179b60f198a1c5fca4048ab7d4b0a5b8e5f903b0c9388c84e4412ef4ff5223d4c5e3d31b46dc7a474a562e1766f45b610f0f70650494d28f23aff5b11bfb8a9fddea1279b2803fd19a5bbc8a6438e3528ad6eb71590e518588943f448d984c5c4a8e764bdf1e553b4ad19ffcbcd4b9b02e2ef16d6601d68f181babbcfc0bcd7d2966b0e4dbf7a3c54aeb95070d538b69ed8866da66f68ca4f394692ea5ad5f2cf5aa1bef46eb9a5733af9a918dfb4100c374807706be963c83e6887c3dfe05ef2a02cd8c967ac48583c563709c57016239a52e71fe2d13f044b0565e64ec6b90167c4946fdff953dd1ebc9e602fcd4994d01039087179da02cf88b0d87034e8035372108761575c23273a341fe0abc4593f135535f50ad48609d53b2deeb83e15d715f4bd3a40424f89ed781befbda7aa4a84f99755c9c8593a39a626baa0064aae7acd33437477cb3177ea9dd3d7367a288dc26b64ac9c0e40fb3534d3775d1d736228588f0443dc4a08b2c2568fdf628d2be658c7abff95689fb749034d673b18031b405528c3fb1dd1e6556953afd0ef6bc6edf955615986042bde6f7628f5be88cad8cfa479ebf9277b4f8cb913e443379d63577af08bd0c0cd6d6137c00679fa53e964de6248215177a468a1cce725b5ffd04aac1220132d5d171f81c325946dc770d9a449b03f1370ec4b029ee0eb385b42a532a20b0f4d5b6e2d8a26eab5e1a267916055eaae163ab97ce454e88b8934035cf600b3e56f8267db50cae1507867c516cb078fc596090f6b8836abf7efa5b3841d39fc7728700819657100d223ae973280df2781fb048c8b11b12d94be6bbb406c74a874f235bfef55e8ed446bc8388bc6e441e5e368181f981e5d870d50eedd9b10abd574535c3e494564da7e798f3b98d6f3a2a47197c97951b543d346bb9c3a42ecc8160770a317f2d72bf617baf0dda2fa55b654ceb489cb0d57b25e6bfe3c58917dd2d67cb09edd0755bad47eda41e1c060d000b01ca456bcd7cbc74fdceccf6bdebf0cafa409c1b779c2500f3ffbfe10133339fb888329a424b82062968477f027d1645d46ca7794834fd489af5a0ebcc7ad4131382378f3f45f5d37be904f59c9c6e1524022c4acbe1cdbf4b778a14b3ffec7540148ad3cba4e36815cc0e17f7c1d66d2866908413300942af572e5ec5b727429c5550e3168a45219aa8757c51de1f56443f3bf93de8b740550a274ed5aa38e13bbfc5f36811040bff367a0e19fb43250a90a5ad7eb465225d2afa332dfece9c53b88dd165b283f3cd7fd53d370dc7feb49f5b0085e802c73fca8e88daf2a597525cb5e3268d93212a0db260daf900145a3da6ac9478ea1ace530cead0e51fa9d10b7a50bb7471e2199f32182e40e5705a0205e6c58915198f89387c81d056c1af947b1d15e463965fec6b11f9d66e0cdc7a1cf299e5e35c6d4d8a2d403d18bb99ec962a0756e323aab811708948509df080138e73b6509ada6476da32ff6609fef02f0788a672b8ce729c95f716c6f9adcefb9e3c281db4e534126ec002a175b2998ae376b66c934aaaffcf2ef15a4535e94cd3bcfe77f44d349019dbb2f89b4b734fc93a5f3b093da36e7a6e768f55835bc9a2f9a95269723250ebd7605f9f50af188bb27d3600eb4ddeb29f81e6416c1bb67b6034895de9dd21baeea7ba98078931e59e7d44b5e1b3e1f362a93df1b37a8a6790a8bc1d4ab0ff35e8b34e03a0284c9ab3440a4b2d22eb5762e53df2e90ae5aeeb9bd4f081efe5ad14ca0441d3aa31956158cef0259bbd8f5717251f2d73d7870620cea851f1c614727e4ca4c3797b54a3a607691e1e31e58335a2131a801946d3825abab518e9c380494aa9df5e14bcca87ab5e2f18b625258d65918419882822e0d5814073f31650caba7e5473a1eb2c3f802b7412fb9d1233741b5cfc6394c710acfa5b941608b414ffd08b037c9cb37c567fced51aba1ad21bdc9fc47e1502c9d49c06152fa7e4c2729658ee5994df6cd1e22c66c57079d484c9a5ee84f90b282d95bb8ba07ffc3efa429bb74e1ee2e6f0d50ba580b6065c95229a9c638ab74321b691f630d8aab05be9d3f9531f040f3f4c3e96c5917490cb05a9dbfe8547b1d10e37046cd5699aea5f1acf53bba7f17a90dbef25d60751331a51347de6c6539557655741e504faa79d9d9093a3c7416b9df74f1fe01be671dac46a10c3126d24bdbb62cc6a97015d2362d20eb144ed1bef98652e92e212b5e038456d72284151e6829426d585f0d51a359e1d4470b6f32332b6fda755e04677f0fb65918e01b9d1cb5ebab19793e8b4eb15c470a946460d5f0ae5166aa562e55e4af0201f474f15c5f79c3a4e2e55bf9c731985f0f4c3dda8555a2d9c8ecaa04a8b672edda8f0e82c7e840d9c7dba1ba7b0a6b457aab9749be7b6f571fd0b2ab71f1276fcad0d5b8ad5d4c33bceb250b4404747856984408fe6dc8db08f0f3598df2cabec1272f22243f91492fb7c527c01723629a855034152418d000f7393636d3a986ddc55772d77fd4cae63bfe64763aa1fda3173920b8fe622da68fb3ce43d3068f6f6a8d3f515da0ecf5d0293ffa22776cf09d486575cf141b2b9661dff0fff417b20a4ca6f2f4cdb8923e597d0d10c045dae2eefd511b46ee8e6b99457f69da352ee4223a2ef20e7ea33f11259ffe2b3030c61e879dad7d07ef227d3b0390bdd6115c9ae1d25c6ad0dff1648ef8ebd6000c05f0e7d3255b3b7555693f5735505ae86c7ad95570a3cb039ef0a488bcf63f7596064b18553a1d6f13b853a2fdd3067fce8b02b0f97b6036f3d3d2b17a6f254c32267d3aa8255c07655dd47288d1620583cd53ed619e5e08221240a35d9118723b2137f57bf5143437e7a9cd8d5489cfa9dbd126c8f714942035294ceca336eccae03dc9fad532686a22a6e80e8092444c891074f40c7b64f58ba8a147642eded7b38d64335f485fa157b30e583c944a7a67f1556bc18cc2c614afa7b321318a5f00f26563ded94b9287601c62cf71dfb9ddc6d8216d223b0ab984a7345d6262b34af3d54dee22b2af0a20cbd0bcd685dd1284a9a465d51de5698f09786e609bce346533de77cedd8740c0015959e065238d1b82a0e3ab01413634ebcf2c088844421d1330a8e3f7d1bc2eaf3b1e2a406ebcdc9607c4cf334dfecb3d12d0fd13c43f002d271e74358b3a0cc08fd765e273e82e818517e825d45d2e4e080af2ea8d11642aa2764d3690e437d2fd55338e82c639094979fc6cf798abef494d63b13d7a141b18f42d533aef7d0d91b008d603d24ee7eb068aff11806e461a035d869732d736a2236c81e6cf371e88c6a74181b3dd1adaf8919704e91f8ecc5b8bd2cb3e77647671424fd07dba9423de0e5b0764de8196d0649dde91ceb4b4d4eb2a0a1308f4b450bcabf1abfb4843785b1e1b482df8b89138007f413961fcb2c3cd669da94660b3082b2b34ad9c9ad8a0369ad5b40d1796cb5646b85800da7cb3f339f4ac658af910235c836f1cc9b80bb08616d013a3945a305654ca1fa0cc7da62e17961ef36c64e10ddf08fdfeb2dd90e4415c4a71ba10cb15db7b46b388b27717f51b671ec0c72d601a0a5134bd82058e26c1996b843a15a30fd2c99cdaa7489553082154e6abb3f22d079d05fa06a424bba5a9d541e584dee1a177ffd6fc7e0b9eb3267826f1bf2ae6c873c4bc3e88415b776bdbe77cc11fcf619ccd715f1f167491705385d8d622949048cedf6770a0c1d846e7eff37c9e1a379e857410f6b277be002eff2f11025d27041442cf0d7a7b56dcbce19bbd75c24a53f89a2818d45397231bdccbd2dd19f6216ad596003ef0a34c7b24ec293c0d762cb264b5a5646f2e3c559b31f427f4f4b94a81741cc8aa1a5e019ca2d533e5bbf2f0eabc200cad7772c209d4024929f15598a3344fcc41c102d28b5fc065259648aad7d4522cc67c813c1cd64ab4f4cbb76c96d0c0139d500229eb43c324c521af3857e2d991d6642c88c417eccf3633564977d23057375342bcb3d12189e3d58f3f43db592ab49cdd1303401c025bfd6b4a6125dfc7a09680133adc224899d3f2383731efeb98524c5c899dec30879e9b8ae293fe7867447cce0f6cebfc98f4561694a28e2438c4f7894e5f9e8d492985562517628e88423a60c901ab141a8440005af9b4a84b8ea35431f9dcdb79756161f2f83c81c92c1a92fb3f240dedd902525bd727abb154b4a4b5d4bb9f936ee2d2fc2b4d60dce74af09410a4b38cb384cdbdc0b32a7477771fcc8e0aa592a3eeae5be39a4da944dc2f415f3d9b9f75bf265e8e2254ad00d81fb12d7e7f293982ed4ee3726dcd131481e9e7b337d756336dd11864b22e8661342af92fb42ff67b48d4598d4f6f0b3aa1d07bb1375177768d12db6572b4a384d65868c0931ce32710cdbe003f5a78eebf1d45e21cc15100464b976cbc85d8ba71d3b57539f0686d72af04089d54f1f1ac6702e7e44629dab55edc7143df69bfd6dc177b9291e961f4279b4b119999ec055e40c2238fe6edeb7e3c943b7617730ac4026d0d0a2a58f90a7e76b99a24153bbc9410598c913f76cab6b68059179e33d8ff9ee9afb1ded3e694b70185e84f0800f52d36cb5c2e13156aadff5af993f645b4da8ec6cbb0b5bb4816f483a7b08f8a9eff4fc9a1a51d2aa0c4ff4b5b0e89c5c02ea29986655eb4519b78cfa3072549cbccaf64d2385ba3a215a07f313ddadc1c72f4f9001c27c0108ab2de177b5013317e23156d7bd7b1671c4c0b09ef9fa51a3a0bc3eb7955f3dff97a6cfd23067b7099e65cfeb6f5931553a04e0aedab4204a04abfc495191e8df7da710b38f79065b1e7f1013c1469c6c0b967388a87b62446c21bbcf39003abd5a5589cda2891896353f46a7c3b11945cef3efcab70465fca597c8a122ebed9890ab72a53dedffa55d0debd9670c3d27f7e18e4a5ed1899dc2f6861ccbb9f373873cec5ad3b1ccf67786ded4cfd5b673e82bfcca1d82bcb52c978973ae462c0584ffbc33bac82b1e53a24e37d3b2c027617de693a1d2112a29f51038d2dfba0d9ec6d9be9126559e2121c20045bca300795ee84bc8ef03b9bdebd8f1ff3cbea483219925e808b3bccdd30fded7a0ee68c6536acea8149fa7b9163536f098f69164c562c2693584c5162cbb94a706f24aba34b177a1aef95eef256e903c525b77a391a5d8249d8029c1d4e90fe3ad5b0b8268e0f823c55e1817e318928e42dc454eada3a8215fac0f49db01ddf1ce3f959c96b7ce0258f0150c2a8346a049942e667c3cd4232734c2a7b0c167426d2ff7cb3c457df0113a6c697c9584f9b7819f341afa0bd790dc189f8a10b7e698ca536d4bcf67fe883eb750e33aea37d928e2ee788346dc20308c78c15f3a35059f36b816fa7ea2c086eb97eecd478a4d93be0cf4627ab6a9b4f896ec4de4bb8ebcb298f3ed917907d34782efeeeffdd9ee12efe08cd80854f461608a2ef602584bf2fcbf61878375ed2a9d7ab3429ed40b2344ea335e0d9a4737197e518575a6f6f5ca188d046e12c9b2ab6d9e7d50365e32cf33899bf5780909ca05674e726647863ed07c4cc9953b0c4d2b58ceef60863fffe6963fd5abd146ed075b3b9274eb7a7be4c55ff02b539a66a44739f9d0dcfa2768d89abef611c65c96416f6e2c74fa794604310704c851982eea30be4ccdae856286a997995755d130cd18037dfd5c61108896b0023c2b06214b07ef7208741c650a10dbb7972cb71335877d8a2f9e766a077fbfabdde3ef180683bd14f7852ccded4b105f0dd2b9237e2d7713c5ced2292747544c31fd366a1a62f15f640f04169b2d7f143e16bf2690cc3b9a856df4959a8f8301afba67f0be92f13f24c3413a790df4eb9aec043fb686d15086827882363b4260dcb5b67fdebe9308575525d04d07cbb148e38d7213438b8c1a9d5d7fc5080a9a982cf827cafbbd307a4214b97bd10b143ec408af610558cac415aa305e859ba88ec70425faec6e9375eabcee28822792eaccc261c2135868801030bd8cbb58b239deefec057e527aada2e8d423e43af79079b9660c0c7e7760b4294b752ca90209e61744861ef017eba68ff3e32841c07bcd9d2b2b77d05aea971b685e54ab44cbe158c600da8993aced7f1ad4ab2ce6cb709367081e3e8b2d5e704ed587a1f288e6cb26b6c38c745828efeef47735667f0a9165da51f6c345c9d6cac3dc7360b61bb9107d5f73064b0171147579278b23ef28b0938d55a8efddbdc999b8e46454dbf80bd613b7401a94a5c343c6f00c53b9b15863b1a558c2f05b546d0dd35f180098cf8c4ecacd74d29e365a9d7bb010fdb7a278e52e6d1c051746b816fcdfb496cf291da8e2a898662100847c25c5f75f9518492336ecdc5e9667d89c323cdb2281cf3275a77323c3518f2d63cbbaa2d0b18877d68c9d4842b375dc45abb152d6ef1dee7bc32b2f9fed5756cad09cf9d22712e6c42afd8b8ce08f83464fd6e7a0a1c829ae3fab22acf04f7e7537a401292510905354bbaa237a8740f979457b931dc92fc1c621ac904a2be19f95b8303514d3f30313df802591d13aa7fb12e090db1d7d19ea6b55dfc97b36af20107b1f40cd2caedb55aced922e9956122bff93235603075604294d7978684518867b01a0db534d7b9b54913b17a4b76fb491affa0dea4a8143b721c732c9d237204f2f33fcb4b451f66dc36141ed89282f059c92bde8e72f636ca4b670a5282f9d174726b30ac38dff54db3187d8e354b233d5d9b22e79bce8a94ddcfc375c624dfee2f7a55e50a35377cf9f427f6963557a78f2b27a4fd73b4a0ea4d89ddeab043d6f0cddd64db1a53f2bb37082bf6cc093220243cc8548438c7309f7e1fd11f5c77d470147ae21165ea4927debf88f056d502656fb55ffb9aef20376785a549ea2132088344d0f407cbf4da6ec4ada68ea2f5576da20a4cead2872cb1f2d5139db0ff6b004508c3eee503d8e03b73815c2432d7d2e75f1daedeb6f3cf7c39cbdb6e6d42a9ef269cee017b4d5741a1e0a6e755db19587245e2e979d913d78fb586049e4003842b8fa6105bd8c8172165aeae2a485a584dff77d2135f3418857c92b02f2f4d0c28738f56d3c049724c9fb06890bb89f1ce81ceba02aae94613fb3a9fd7ae5e3c0126375a15534dfda3c7c73f23c77c507445e09b31e0113ed5d5eb77c723c825000fed5216dedffd117a60b426d1f51bdb0cce8a559ee5c4080ef72a839046fb46cde55b4b5fcd2fb8a3342a0c6d5a129e9f83d791d10cc36d3fc9ca4ddad1a5f51720d449906938645d9fa750a322e562fd1fef1cfcf85e8a0c54d08effe8a5875f827b4699f031b2725842650edb079d46e8e6362270a455b6d532602f63d5b7f72181d327100ad34bc1a0b2009386549c464f3cd898e73c28568247b19421e438a407fa753016ec7dc64b60323d809cc98d3d9873c91eeb7a1f41a3a7927b0e1ecc47f4c385d380d280f4a2547b8dd275b3acfafdfde2ba2b7a4905ac443047cf818db4990018bf44ce2689bb363743df618a455138c257c13234e2a4ed28cd23dc08fe6ffff6697a9eef47ceda9709fdf4834f4298cdba50194cff6ebbcd4a7b47c85a99ccb3dacf93e4b29652ae773815ab04045731384b08eca66f7620b61878371f44d9c05bf7a6c303f252e70547dbdc99423fbf941b2220c1c1347747170d18e894c151863b307aecd2a194e193fa882383e7907f83aae83b7304643043954acb31ab4daca275542424951beb2ba940589a9c7b8c20c33e3d8bef21c6d88b93b3fa11ea3092aea52436ceccabefa2fd9f1cbb2b2e243b85fd0c0c2d5d3960c4808be60d333598dfb1532202ad926363d22c3531e58fe890a138d499f8e48391a58f14c00cb50789913130c94636a28bc7ea0325dd72db06fd5c46244ea705bf47891df786dbd245d453b00e8e212d8ae4afc71853e8da3143618d0c68b638eca13eadb409605b2c716dd0c20a2023529e67faaf44124d1be1e27d73053d2694d755c60225f72234944d8072a08eae16029ab71665a0d6a672e5acf8bf9772c673f1f512e27f34e4df8d9dc7abef14d59f677980fb5d9262e17e17710d290a0989e5a0fbc802907950faf2048ad86d11d2e65d5d91f1f7dfd0e1d311472c33f4549529b1333b3573e03f1011acdf2faf1b7877971a3266fa2052fc24c5679690fa8f6091f95464c79995e531216121e7fcb69a724078caf87bfd54ae3244b2ea3e948305c5d7b9e7dcae0827efb13a02604ca8a497af9de93f98674e394b4ecc9af3bbc982c09b12180b36a3e66ed62538f1c1717e072513ca3e13cbb8721fa72f6c92c51ae755cbc59ad199055ce42fa9cfca408b35e308d87b0803980c5a1561829800424bd42b65cfc35720cf662c9a38ed2967dcc7a66e94a10030037d396028e9ece87ccd11191b0ef8c9b0e0446dc76b05e415dd70204e3a5875540682d0d34ea4e68dbd07156ce27f7b14004460587a9bd029dc7639b88f7b6c72be574eda1423312965b7e5975308ab50aebf744d6fd0813c324a065ddd5875a2affe1155c1502d38aaa2d8f15b44f77ec9e4ffdd073be896cb85af6650f93b8eb06225b24639e31a4ef0ba70acd016954179ec56e5424f9e44015ec600cec2e9368c988874ca5f1b5ff04a799347db6432b7c476bb084458045e91907810869a92280e959e0eb5dda646af520e061f996a98e024a99ea1b661b0e79e960fb883395f212ddc78ae2b848da117f2d0be92f98a84b09819cca12f292dc570a592cce3255b8ccafffc07f33dca3326b08515d98f34cbce318320db9712e263a439ed55a4b983ff908e65318206171e99d4efb0899f8c7cbf8574337550f33cdaeb5d175f125709bd8332354948a5019f45fe1a2f538d45d6c200db84fd78f34480ff37b7ead149e44fab0837e9e858812243e48bfd2700dec3a5598bfc9260c9e18fbbf2345ef514bf107e1a6888b27e5409d931b44db9d06055d5b1f85043dcc366e421e0097c4529a38bde951a601e3754664840fa21f246a4a118a02061483228df5232373e3a45f10bc78bc5c0ac9255ba353fb97d0b160082b6f128cc168a8426703d25e2ee399961574e1afc25b84803806677beef5e728a59ee02c95b16476b6c554a7a8980653477182aef1a98906962f2cd401e239a0d1d96bdb5bcfa92e86721e87d7f3cb9e87157f649ad45bc27a84f813956db9bc84dd37587f8bf1b979f732023fd0622a38c559f383d276be17ae9c7ad8463bb70b5c61335afc59611b9d35dddca026dc3c0a0c8527c014ff51c5bd2d3fa461134fa84f0d456fbacc3adfd27ecbef949f60a16d320153233e2a9ee845e68f0e45944fa00152910db9b9946fa16373c55f42e8914050bf2f08d6e37ea2e94e715b521b41f81d25b2cabf3d22d7a4fa83e978045fc7649c3bfc9f1e3931c176037cb5ce0b8613ac92d865d60d33b52a52594462680e987e316f4966767e08d1664405f731575cc5aaed68859f0233cac275442dd88137a45ee36f722689f119e6809b5502509901b5a62e20436f4a12b9fffe3e63e8e84b9ceb283b63dfa4beb24b8d5d056478c77cf2ce75b51882b44dd09f034b4f053984cdd6eab8b9ac650572cf2c61e50bfb647535988306ba07663d367d4c1c39e68337032a144597a49369c10c091e8683e6a42151ae3aabad7f79ffb9f32979e005f9abdd081029ebb81c8a7cf37c381392e7e9b2d77a5ca47c42626229600d558807b3193c21d75d00c1a62c33c80eb60a854f1913789e074484e73c2495e68f1f80902041ae9bb6996aa76c751292fd0be17b7036ce5291ccc1b5ef8a611cf1a3f1d9489c08bf0a8a9a581bcbbc6042e6f8b27c2a6d61a58a3895e528ad4dbdcbbc938d78aa062367322ddaaeb08954e333d2f3f8d579098a0c59d468f5022f7259f42d9e1f2618d649f48e6caa06f04a98a667963eea8e57fd20b557395522cc0cb31ff3a8c2e350446067a0c76674b4f9af7b41b4ad75c06f0c9acc7c043f838acc14088f7364b65e327dd8910ea40463e63f97da22691a8956122993801b05bbdbbd44df2d11e7a3c8de23090291076c3a3e3d9f6a88749a1ddda461d0b0442f0ec6786117725d9d6415b744bc796a9f284d287e43452b9157ce73a618330c2225f4744659583e0d82b92972ed98d2647e16b802b84b032edb869663d7bdd90edf88fda5b8176968258b1be99df96bf5514e9d4248c8de229214bfd78f8642cd7ca8f67eb093099e7dea21edb74f4c3c5ee5e2fa70da78a72b3cdc7de7802f20d48cfb2684f90b57dea9d19adb447492c57a2b0eb350b455c1f0b8d243ee5a57759ad523e3572d11be45c476a62325263c5d3869aed1bfbe8c79e63a69594aec3d8aa7f9a74a796bbfd4e1cc6f0fbb9e7aa6993e38bac68f467f5d69670a112147342adb727bbcf31989e20eb6270066b0b9f649f03b8658303fda76eb81437984062b09ac442023f05a89e3a3e5374bbca942f7b9a3a6c0034bafea6e831da8a13d827e2426a0890cc85ff15ff11c9fe6116aa60dd89461981d9e846595f1ae985cc74a6d8414e1f78d9496eb959aea3fa7b7b17fbfa2655b0acfecfc9a654e69b5772cff07fe56db18162245d8f8d27fbe9df58a2b69c2dd85aeecb14b075aef45809cd41af4898d0cf1212947822e730ad67f56840d1d893d55d8496094ccfe23013a932f882844ee3541b7eefd6dbbff16897ae7a6abb1e01b3c76c0ca5a7855fc3193b9b033c8fe56605622dee961dc2c50d7c5f521bfaad4f85ef4d5efc2ce22f5c0ddf93b89cc15331590729a8f934f70e7994fe9490a9479ce8c0009ab013c6113a2b6e19895e43fb12497c3fa697bba08b3acc913a7bc91b0b9a02010722462737b98ecb3bba8dd7f9805e05b5ca2d3278fa647af0a5353d4fc80d207ae71ee741bdd558b74c01b5e3e8fa044155ff3cbeeb01e2adc644a3f319dd587d4454865ed97b47315e0dd78fe7d5bb4782ba0271cd00d60f16ded10004f82b682616744fb41f4d6acc318c78d256a14a8dcc39d2e7b41c234504e8aefd3be015a74754430098d984f9eeba630792fc5980d66c23a60ea4f8a7af756e7336dbc0144942d306bf1fcd007c10cd355b75b735f824c63bf0365ecb9e07e87f6ff713369b777d9ebefceb4278c1edb9826a8d81d2b34b15d296e1c9bcb2b34ce881b931808370f6d4246fee39d40f96e5334a29413da1f6c868875162197e9e9300c0a3f4709fc67db62ea71cdf51bdec52b7264d91ad5cdf4ae16cab50248e1fc45cd9d4758c73120645d6fbd406760345e1fa6adfc9b90b03800f97459d3c92d14fa1fa74b21effee88c70babe39f59adca9c0fc7f86bcd5fd6532f47eb3b0d3b215e7f41b9c81f10e018c66f2ee47a18695cf550e50447fc80f77f150ded1b750bb51b20c2577f111e91dcd9b807b43acee35d32b35014904175ea5035d5d9350e1407edca1297478c5276f7d983e060d685b0272162df371dacbe662092b398cb063b86ba0cc4f9e124c3a4d1aa510d28fc6a2002f58525a8906a3ec92ca93151789b28a1d2006a87401d88e9e390c61170f7a2df2a0f0886fc461efd9e3a6fa67886c6a242cf0bac23eb8e8669ce4d1bcdb4ad63c4ba844795c710d5572e18e260282884afd2923de0a1810728e11316b06f1d2e08f59da78c22ed8e6c47a21270dc5e4dccaf186ea708e9a0f92729ecc9a4b3528e20d91eeae9d27abfbafd69bbc0b4e1d99832783fecc20d04bacf53cff9edfdbc53d6abc23831aede720237e7f56bd71bd6f5af96185ca1ade84d0be96bc044a131e4a0ca0c36cf5c6ec30dfc078215171eddc23126f2262563f37f398027c034bf21c6a4b1bd8bc6e327e6d7dd09b5241094cdf573aa6ebe622487bc7d87f6b41d9d6474e3b6039f7a2f96f34046e186d6a29e99fd2c5e5ed2564f11d9a71e777ae9ef2a5dd8f74532bac053ac32a5bf529b7d624d90a6a6845d82ae33fb09b2dfaa05ce5c27771c48668759d9dc282a46e620af5751ad5d5fafdc3636744ef018d3b6bd53a42034766c8198f7c00f82f6751ae9c32145e946ea6ec57eab281ba4d06e1a6893c13dc946fc8479c2a80cf4f62cbb9df728ef1ad76ab3279fe920ae2efeae2f9e8dc935b58beaf2a2265a2bca3a4ffa2b24c983ec85cb9b183c4c32a0559af320dcf6d9317667b237a8e99c6bd02e7cbc796f8b26bce024922af13c2306cf9ca0003995ca6f16d813c6bfd0fb917bba9b6f620cd0798fe57ea25fec32c188dff39d801191c8591c783352a0ed1510cefbd546f07f936f6d285cf03a9e7b78e60bb2195ca92282f00ac2c5f2809904f5baf1f49b1e0bd7b35c8c894a4238e4f6890c6a94df56afcab6a7ecfdbc4f872ffeac0339cddae3d2a7ba2e0b26a46ac84325689506854201eaa289bb34f9374cdd1b5b8696713994b68b009a5236bfd8f83f7285502f1e6fa0ae8e4a09ed452e089484c25b6006812465de93d7eb8360023a72a5bf7b549c358d879922f5144938c26573bed07f650e7a590298c0635dd4e2f2790ef82239d4f40fcd4cc159cce780092312aeef56e06f8ca2cdee5a407f62371c9dcbc4c0b01779421083d4476d9dc7d63bc47ed279015124a3525c14456070e333b38a3a12c5ee3efedc7bbe0b16a89f9f5e1e71fdf466c4dbd9a28370e5e70c01d0dace70296ca39faa0da683983cccb97c3ed87473005e8f0ed2cdf668c51966c172112a9402a4743946bfb28edf06478d9a02980040c0da22398b52599c46646d13ed8d081ba99c9c558a0faaf1f2667d38c4a55c7aee34f808df59ccf9f02f4c7de5ad65d4709f416b2f2e7c94b4273739746c77f4807f94cb300de3b6b47780cdcd0fd940db70ff62e0f4c63454790fc6e8f3871e93a9d6c3ef4a946710e6141f370319d7c8a76ddda2a252a3fc572551df8629cf818a1584dcc4e3ecacd1d4c66d5b8d237301c95c2e220bb386ac0c8c122e51fb033ffca0ae34c2f93ecf6ba7d375cae49cd6d39b51e90285d97520b622812c5ca72528da5e7bc1d5c6fe459e687d0da94a0d5c2f0f390f76354ce8f6f6f801a66934bbf9cd65fbbd373ad476f60ee0b4721673ad93ad067b0bb10baed0d9c6a710d6143083874d4ba98fa89823acd9e6c7b18e67732968a87aacb6ba6ef1bef6b730c40c5a1dd7436a9de663e40d4e168f1addb3749601251bc3134f25ba6631b04553c721986aed536773b6995065d4a4eda5265c56918bf83c99ec9e1d83197127dc13f76983851d204353fb099a87cefba3db0f737217e3cedf39b7a9d1de09d9f2e05e7c9878ae6f4a87c6fcca19d039f64bf1b291297eb9ed6304c227fde05e50c7c234429f97cb06cdc4d348383e188b5e985fb1fa269e2ef5fa9ffaa51d9fa3b6a988a68552f5774b61bb5b294b2ba959c52e5e413ba2c1c84b63e2eb678ceec7edf180a4cf649c99d5f64d8b7b3749623fcb4c470f64bdd5330a6f937707a612a42b48de27e7043475a9de523849561da21ca05550797ae80900ebc3f58967f6155a1a5510ecea3813f3645ba27813df285560e982b5e9785a636ec716e7a337a208d6abfe2fff3d43bea32f7cbed9c393bd3ffcf52df44d45b8a25a647befbafbbb92f65e5e5117e38957a3cb67d3aa011c6f15357ddad645e3e0251956dea26e068d8878713a3bae07496ce36e6dfca66af84609851cec1b5bd569fe9d3ce6eb042083d385dd4c2b153134903af8febff5717dea0bf424f3d93fd497a7c639262d0e23ac79d4abec372a27f7b82a2363bbe468f8b168669845d0d3108d2dcd79117bd9fd220b0fc62d6c49bb545ade5f51e1c27858d9f86026c194834ffe12ba35528f0bd8d5145e10f1f8684de3c3cd16a9b87b396b3a046577bd98c2fd9e988c8c40482e6b768e050e11ee7e7940e4ad5eefe4d5eb4061662d7bd905c25c753f5828fb5815e0713cd9cc84c913f6d7366647062d6611eea7b651e006bffab903752eb67623410c78f7c3cfb214c5851f2127b398bf7a4afc6b7dd89385809f1b86aa0ea85a20aa4c1e84fffb1c25a163ddb12de7eb7c0ab77f560a223d364da3243c592b0954ad0f2a8694a248d8c8362a37ae8a95f6f57c94e2d16cab5da88266c1e4a47b69949af062d43b52ed98bb409df0b1ab6ac5b68337ef57bc875569833b0ad4a64d2843978b044dc0998d595ff39b5276ba66ce1ec42b781b841e8256b743f7ed9c63c968ba3bc52b98843fec2db53c4b74c5857b81b917af6b231dfee3ef7fdaa087a739adb35a7ddeeda48f64fdc0d4ad7d27ddf9df8557ae3346064cee0c05bea6821f0bb028936e6acea64f6d1f2dc5ebe1a2869968ee7e3d4d75393f7f32ea73293bcc1ecbd028a4f3f56c300d5d1fa1699a3bcfaf7b393d2b95767fb12b7e7029df633b11c8a23f474e2011b587c409edb857d9236d77aba14e04682ae40f1bf7c1e32f280d640","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"fe727b3ec2446f3e9140a7a09442f679"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
