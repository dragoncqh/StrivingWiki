<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"dfecf36c4615da2799c848543bcee42b6b5bad070ce45cf0f59620d6294ff5c625351c553f9122ab203a32ac576cf4d1d0c307f33d58a020853f8e87e94e6261382062d429436b460a4fc4d33d8d98b6f33b185617539f98d0a43a0080768495d9a35bfde0dbb8077ac00cf4743b2be4fae195ea62b97e94f46a1a5f6cc26f5701f02b8019367eaad2fe04d9aaf47d6d35d50bb2d41276b5fa420d62fbf38a746ee91a5f3b86db4a20df34226463f79eb539c0b5b9574dd14fc77abe86e5f9ff358ea21fdb119e167352414a419e2e00d8c6bd7d67fc1ba8cb4934b5702f11ca86d72f325507b6c8fe103d6999f0748d702f8b9830236024b895452d31919c48aeaa730956c7d0b809c3bcab27a866cd8bc37c10d94fe26c1d8db7d86c3b07a269fb0dffb86d5da80495852fe4c423534bd485cfb8571fc1031a0b28384fb2eeff9659abe558007e6a9975627198f699a011270c80d97e7446c949b18049fa4f760767105a71e4b19301e8140a99788f541f3305dbf57001f041c73b713e880a2fa257f2bae70e2e2695ceedaab47ec8bfd8679315773550acddadbd5adbba6f7dd9a8a46544aeb2bd5d81a6457c4783a37878bf4fc73ffe67e43c74f64cfd96a9e7c6513d38731907a8c2bab58baf97e17c7648ee34914abf8ef2c8fc3cab603be54f1a1bc275cb9670a8b27bfd06888213cd128e3c649753ac33bf72354b3cec30ba4717b92a767e6bff5de473f42e66ff4daac290a3c8903c24e0efb79a520148faa1059b4742a1ce8287c932ea9d0dd6b50090c68a98d003f6d6b4e4be35ffde43165372c590a3723123944d8bfff53117099f163341c150945c5ccc84e15ecbb2cc28479247a9088f0dd73fdfb698a78abb1acc70c98c923c2edf00803edd128fe0772c5fd4344781a8ac72edd562e162544ce1cfc81066e93bc322cd5b34a78e93a0d046ed084e9b31ec80311b42b653cbbd870793b8d02983886b8594d56eb432f11499b08f2c75bd030a85e31471681a4aeeb4e4f17602459aac363c9ef17f04029de80215ecef95537607ae126a00f88c016ddfd3d61a5e1895eff09fae322dba7b0548b1ba15eeeabdec0213cbf1b4951887618c57421d98d798c7cbeeb6c6423f639d3a8070e7fa0bc7343ec10769d0f7bab4c6fdde1549c1f3502b71919b5bb07c26140c9295ba083192ab6c78bd832bf04859a58d497898a60a0c1ef099de5add7d4d3c2898b4e65f7c539f883896aa11dae93c4b2becd4f2233c7c6693e3b966ec75a35be63d5773964c8770f69811a0412caf6c8438c0e7eaac48c91ec5304025bb0d1a068fee5186c1ba1b1499602034a5457b278eaae0b36c6376bf638cde9de1cc4e466e6c4e689f56772e8ee8cdf31fe667bb3f3c423f966f612b53d3ae6e202e3f742cb5a5bb0e58ead577bbf688f7d0883a99b430262dfb6bf71e25bc40fa7a0085a7f91da06ea9fee735d52bb8b2232fd4c4213aa9516b2107eae73c3b6608f34fb0b486addc717bd0f5f13e2a956911e75c6c7c2a7348e7a781aee15ff0b41243eec7c272d8570cd35526caf2ef370b69de43c0c52cd77a27ce71a3d31befdca878ce168a56e80f780437cfd3ae314647fe3838e57e3b7871a575cd6c5a45333b14b844de5e91ea29583abb475861e2fc9f1208772937e8d671f4b887df801f5df4caf0f4f650d8609b3c3b9f948143e42d4d0c06b0d57aa761d2cd683f4856c578331be41ba822a750a981bf3dfa69668c826d24151a78d41a34d08ddd36972a729884ec30a507f8c9a2ea5e67fefa98bf6dd9b75912f476eb8dc6ba9665d4b33cd280c2b3a9b7ab7e16e7aadffcca9214a2cab98f5674624c43363961534b0e29b1a08cc201de0155ef42ae28fad1fb2d69d71569a28b8c5ede9b7305a49f6c9df5eeda3a98a314cb32b52132b62141476957c88d965030ca506e317821c0f9624e6cdee8d4793db8ef197e0f90c88652ea282d45a4c211cf5a63abd03852aa97315e08611543336b428c3736f4d9e9cb81aec714be5c60cb957f0debbae5105bee53705d4060fad47ddc8dfdfc2815de4655fe704da7a0aebf0cb3796d0b8a02f8d2fa78a2152ae59178895e244f73881f07fe787ac1aaadcc6fe680ccc0aee4f5a3f6bf2f2de9c5ecc67d35a4fc1ab5ff94300acb971ce091d3593abf2755cd3ad2bfec6fdfc76692fcf2b39e9c58fa5efe880b3cf8a8734971bcd71cb1e6bea35103c2ea48578706e7d6e69f5d492cc5e87733bcc9454a111859d5dcb33af398f85972c84c8efda3705b7ecc8013b83e42b8954216738effe6c7251864600dfeb6f0cd1850401f29e158c24478b816bd184b59a16f45d020597ea8cc2a4612074c578571168695c8a56249f427ab7b9fd72a81c8bbe2ababfbdc3c239bc4014533e1b502507e9fa52eee63becfdbb3e6cd75f6be73e49d7decf43df9c3beeac6918e054f92aace59ac24a29e108c38feca81513632805b41690001cc6f4b6e219b85a42553e12e150c49e9d571146fd8f1a057dd6e1f2e76272a6cb2545b85509f431cf333ccfffa46c5e43cb884b86ca9bcb5003838533dced5d4d92ffa45669dd0a0770084a9b0cb425379c58f688772e36060e1ea40f992ad91fd8622ee3ba3a5697f057f95145c427579f39b6eb7cec4283d647d3705a505600d3f8c756a508c864b43a0a240334362d307e174a990e59af9794f7f0ab1596d75fb91a704b73aa0b0c6372b86213c6c9fec9cf0d0b1d82b0f9bc5d01e48c527c431511c1448a5e3fb080316cb040be927c57d4caffcb61895b6f5b240c7d06208052c26bda383664ac342318946c980dad47f3cfe03dfed33668cd4a42fdff13be43fa05e2214512e67d640464f554576bb7a8646ccd691eca9036cff63eb0770355f95d76dfb4a433b4523353d6fec3d638557453492d86fee3c8e4a59d3e5d20abac82d486f3cd794f294ce4c57691668fe69296a7857cf4a9e40a25fa9e13b1ac6026efbe6f75d867618d7ee4e7eb822779fc661a01848834ab5bbbee9a44cdf158971a2ddfd7dd41fa0f90cfa44737ecbd352fcf336472ccf121fdd6317a435b4ff7d7030727621e7f489fe7701b659ba17c020f872e74440aa2bd729dc7e7c20512557245ae411c5af863827451970e48357be96a68b143775c776a8f749d822a3066e02fb3c56e0b9a33fb8c743d639adb3bb43881018fc7bf9b83ab860d23310a26474651663204346e0450308717cf81ce8e0df12b36d1a986b5a660dbadfc7aacbc3bce0fcc3407bf424a412fccab348e50f8e498d23acbbb65175b076569a3249a13c3f9fa7e3d08843e9fa26a9931b417237ba5197f79375dcb7adc57dea0b4c239cba0b176b587c0ba9541e5a0f3df9ecd26ccc5026a7105cf0d1d940dba8d2afe1a42f8feb3792da72cad4880139f5b963287d2ec4cffce62e94fbfcec2a7253cabe1da70ea5f9f4c894279e3994d9d033b28d6c29179a35eb19bed48ee78583b17b007e56d1a9fdb4b7555fc494741d8452b2694371c8a5c133adb14a1bef8d83e32d45aa49f40752dfa393547743ad57286640e8781dc9721002719f6c8a02e12c92a8a4dcba9ec0ade55a6f30f6bed606e0be7344d2752138c93b3d9fcee75088fccbc99f53c25446c5bb1c60f34958ad9b30096865066451f6544526439e8a1c7e0ca25c1dbf4089c2cfac28e73cfe8d9ffa7c190a57248b0907277329721ad8562416cd4dd6e7aeb4438a869ad63056cd6256a7ae46842557bf84994bf237aa029eb8a07eda96d5f7ac1af274e7da9551ee993fefd43161a376e5ae0822b08ca1093f9f5c9e99bb13b63091ed1c96cc769808cb8e5216e284bf53244108ae2d184df0ec9c7a1f9a4277faca6d8d2e8acb7b586d867f6abab4b5f5c60fd50a2408095fe6ed16258c8772d3409d5fdc3982302431c9787cc2e4402a77bcfde72e9473f97afa8de406220079e0d6a68edde55bee146ee2f76d57c3b055441b7038703355a27a9923a16bdac9aaedc9358236e87d971ec2efaf84e27694d1a8b0846c060eb5d861a28257fb40c1c61822d8af92745c2b0a5ad7e638d09820b65ba8e67d8fa315bc28bb69d5796308b9b7b036ab85da65045f044509f1225ad72e27dfd8fc108fe1536aceb3712886aeb2fc6f4c112465fe99bb93432038fc16cb5bb3ddbe90305cb18c5623759d5240c55d8544370a537ece7bfebe97049593d93ad741ea696c77f57377e9f5787232c93f35354ce8d4270beadbc4beb0555eb87a914e8250ddc62be748cee201097313af7635022be60bb4fd2c25715596f5a058deedbb293205c08713427b3bcfac0ab1334303dfaf00bd3496978682d9f4222206e6fe907903aed706a00fea0671dff8dd7d2beaa742cccb4e8ca926cd9a5cc8bf04f29b455128e3025a0f7ac093e47483c12b190b7ae877cbf07048c8d438fcff82ba6f6076a9e92d627a38fde539541f49b676dd311df4ec8cd68f45032d493debbf84545ebf1afb7cbce5227cb765ff0dd1c575438dc57eea359de1ddd1a33ec6763ef6a11f655771811c59f6f16d05923fa7eddc8afc9b282f852b9c8d1f2b4d349e4c222dac3041f82991dbfd83efca22a5486de8e075a91cf097c98c371cc97378afed32382ca8e03771bd81dbe0b9ca67fb6715b4812390d8ed0c20c9054d65055a3627db8bd2dcbde8d4b8513233b10e011d0cc394ee2170caad30addfe5a58426a9da08cc4368a067fb9e4cc831ba298718b56480e407b33f2b15b3dea006f53126c326b476cb735bc8a92f432ac062fa131e051db7010165a7b28d3fb3cb36961432a9b7a50e688c4909e28ecae48aa10e619b00ffced7f9d0e78da6c83e1a6560b2913ba1d45ebd963464886c68229400bdd0d589d38891d58e8e756b5f8664cca8ba2c559efb846bc315e9f070d6079499ca35a2f59f0d23b0883a4ce121ed021800090296215a78f00c6688dc45258da82c1c1bb2f1ab482ccdbc83438c0c864f1443a4963c57c315555fd53071f37542545225095fb8cafdb81ea8c7fb0180427212114e1eb6fd998edc932d6efa559687f20043071922674331494f1b23a2805f4a735087aed2704779088d9db7fa05deb80afdaef25215b57fad221add97978c747eddc49946c81f8a95eb3a7d1c001361cbadf24f3587f6058a8588bd330756ff476b1fa40f2a923a71d39a559f9ab86538b81a0db48c2a133c3f1f9876463278d40166648c16d0d929817ae66965058962898db8c2f1c073f6d567f7e8cfb00a382d7ac50abc4089ab19690a0f71c45b466069b717b1d9a35385add6f450d05455efea4406ced17ed6a5270fb8597ececb999cf29f3165a048b0882165c1bea1c6cfb3032876fe1baabb8d46208c80ca1a81b15f9dec99d9340edc0aa2d3b20e3ebeb68aa985f0faee695635692d800b9fbcd95f8e8a1b107ee084365b88e5701cc28d619d548e19dacbd0e5667eb4b96ffb358325f51b1f5f24d78c6aacd65df6b3b60c2ca03359442bfb003c8da7206448f3fa23a3a7167dbf43af27a96956fa72b125ea92a66a4541481bcfb5f81c443187de2c652a1e871ccd4127584cbaec73a1e6e90228a4e222d374ea69ebf9fe06d4bc28c44c51ba738d8a1fd704ee30c839f01071a6d57b85a6b3ef6bdc9ae11c77c7e854d5d0b1d5b38f7517c2d44d8127be0d2776bcc0acacfa712fee72ac0cd5870b956f3ca3250cd9cd10357e80f881b1af8d7ffbed1f4f9a98681fd90e5ff8b8f2eaa9287420067ba62ef369cee0a82266f3f2c02afe91dabcad641fcc74c779f67b4a28fa498d1eab194910aeeaf41647eb62123c0beba0219374f1799f7cd2ea1bac4c6cc210952fa4b08346f4e2067a1f9f111517dae67d838bd35da3d5dba0f0000759cbfd964dc1782d805be6a1e58f301ed218cdaa9216459a758821e86a1f9d623692732d7a2cd9cbcc88d527a4e22dbc0283fe831bd9ebe9741f5c8e83e9e2adbaa9eb19a3b8b5d1c373f5017860c0f7348989a7030a495dc9d0cf6efa6e637cf5d32b1d1c009a53a62bdebb625879c53a99e7b8e64f81116a1a986fcf3f63d6a1bf29adca2175367afabf6927db16d4db4c91b899ef1dc068cd34be616e126a44a9bcc0f8ee9f453f623d9bb51d90539d6638eac789097dbe557ae1dc6e45b79b7da42cae2dcea9fb6037b97a533670689e9e8358cd02fd7237442fd2c0fa1c5d51c7167fdc170fa40d745ab2437f6736a5a69dea79683926dc92b8935674575ae22aecb4eb602ab4266b85d09af7cbf234eb2c30b3909300fd41b7adb524106f297f98ae18ddf6e7f764f27e94772377f7cac85d633070f53bcbdd5443ca752233dc11d89fe38ec1d5d500fabe7f4a1a2acdd1c8ee5e502754a336a7db5ae5aee2f3d51258afff865e47adafa7d9594db592f189c0c9f731ff696cd3373fb2d1e4164ac5f8620e675aba415efa88440069aa7dda4a6b8f54614c2cbd10d1c89cc1d9b42b50158f9380b941d84998a931ca273ced5a73795a2b0b58d8269d6053a3c6891d6970f9a58d8c6f4194a0422ee2ead7fabee1cd44ce74a5fb67b5969413469548887702518bef194554c7b07dce5c60c3f748665f2305eb8d28ce0672601f19e9cd3e38ef391421ad4cf3098a2f7125bdd8430550bb09653390d59cd2cc44f2c870c175cd900c320b2f2a8d67e87744a46ac9e07b29cf33758db5925a5f9a96a34aa4470a33a0e31bf0cbb00b8892f7d46c2a7872ac6b274768416e4f431dba973475216545164c4498bb6c9b1c8abde05cc541b00ec5353bde7906f1ca1dfa59d50d1d244a8c12a16a03faa4e2367858cb88146f4631fcff3ef3126705a2e9f093faee4745e7f673fd551475d53538910869dacc5e89c3fca570dc6b2fe4661e72750925d0508a2bf045a1e9d754a28e923bfb9b54f3bb7f2f11117f201e96f558db84ba311f387a44c6d48e36e1941bc43610551e77d7045bc2358a8cb96dd16dc978538bb0f1226707ae6b8c4f76d0b1954dcfd075e8a5d608f73316d79cef410f405373446faa0a80baae385164704186a205632364cf1ef9be645730be312c76f507d6a8ae31eb2b5365e1af54380d1eb6b41f9f3f8669702bd6c44bfa133fec498d279f52704bf24a5e924159876a2fdae381e6a2ac6b2b47661f3aea98916bce805ea2729c73b534ce3b332018dd2ec420802179933f75b31d45539b9ba4ee38ec85064b9df00646dbc7540ba91acb670d518f5a7b60b8f5679af3c018c952c0e61b447de3b7ca229874dc972a71c1e4b4da6d010fa314f3cfbd726850376057246a8ec997c66ccab26d157314e27607e37392656c933b68846ed6566ca0d708902e6236dc8a5b1f2c225e7617ac1defc55c506e19b92e915dae2a5ef5fec7b499dcbb942cdcd7b1ece630d810875c32a22e2ce25cd2462d75195a6afcd3666a01f9bf7f29235bfcf20a95830557fdc5ce050d4676a43b01dfe2913585242086d5ac0984e29588b4a35108e15015a3b509aa647f54e2cccc246b8d969d83aed7e8bcf669703b886a15a353b17e318cbc21d03b9c974e6ef75eddbde6f214b291c70344272c75f4ddad8fdcf95f0e5c92995385ee3688d96145ef8c4f48b12f9a6698494f40955a95ed9423fd6265338cc5ae6527b079af8a0cd166032d31a8457677dcef49536615074a17bcec42c141981b3f1d38534e500a71768b04f00d91e2e9f3c8d0d773ffb508662fac050308e50efc5570e9fcfcb76e69196011cd81d375e6aa4e2a2af166aea1d4a870f910d1fefd50942759aae310741cd7e521708acf854f110da054ba3bd1e526c0348aac3e7a6b0375fa160917f312c2870f2a106cd4c6be34d942d6f3cea4600d6dc3f2cbd3cb506e825fd02936cf619c00caa48017bc9b8f721a3d74eac00a0783af79e248e2bdda6b04c5349e2d9488d5507ee61bceded9f8b0ef2bda4e245e130f85424b5d19f024ee836ade0a3cb959525fcbac39806123ac998796d094036a2bf5cdb159d0aa4cda5a6224fb77cce6453b1df0058ec7d91237f2ceefa44aed9fe89a3fc18e2371c932a67bdba3a665d902a81d47a8ac3bb735b4c43b5b4a4220560578ec550a42a76d64f34683065de522c7a2d0573ee4341ec780a67a47719a6eb147791c5cf60af776a3dfa173a65b7ece23974288b4d98d42573887e376301b051c8fc4cb049b7ba2454d7273b02b3f7ae5dd80edb85ab567af99ca7158296f8c6ab658b726ba36edaf3a0e4bbc1b236d5017355c82d387876ec2084288ec4cab18421d2fe2c900aa0b6e9d42637e4313d541ce7d1e0386aeff557f4bc0bc0e069b2c182f2b015e1c6acd0e64999ae21e3b1d5f09dd2cc74e6d403d3be79ea05abed96eeca8b9aaa2c4e1cf7542b2549cd2d7d6caf3f9361c22971e3806517ed3dfec15a7fc403a655731dcb114f4656653e21276a807d6dfeed3877e74750a9b083ff2ce2a466dfda4244e7ef2e68d0c485ec1efa92523b02d93dc04457b5a879cf1395078b4f36c5b7068bb27d1f77ec44714add965adebdd11385eb4e429b21e48d8cce736a9799b62947c5a3c66169aebc19b2acb02a951786f67bb8ab16cedaf39d33fa70d4e34bd25f9b456ae733028439f0d038b2a4d7f9c6826273352f18926a985347f8b3f59ac9d35436c29d228dd3590d02209dfe3c8e67d7994e99624fcda6a8526ee68aa0465fbbff20df4c75128ee4a08e3f32ec35cfa824cd2bb965cc07b3c516ab040dfee3f87c05222dc49bbb504dce8307453f6f4d2634d75073bc7b4a787c870736600b3fd2d836383363dd58ba0d1d858b439d2e3180cefa098638ab1f56c855dad68e4e5840328057e17e87881c9ef5185c0ba571ae05b34b252b2b15844ca8912a43cbeed752b2ad27112816d43a77d92516e42c2e441bf974a41ec6edf049f2609391faddd17ed7e30281234d4efe87abd02c199d17dd2fa85853947b104eb52ce4584a8b93a18b8a5a48b2f578ceb0bc8edf37243f2088e88c18a897c7e5deb17d364749b57b7b69d7bcb395e72afe225dc5c137443a04279df78604a444397a8bfd3de9d64d0e4dbf044e32a67ad90508a61fd80091535b2ca978a9208972a8c415a74d55003da0189495884fd2376789a4bbbcc10f9546b4873743d032c7c1318981a74cfdbf70eb366ddaf4fa1cf0faa7ce5bf7b2a5e14fb3bbd3a24dd4e3616f639e854ccaedac3652f9e345bb0374f0ee66f1b35844f7519bd406307ea05f0ffd489e7d62f840a085e03b2292b2322196b7ca0ee3eb28458e8494ec2fd97e8fd031a9742aaf191e3016f310630e5997a72d2039ed73df57b344cbacbbc7630221d0128c0b0f3b8b75ae6b6419ab5715e23519be3a98f85e75dc5a8912e8e36315e0940a8555b85c385ee3bd9f741e968b0e4a0aab08fa73b8b34fb997daf35b93aaf109fcf01da7113f24d093eb684926c10efd9d513a09d1ec04dad90df209b7a282229adc890c5f7b98520361997f81eaa1d95c13859573466e7d4b27dc9a58ee5bdb25785a661a0103de9da6510400abb3bae1f8820cad3e1522a217393fe95050eefc11f071be7a8eadc8bccfbd10d3a883a34ebfc146823b147a4672371a944b7eed44c916c2722e892b479c7a35aeff869e0eb7e4ce339c9f7dc02d2d8eb3d1c1e883c8b12088e5d9f1548c8c4fe13994edd6cfab9a25c9e8d6cbaef80c6bebd2af319112f7b8576dedcdd9b47a6a97ffc2bee613079323830d6d710229b98876f8103e73f2dd19b843c268b4963acdac7c9a961a0d3043d7a62c81a92324370fff9a38bb834af3d0119c329b518055e0ea8f731935d379da6864c0cd16d183fa52d1aaa52c58f72a284ff151dff8c5e2c496a3dfb3c71e33b8feced833b6f582bafd3254955a45f5fdbb978a5576e8b8136fc37e29d67be5893fe77fade69f726f3e1bc038f2e5340de8f8c5e580c67efa883d5b85de7ff09b149fc1d133690d7cd883b10f5908fd9528c78de3cf264cec61f20c9343714ee28e976cf83928d183d7260d81d7ba990c50c0de2371dd41aa158d5781fb0b1787475f3b73bbd7d0841a8363ff2fefcf47ecd9daea729ead9817f7d7453286175bec176883d5e6fa1cbfac1c3ad7487e384a96d6cde9feaacf0dd2b2a16f5464a78bde44736724fb46f3d7f88f8037aa454c9a73ac2cecf537efe0e347e3a8506a156f443218f0a43fed67f9c3509f7b43646fa5e9842e756590f4870fda96a807c130397a9bc3e7c14fe2f887e099b635e5d0593d62a3131ec1129384d03cc23d307c5220bdfe9ec6f9cbd70c07649f6d009dab926c5119177a8be52c917cc38fdce3ef8f9667df39c4ed817063fb1144062271f8b38acecff31fc6edba04b34f3504d318112ae3114bb66aedf864cd9d1535b21f7439b59b8e566d33932c74b516afb7856f0cd2563510d48f29f89d46b576a9576399e2a76feac00477d0b10350055a5b67a7fe667000ff41afafb149869074077f4b2a8feee82c6d034cfbc150e0be0314f23f74434fcc6de55534b240d163d1322dcacebcdb2ec26005f86ca9a107c1a6828713769754d65f740cc480e43237a40a1be9ab4baa8500c7e23e8c7797627cb9c0a39b6462f14078971d8ebbfd5b44f04f45879cf2595a6bb0c2b4a90c8d567f86d5e9d53cc9dd1bff21605de138ee13f735013b0fb891fc68698a10dd927a40347a2e1a422a10e132f3a7da049ff52b69fb015a3fdc976a68007d9a9a0fb1f3a0fb78c7955f688f38681315b5f537590d1e827019d9ff5ebf994fee62ed74eee4667d7071bfba58a318297f558fde5aab66cb5f65af8c7019f77be5df77c14a46ffcd0306a4c55a99feaf053c2d2ac74f26403cc534a4dc48adac4dcbab2b00e93ec4eb0e9052b6b56cdecd0d6b4d3f5699d0dba31d99bf7f9484b712ca8894e36045f6403b273363fed9b8797376b65fa74ef8205f0f36b4de6b421aad9304d7012dc270c55619f47315128afb65cf2a0bfc22da1b509951f577609bb0d16cffaa18992c9365ebf0d2ca34dd83c858c93a58792e8475e42fc3d92c3192af381a29ea950255e0ca0c7db42e62d8c2bcea6c7846c1410dfc53acd4406425cfad7c9a15b2d9f5e89e11d4a8df8639b83d371313e6cc546d8a61eaaa569c6fe1caad131827fb607cdbd74d846e0e2648fd888d9a77b40be1462fb80620168ad7f64abd512d30d141bcde81e784eb5535d0c0654a126c9951b1a9186eb060d98ff8e794461bfde095ae6fc742e98ffb6fde083d0365500de438d41728fbeaa26886bee8b7221e8128c90f87872dfe7805f6bef10debaa8810197117ddef508f406f54909e43d5c449048cf1f6514bd35111b424567506d606749b93f95b23edcbecfd395cd5640f5004c06876332a7b470098c8806c6fec6dfafdf9dacf382e2b35e3d7f6db357032575eeac90aa3756dbfe586acf90748213eca57c6c8594dffd59cd4392c1108556aef6af7dff5f7a7e4be4ee358d22628cbae6bebf6c8fb56feed8dbf72c971c3d2eded24392062e45533b28cbca5690ff8555c02108019c6c3371bb94e0eff95e37a5b7262df57ff229073f96864c895ef8e6d20ab2b0fb4e0fe03525e5381a2e69228a16317860206a27359045e361d3d1c7a8b09d262804b46bc93b655edacafb293dfef87edc8d98b92b403551d0fecc50451664f39fdae39474578edcc27e14acc82757c459112d33bc835258f688540032862d79c472e6b0a56e04cb2eb08ae6ccd830986ea2959cc32db9ca5c14210201a64ecd5eba2342dd59fa6283a66d37a6f18758e19cc2486fad8612ec55b8d38d829e17a990a578885d707cafc06fc1259e1c940538d44f75408795ceae58a76b23f35ce677ac4be57ae03e104391cb51359722e34747d3aa0c8d1a34b74b0b757639f0cb18f1951d0dc280d76a0dc6ab4188971a61c635052948af36c20ca0885092cc1c7304e44019eb508a58957067d9f2d8c5480f8ca85b4dc7300fc3fd0e055b03cd195ce5c3258417e836eebb173204cc8a3f0246f5931a1b732cf2aea36184bfe5a48096caca70a0fc567c5cb137a4a3dd870b82c821f5ea7757aacede469fb5c7097a8ff97400b95ed47db9c42ddc57a2138712fd4c90110f84dce956524effd8baae6b1c3c4295ae5fa44ce1e8b1094b3efb5672fddf589a300a5dfb26947cbec25af51d532f3e6eabd2f9129d46ea9094ff2bbb7678286c1b3fbeeed944f7b7144465cf5862fe900f5de11f30325f3b7aec86f90ceb923769c1a793668f27b23408a5e4c764cb9ac1671f7ae6f70cdc007df75744b32db1db3c5c344e25a44de7a625a8caa22b9b724c29347e3908c5e2ff41b681c9030581292b64a8c706174b7ca70b0d44f2b48263ec7ddefbad89c55650366fa7c6f95e036234648184a7a9bba20b8373a86bf939611b90d19941a4c0ad672249111a4e9a787138ab8b7dd119820d63db5999631ac0c8b6581e760886f13721ff95febbf565167f80d38b289a8b88990059fd6aef4b9f365a98f10c9f396ecf4ea4aee63daff5a3345a08dc3fb546a2c8e6fd280ac06706714339819f58ee5a6f8b653b2c9bb89623d608ffc349b88868fab92e1426a8e36811b747cd3b91b1fb76d4bbfd5ec8e68bdcc9d6c991cf27df35bde351ec82e6ed5babaf5fbad2720100365ab406894ab49bda574b5ec9be2c55000d7379079121cdb6f0f0c2fa8c71de45e638d3d94aa89aaee11210a36524d87768e0cc47d7d96951550394fb09e514c7ad87541063a24c42e0618429bb8e047bb2b9bc117ab28fd03537d4d2935072ceb9cc5d09a33877d7faa67c14052e66021bec67969d917dffa88f1fb511cf17ecf20f3637f3d082aa22325b28418bfb8ad9595e55a29fa9e34b4eb64dd8c1ddb3d6e5a6952b0bf57f234abba10c854560d0f7fd76fbd3c46ac3492f70c43adf3a3ade123ca5fe85a01ca074217a487f620d20b44dbf53d3ba53ad1af829ece714c9b2297255eed53cff3f90363f4efa04d4db5380f1cdf020e8aad80c225e432f650d7c70ab13295bee1f2cac7dd8b69c0643bdf3c280c38fa541ad19515456f33ef718ce30e69b85c98a070e1c0b194709feb219edab84e4112e823c44939fe897dc84d397f051c092143e71fe3bb860ba3ce8cb9d723308dfa6c686b330c194e6120511d85a87c10e14c74ea8adb043c0c3383e55c9273e7318e34ad05c216afda3b7dd39c0f9398f6e98f671fccaedf4c55edbefbfbf8864f8f8dc739e4343451b9823cfa6eb7fc50a504ad782c9590b532fad9c06700df2ee0b1b6659303891d0f9555c92b2d036308c0d24b6427ce7175862021f143c30fef08ad17b69904aaf807721214e4bd3de0b82770c22b6863e4ac273429f37be866d2ac45fa53e93a9d663a503f936526949d09242b44d1da41b8057ccd41cd92c743e1333dbfcd51cdbb3809eb371ad72bf371c9bbe2ead61b7f03fcbd85f76c3c8e4a413cce3912e2bd73f6067cd84c75c93b4b9f18feead33117863bb8096c64897cd8e7524f90fc5200aee21874e681918518a135946c2b2cfb6b779c21e90f3d62d448043ecae9c55ef8e3bea9ebd41b6efc940f837fc51a3272ff60b4d9f655ddc7bd0669b3496c056f3aa706fd2088dd420f7aed0f844752b676d26876d8af41a91d8466b337b018a1f01ba1c809e16c0da12c501e1b32cf0bb43802bdcc965b7ec1d619191c1472f990eaf473b9745d7b4f45c38c5250023b3797e3282a9f069fdd69221f66f97e70684276c5f17592956013e23d6ae94268dc216031eab666228283e2b93dedeacf7564bf80e87acdf35e0ad8268d94671d3dfa929773a1e4a1a69122b3ee989db738eb691d81f55be1989c18f53ce9858ed11ead92aa3833982b81cd2345bada396bc529af03e2581518a8e8672e07383db0dea9f865b85cc830cfbdd8d929620ed91a631477bd93e93cf0e27762c5e1e913f19bb4cba147bf5eecf23c1d8f9f4fda92f1562c3bdf7bf4deba428530b77673a8d3d6df0a2743667d41c84977f6d552981f98b99198327d6baededaff597bad2c35054e761275a9f4f61eabfab1690410226e92ef695fe0a48f9155615f0123b19ce1b664db703e8e422318d1dd76f7001ff8cb7ebecf07598e59e63b34cf07b77823b1ab00e00abbf14490e3808474783fbbf2e8f053abfe160b30abd94a908785c0cda37e73590a9894bfb4864df99b53c7b3aeaf838b7aeb81de86168b4421c5d65f7b6be4c0fbd9ce4dc4be0be4a0b986877c272704c370272b876fc7be8d6ac22079b7904bd27a78e3dc6925cf166c35797b3602b1f96580dce47e3231eaf02e06f8d07d49b20a7ef4180a8f5c59afd8e25be68f45600ccd791556c6eec3e63c33e472c36456f2e1bb3f643aaacc0c867dbc959f48ecd15b2dd0055be6d73a077637a16d7a5c8f52cc38213f0f15d85df91e15092c5bf33d8b18d1f73eee6031dca04ee360ef2d8ad14e200854216c559d73c6fd9b80a880a076e448766edb8a9be059f59968516c771b554c8e5c30d0380a2031ad21c117ad55d62255cf0da8cb8d00ca1ea05935750571af5814d0c198adf6433a4da9709082e4eaae6792cb6e6413219f205f4ce7e5ce35b7f57c0b26b1ba7ed79b02929d8e6d925fb7c98c28be1e391e8a8229ad8e6ac2928dc46bda0dfb47dca45c7d3294f72eda2cc65a28426156026d68f42b1412590e419fc9c3ce233306c67b36843fb47f88fec5da0e082d35ed1c749483af50495e084a72351c917bbe4b529c426aed41df13d4f75e83f8f1772501f50e086a64f5d99f41f42cb84dd41ce7661ae4833386b3da9dcdec07978b3ecb49ec3487ff5255b362db547fa4a51a60ad7e10cced137f55ccc6cc2ef4e24a363e498221d973f8fe9971d9fe5e4c1625be8dd423084ad5d2e6915f3674acff38efa053cb71f82aeee9be9a78008e110eb55260445fcc2e6104345f71c74731f7688840eb6129e6ecb7be840d9c7bff027a9831e9d53d41109174a8876d468c187406dfda1005162a12356a5c5ed4985544cf00d9dca1472af7f8263242ed49f1f18b13e32c9454ffae02d19fa1258a5bfcf49b50167d241f8ada9ced3ef48f78fce5f74ae8baeb8543d67b6220e68f2335b9248aacafac1fc71288d24297e2287cf13a757298833fcc81cac4dd6f636d00a2a3299609f8b2f2bf8d5d2b0fda5b2e7dc3187ef66edb61b161ebb33b91507fa696c22496f033a5474d55b669d98e3c41560f352c5be203b330134e7503852977fb41864d89effc6f0e864ebb811a761b87c783884683998136efd6de334c305b763b663ad7062c4c7382e2c1ec7c9734e81857434092886d7aa0e6e0b2e6af418932ed0b9975583acc0b39b6a13b69bb9f4d561a573af19785c3780f949b8fe01df1b078c942b9acad00ca84ade316b3951d68b017bb08952488bbe556063d6bf289d4cc3270463b210feaefe0aaef73e49b1ffdc0a6604052b5acc0c6bc9b0542ecef20db5db3f892b871fe04f4619dab49c405558958bfe8e72adc683acad98ab23d35d2ee144d72ccb863fbf647950f8cc80fa2787d06a4da8aeb33f65518fabc21d4647ac2526712bec6cf6824a42f4365668c2432c813c41ec4c23e3c82c60e2fffc5be1f7e14e0258c23bec3f4a6b3e492dc83bf559dfb815278e1b516106dc9efb3ef69d384c04c34071b81a75a0e0f2f0856fa0f195ce2aa5d6c8df65e194e43f8a3de86bff31862df5ee365960c33891ecca7f9855019c43c23c2a7baa134d5d5c16d8b5d8c601e00543c99dce8e987d6efc1b20ab2fbd1dbe7afce6d1223207660108b084fd9f2168efcef5be8fbe6f0a9cac045e70297a6e7e01b08ae40c7685f6834c2b8b232f1ebae386e167a69b35ac32c54630125b353dd7ce06ba3fb0446b6bf8b3f6bc2c512c4a600d1762ce7b621908a57e27dbf4ba22a7163e4279973fb1ab58c25a7dfe894024a2ece11a24056d6174684a7994fdcd0180161278fc29b4d303cdecaee7639eedee313f5028f3df4658adbf173d651a98086b6a323a95eff55b5f29c89f5594db6db4f0c197363cfa46a10469fda4c124d8f6c4e86a83071e2780beefb9678847aeba8d74795826315e3fcf015e0ad7a0f3ca02bbd561941f8d49d3ab5846bf1a25fa9ed5669637d6475f3df8883562831a0bcbaae2b5b5f03f487a59030a5c49622880431e2a8216a5d230e67d010b22b472a890c0b6d5e0636141c8a6af8e2e6d4a77bc7795dd8ac53076ee5402cba0aabbc08a9838e7ef1f5c205b6ed3b350fb52cc7c2a6a788e50b17346a9d2468538b5ba61921ccd61efc905c3cb1f547d75859a12f12cec32f9ef97f8ed3ac92bf2fd80ece19e4f11151b12d9d50d70bdb71fd30571c4dad3221aa4ac497f9143177e93d8b41e4b4720a3c7ad30e23b94d90f9513ba069d8076cda0fff81411884c546c169ee9c556629e8329ede34a920679db52ab20b50cd0666fee113cad692592b704e9e2a2d0296ef79ff8aa68ff2af57f731d2e07b97d","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"e51cb6d05ed027db058edc159e71b81e"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
