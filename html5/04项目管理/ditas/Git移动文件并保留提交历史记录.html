<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content="一个文件被移动或者改名后，前面的一系列提交记录都没了，可使用右键拖放，选git move versioned item here等，再做一个单独的提交，即可保存下来"><title>Git移动文件并保留提交历史记录</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="Git移动文件并保留提交历史记录-DA6855B4"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">Git移动文件并保留提交历史记录</h1>


<div class="body conbody"><p class="shortdesc">一个文件被移动或者改名后，前面的一系列提交记录都没了，可使用右键拖放，选git move versioned
item here等，再做一个单独的提交，即可保存下来</p>
<section class="section"><h2 class="title sectiontitle">移动</h2><p class="p">一个文件被移动或者改名后，前面的一系列提交记录都没了，可使用右键拖放，选“Git
移动受版本控制的项目到当前位置”等，再做一个单独的只做了git mv的commit提交，即可保存下来</p><p class="p">From the <a class="xref" href="https://tortoisegit.org/docs/tortoisegit/tgit-dug-rename.html" target="_blank" rel="external noopener"><strong class="ph b">TortoiseGit documentation</strong></a>:</p><p class="p">If
you want to move files around inside your working tree, perhaps to
a different sub-folder, you can use the right-mouse drag-and-drop
handler:</p><p class="p">A. select the files or directories you want to move</p><p class="p">B. <strong class="ph b">right-drag</strong> them to the new location inside the working
tree</p><p class="p">C. release the right mouse button</p><p class="p">D. in the popup
menu select <strong class="ph b">Context Menu → Git Move versioned files here</strong></p></section>
<section class="section"><h2 class="title sectiontitle">移动并且重命名</h2><p class="p">使用右键拖放，选“Git 移动并更名受版本控制的项目到当前位置”</p><p class="p">Remember one thing: <strong class="ph b">Git tracks file content only.</strong></p><p class="p">From Moving Files section of Pro Git book v2:</p><p class="p">Unlike many other
VCS systems, Git doesn’t explicitly track file movement. If you rename
a file in Git, no metadata is stored in Git that tells it you renamed
the file. However, Git is pretty smart about figuring that out after
the fact</p><p class="p">And, moving and rename is the same thing in Git.</p><p class="p">So, <strong class="ph b">Git detects the moving/rename automatically only works
under the premise that those files are not modified</strong>.</p><p class="p">Git
does these things when you moving/rename file only:</p><ol class="ol">
<li class="li"><p class="p">A tracked file is deleted, git gets the SHA-1 of that file
content, assume the value is abc.</p></li>
<li class="li"><p class="p">A untrack file is added, git calculates the SHA-1 of that file
content, assume the value is abc, too.</p></li>
<li class="li"><p class="p">If you commit at this moment, git will figure out they have
the same SHA-1 value, then treat them as a rename.</p></li>
</ol><p class="p">Suppose you modified some tracked files and also moving them
into other folder. Then, unfortunately, git can not detect them as
rename/moving automatically when commit.</p><p class="p">If you really want
git to track rename/moving automatically, <strong class="ph b">you need to do</strong>:</p><p class="p">Make sure you DO NOT modify the file(s) and only rename/move file(s)
in one commit.</p><p class="p">If you want to modify file and move file at the
same time, and want git to detect them as rename/moving by using TortoiseGit,
then in your case:</p><ol class="ol">
<li class="li"><p class="p">Right click on that file, and click TortoiseGit -&gt; Rename...
item of context menu.</p></li>
<li class="li"><p class="p">prefix new_folder\ to the filename, see: <img class="image" src="../../_images/2022/git_rename.png"></p></li>
<li class="li"><p class="p">commit</p></li>
</ol><p class="p">Note: you need to rename files one by one. Suppose lot of
work to do. So, better rename file only.</p><p class="p">Note2: If you modify
a lot on file, git can not figure out it is a rename/moving.</p></section>
<section class="section"><h2 class="title sectiontitle">查看移动文件之前的日志</h2><p class="p">Tortoise git default settings,
showing us just actual files history. I meant, if you rename of if
you move any file or folder, you can not see history. For the seeing
history, you have to click below check box on the TortoiseGit settings.</p><p class="p"><img class="image" src="../../_images/2022/git_showlog.png"></p></section>
<section class="section"></section>
<section class="section"><h2 class="title sectiontitle">参见：</h2><ol class="ol">
<li class="li"><p class="p"><a class="xref" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwilnYysuLb7AhWDTGwGHaN-BMcQFnoECAgQAQ&amp;url=https%3A%2F%2Fwww.zhihu.com%2Fquestion%2F343864410&amp;usg=AOvVaw2zzx_0cFoHwzEZzHm31dHk" target="_blank" rel="external noopener">tortoisegit怎么保留文件移动前的提交记录？ - 知乎</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://superuser.com/questions/980139/tortoisegit-moving-files-to-new-folder-not-recognized-as-move" target="_blank" rel="external noopener">TortoiseGit: Moving files to new folder not recognized
as move</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://stackoverflow.com/questions/61817814/how-do-i-move-my-working-directory-using-tortoisegit" target="_blank" rel="external noopener">How do I move my working directory using TortoiseGit</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://stackoverflow.com/questions/10828267/can-git-restructure-my-folders-without-losing-history" target="_blank" rel="external noopener">Can Git restructure my folders without losing history?</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://stackoverflow.com/questions/2314652/is-it-possible-to-move-rename-files-in-git-and-maintain-their-history" target="_blank" rel="external noopener">Is it possible to move/rename files in Git and maintain
their history?</a></p></li>
</ol></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="%E4%BD%BF%E7%94%A8TortoiseGit.html">使用TortoiseGit</a></div></div></nav></article></main></body></html>