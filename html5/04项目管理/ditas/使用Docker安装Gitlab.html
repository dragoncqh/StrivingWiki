<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content=""><title>使用Docker安装Gitlab</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="使用Docker安装Gitlab-2EAE1F17"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">使用Docker安装Gitlab</h1>


<div class="body taskbody"><p class="shortdesc"></p>
<section class="section prereq"></section>
<section class="section context"></section>
<section><ol class="ol steps"><li class="li step stepexpand"><span class="ph cmd">Install Prerequisites</span>
<ol type="a" class="ol substeps">
<li class="li substep"><span class="ph cmd">Due to a&nbsp;<a class="xref" href="https://github.com/docker/docker/issues/23347" target="_blank" rel="external noopener">known issue</a>&nbsp;with the dependencies of the docker .deb,
installing docker on a Debian/Ubuntu VM requires an additional step:<code class="ph codeph">apt-get install dmsetup &amp;&amp; dmsetup mknodes</code></span>
</li>
</ol>
</li><li class="li step stepexpand"><span class="ph cmd">Install Docker</span>
<div class="itemgroup info">Use the Docker-maintained install script for Debian or Ubuntu.
For other operating systems, see the&nbsp;<a class="xref" href="https://docs.docker.com/en/latest/installation/" target="_blank" rel="external noopener">Docker Installation</a>&nbsp;guides.</div>
<ol type="a" class="ol substeps">
<li class="li substep substepexpand"><span class="ph cmd">Run:<code class="ph codeph">curl -sSL https://get.docker.com/ | sh</code></span>
<div class="itemgroup info"><div class="note note note_note"><span class="note__title">注：</span> <div class="note__body"><p class="p">The current version of the docker script checks for
AUFS support and displays the warning below if support is not found:</p>Warning: current kernel is not supported by the linux-image-extra-virtual
  package.  We have no AUFS support.  Consider installing the packages
  linux-image-virtual kernel and linux-image-extra-virtual for AUFS
support.   + sleep 10<p class="p">This message can be safely ignored, as the
script will continue the installation using DeviceMapper or OverlayFS.
If you require AUFS support, you will need to configure a&nbsp;<a class="xref" href="https://www.linode.com/docs/tools-reference/custom-kernels-distros/run-a-distributionsupplied-kernel-with-pvgrub" target="_blank" rel="external noopener">distribution supplied</a>&nbsp;or&nbsp;<a class="xref" href="https://www.linode.com/docs/tools-reference/custom-kernels-distros/custom-compiled-kernel-with-pvgrub-debian-ubuntu" target="_blank" rel="external noopener">custom compiled</a>&nbsp;kernel.</p></div></div></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">If necessary, add the non-root user to the “docker”
group:<code class="ph codeph">sudo usermod -aG docker example_user</code></span>
</li>
</ol>
</li><li class="li step stepexpand"><span class="ph cmd">Run the image</span>
<div class="itemgroup info"><pre class="pre codeblock"><code>sudo docker run --detach \
    --hostname git.eduhe.com \
    --publish 443:443 --publish 80:80 --publish 82:82 \
    --name gitlab \
    --restart always \
    --volume /srv/gitlab/config:/etc/gitlab \
    --volume /srv/gitlab/logs:/var/log/gitlab \
    --volume /srv/gitlab/data:/var/opt/gitlab \
    gitlab/gitlab-ce:latest</code></pre></div>
<div class="itemgroup stepresult">This will download and start a GitLab CE container and
publish ports needed to access SSH, HTTP and HTTPS. All GitLab data
will be stored as subdirectories of&nbsp;/srv/gitlab/. The container
will automatically&nbsp;restart&nbsp;after a system reboot.</div>
</li><li class="li step stepexpand"><span class="ph cmd">Upgrade GitLab to newer version</span>
<ol type="a" class="ol substeps">
<li class="li substep substepexpand"><span class="ph cmd">Stop the running container:<code class="ph codeph">sudo docker stop
gitlab</code></span></li>
<li class="li substep substepexpand"><span class="ph cmd">Remove existing container:<code class="ph codeph">udo docker rm gitlab</code></span></li>
<li class="li substep substepexpand"><span class="ph cmd">Pull the new image:<code class="ph codeph">sudo docker pull gitlab/gitlab-ce:latest</code></span></li>
<li class="li substep substepexpand"><span class="ph cmd">Create the container once again with previously specified
options:</span>
<div class="itemgroup info"><pre class="pre codeblock"><code>sudo docker run --detach \
--hostname git.eduhe.com \
--publish 443:443 --publish 80:80 --publish 82:82 \
--name gitlab \
--restart always \
--volume /srv/gitlab/config:/etc/gitlab \
--volume /srv/gitlab/logs:/var/log/gitlab \
--volume /srv/gitlab/data:/var/opt/gitlab \
gitlab/gitlab-ce:latest</code></pre></div>
</li>
</ol>
</li></ol></section>
<section class="section result"></section>
<section class="example"><ul class="ul">
<li class="li"><p class="p"><a class="xref" href="https://blog.jamespan.me/2015/07/25/docker-on-the-cloud" target="_blank" rel="external noopener">阿里云、Docker 和各种折腾</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://gist.github.com/ouyangzhiping/47fcbf26d213146407f2" target="_blank" rel="external noopener">docker-gitlab部署</a></p></li>
<li class="li"><p class="p"><a class="xref" href="http://www.cnblogs.com/wanpengcoder/p/6394871.html" target="_blank" rel="external noopener">阿里云ECS安装Docker</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://www.linode.com/docs/applications/containers/how-to-install-docker-and-deploy-a-lamp-stack" target="_blank" rel="external noopener">How&nbsp;to&nbsp;install&nbsp;Docker&nbsp;and&nbsp;deploy&nbsp;a&nbsp;LAMP&nbsp;Stack&nbsp;-&nbsp;Linode</a></p></li>
<li class="li"><p class="p"><a class="xref" href="http://doc.gitlab.com/omnibus/docker" target="_blank" rel="external noopener">GitLab Docker images</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://luowei.github.io/docker/docker-gitlab-config.html" target="_blank" rel="external noopener">在阿里云ECS上使用Docker快速搭建Gitlab</a></p></li>
</ul></section>
<section class="section postreq"></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="Git.html">Git</a></div></div></nav></article></main></body></html>