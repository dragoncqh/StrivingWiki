<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content="VS2008编写DLL文件，并进行调用，整个教程每一步骤都附有图"><title>VC2008编写和调用dll</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="VC2008编写和调用dll-41282F8D"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">VC2008编写和调用dll</h1>


<div class="body taskbody"><p class="shortdesc">VS2008编写DLL文件，并进行调用，整个教程每一步骤都附有图</p>
<section class="section prereq"></section>
<section class="section context"></section>
<section><div class="li stepsection">第一步，vs生成dll文件</div><ol class="ol steps"><li class="li step stepexpand"><span class="ph cmd">打开vs2008–&gt;新建项目–&gt;项目—Win32—Win32项目，项目名称为MyDllTest–&gt;确定</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls01.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">直接点下一步，然后选择DLL（D），点完成。</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls02.jpg"></p><p class="p">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </p></div>
</li><li class="li step stepexpand"><span class="ph cmd">右键解决方案中头文件选择“添加—新建项”取名叫Myh,点确定</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls03.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd"></span><br>
<div class="itemgroup info"></div>
</li><li class="li step stepexpand"><span class="ph cmd">在Myh.h中写代码:</span>
<div class="itemgroup info"><div class="p"><pre class="pre codeblock"><code>#ifndef DllTesth_H_
#define DllTesth_H_
#ifdef MYLIBDLL
#define MYLIBDLL extern "C" _declspec(dllimport)
#else
#define MYLIBDLL extern "C" _declspec(dllexport)
#endif
MYLIBDLL int Add(int a, int b);
// you can also write like this:
// extern "C"{
// _declspec(dllexport) int Add(int plus1, int plus2)   
//}
#endif
&nbsp;</code></pre></div><p class="p">如图</p><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls04.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">在源文件右键添加新建项，选择def，命名为Mydef,写入代码如图</span>
<div class="itemgroup info"><div class="p"><pre class="pre codeblock"><code>LIBRARY    "MyDllTest"
EXPORTS
Add @1
</code></pre></div><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls05.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">在解决方案中打开MyDllTest.cpp,写代码如下，即该DLL实现简单的加法</span>
<div class="itemgroup info"><div class="p"><pre class="pre codeblock"><code>#include "stdafx.h"
#include "Myh.h"
#include &lt;stdexcept&gt;
MYLIBDLL int Add(int a,int b)
{ 
	return a+b;
}</code></pre></div><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls06.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">然后点击生成解决方案，输出成功</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls07.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">这样就在当前项目下生成了DLL文件和lib文件，我的项目路径为:D:\My Documents\Visual
Studio 2008\Projects\MyDllTest打开Debug文件夹，如图</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls08.jpg"></p></div>
<div class="itemgroup stepresult">可以看到生成的MyDllTest.dll 和MyDllTest.lib文件</div>
</li></ol><div class="li stepsection">第二步，调用dll文件</div><ol class="ol steps" start="10"><li class="li step stepexpand"><span class="ph cmd">打开vs2008新建项目，C++--win32项目---win32控制台应用程序，取名DllTest点确定</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls09.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">点下一步，选择控制台应用程序，点完成</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls10.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">首先配置环境，在vs菜单中点击项目，DllTest属性，在配置属性， C++，常规中选择附加包含目录，将MyDllTest项目中Myh.h文件所在的路径添加进去，我的路径为D:\My
Documents\Visual Studio 2008\Projects\MyDllTest\MyDllTest</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls11.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">在配置属性， 链接器，常规中选择附加库目录，将MyDllTest项目中MyDllTest.lib文件所在的路径添加进去，我的路径为D:\My
Documents\Visual Studio 2008\Projects\MyDllTest\Debug</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls12.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">在配置属性， 链接器，输入中选择附加依赖项，将MyDllTest.lib添加进去，如图</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls13.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">此外，还要将之前生成的MyDllTest.dll文件和MyDllTest.lib文件一同复制到DllTest项目中debug目录下，如图</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls14.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">Debug目录需要刚建好项目的时候提前生成一下才会有，最后一步在DllTest.cpp中写入如下代码</span>
<div class="itemgroup info"><div class="p"><pre class="pre codeblock"><code>// DllTest.cpp : 定义控制台应用程序的入口点。
//

#include "stdafx.h"
#include "iostream"
#include "Myh.h"

using namespace std;
int _tmain(int argc, _TCHAR* argv[])
{

	int a = 10;
	int b = 20;
	cout&lt;&lt;"a + b = "&lt;&lt;Add(a,b)&lt;&lt;endl;
	return 0;
}</code></pre></div><p class="p">如图</p><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls15.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">点击生成解决方案，成功1个。</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls16.jpg"></p></div>
</li><li class="li step stepexpand"><span class="ph cmd">然后按ctrl+F5进行调试，会弹出如下命令窗口:</span>
<div class="itemgroup info"><p class="p"><img class="image" src="../../images/2017-12/vc2008dlls17.jpg"></p></div>
<div class="itemgroup stepresult">VS2008调用dll结束</div>
</li></ol></section>
<section class="section result"></section>
<section class="example"><h2 class="title sectiontitle">参考资料</h2></section>
<section class="section postreq"></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="CPP%E5%BC%80%E5%8F%91.html">C++开发</a></div></div></nav></article></main></body></html>