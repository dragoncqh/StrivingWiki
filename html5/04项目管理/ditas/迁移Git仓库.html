<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content="Git仓库迁移而不丢失log的方法"><title>迁移Git仓库</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="迁移Git仓库-30661E8B"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">迁移Git仓库</h1>


<div class="body taskbody"><p class="shortdesc">Git仓库迁移而不丢失log的方法</p>
<section class="section prereq"><ul class="ul">
<li class="li"><p class="p">要求能保留原先的commit记录，应该如何迁移呢？</p></li>
<li class="li"><p class="p">同时，本地已经clone了原仓库，要配置成新的仓库地址，该如何修改呢？</p></li>
<li class="li"><p class="p">注意：如果使用了代码审核工具Gerrit，那么在进行操作之前需要将Gerrit关掉，等成功恢复后再将Gerrit开户即可</p></li>
</ul></section>
<section class="section context">使用git push --mirror</section>
<section><ol class="ol steps"><li class="li step stepexpand"><span class="ph cmd">建立新仓库</span>
<ol type="a" class="ol substeps">
<li class="li substep substepexpand"><span class="ph cmd">从原地址克隆一份裸版本库，比如原本托管于 GitHub，或者是本地的私有仓库<code class="ph codeph">git clone
--bare git://192.168.10.XX/git_repo/project_name.git</code></span>
</li>
<li class="li substep substepexpand"><span class="ph cmd">然后到新的 Git 服务器上创建一个新项目，比如 GitCafe，亦或是本地的私有仓库，如192.168.20.XX</span>
<div class="itemgroup info"><pre class="pre codeblock"><code>su - git
cd /path/to/path/
mkdir new_project_name.git
git init --bare new_project_name.git</code></pre></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">以镜像推送的方式上传代码到 GitCafe 服务器上。 请确保已经添加了公钥到新的机器上<code class="ph codeph">cd project_name.git </code> <code class="ph codeph">git push --mirror git@192.168.20.XX/path/to/path/new_project_name.git</code></span></li>
<li class="li substep substepexpand"><span class="ph cmd">到新服务器上找到 Clone 地址，直接Clone到本地就可以了。<code class="ph codeph">git clone git@192.168.20.XX/path/to/path/new_project_name.git</code></span></li>
<li class="li substep substepexpand"><span class="ph cmd">删除本地代码。<code class="ph codeph">cd .. </code> <code class="ph codeph">rm -rf project_name.git</code></span></li>
</ol>
<div class="itemgroup stepresult">这种方式可以保留原版本库中的所有内容。</div>
</li><li class="li step stepexpand"><span class="ph cmd">切换remote_url</span>
<ol type="a" class="ol substeps">
<li class="li substep"><span class="ph cmd">查看remote的名字<code class="ph codeph">git branch -r</code></span></li>
<li class="li substep"><span class="ph cmd">remote_git_address更换成你的新的仓库地址，<code class="ph codeph">git remote set-url
remote_origin_address remote_new_address</code></span></li>
<li class="li substep"><span class="ph cmd">也可以直接更改.git/conf配置文件里的ip地址就行。</span></li>
<li class="li substep"><span class="ph cmd"></span><br></li>
<li class="li substep"><span class="ph cmd"></span><br></li>
</ol>
</li><li class="li step stepexpand"><span class="ph cmd">windows下的操作命令备忘</span>
<div class="itemgroup info"><pre class="pre codeblock"><code>git push --mirror root@47.52.172.211:/home/git/gitrepo/DevicePortal.git

git.exe clone --progress -v "D:\DevicePortalUA" "D:\Repo\DevicePortalUA"

git clone --bare "D:\DevicePortalUA"

git clone --bare 350775.cicp.net:dp.git
git clone --bare root@350775.cicp.net:dp.git

本地：
从原地址克隆一份裸版本库，比如原本托管于 GitHub，或者是本地的私有仓库
1,git clone --bare "D:\DevicePortalUA" "D:\Repo\dpua"
2,su - git
cd D:\Repo
mkdir DevicePortalUA.git
git init --bare DevicePortalUA.git
cd D:\\Repo\\dpua
git push --mirror "D:\Repo\DevicePortalUA"

然后到新的 Git 服务器上创建一个新项目，比如 GitCafe，亦或是本地的私有仓库，如192.168.20.XX
远程：
cd /home/git/gitrepo
tar zxvf DevicePortalUA.git.tar.gz

git clone --bare 350775.cicp.net:dp.git
git clone --bare root@350775.cicp.net:dp.git


1,git clone --bare "F:\Bank_Bridge" "D:\Bank_Bridge_bare"
2,git init --bare Bank_Bridge.git
3,cd  bank_Bridge.bare
4,git push --mirror  "D:\Bank_Bridge.git" 

1,git clone --bare "F:\BankBridge" "D:\BankBridge_bare"
2,git init --bare BankBridge.git
3,cd  bankBridge_bare
4,git push --mirror  "D:\BankBridge.git" 

1,git clone --bare "F:\StrivingNote" "D:\StrivingNote_bare"
2,git init --bare StrivingNote.git
3,cd  StrivingNote_bare
4,git push --mirror  "D:\StrivingNote.git" 
</code></pre></div>
</li></ol></section>
<section class="section result"></section>
<section class="example"></section>
<section class="section postreq"></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="Git.html">Git</a></div></div></nav></article></main></body></html>