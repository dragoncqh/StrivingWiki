<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"ac3ad9ca41b43aa6cf389fb80b349c3d5ca959cb1040545d106382a8f09f96cb56f46587789ef1b71d71ac6590b8d400b6e987386c7ac97f34ccd5a4cc9307891eb1fdd90dab836ccee431dc77b383d2243ee780aaf1b76031f354afb33fc4fa7accd4cbc5a96426c6b29da6dea7ad6a2007bf9bbbcd7c711bea9573c33ed2d2e7113eb41744a58207177d0714f0931bca8b9712d8492dd22169945cb64976b196c9158e6adbb156e13c9030bd3c40af5a01d73ea5180ab46792ede7f14cf2d03a85592803fe7916b8b51588c438f2b6a8cb47d1b955bad851a325524e6fe95ae9b041aabaf35db5967c9ac679d9a91fb0fc288cca46db547094f094d25fa45849e3fa9fadc4063b2a24b5d00191cfe07b01d7906d61c4e893fd9d7d08291be7191e40b91c3ef65ddfc860f6780b23b525fb81cb28711e83c7b65567ec4b67e2e0cc63cd98e86e67ca35cc8f55f24d5aa11d3cb84fd06876ef6c514f9ae5caa532daed307e60799167122bb1d0a1e6c5c520a5661297d95db369ade500ed5efe48023678e19f7412e1f1ce095af6c953ae2367dedefb84e67ae800de3f855e67ce551e5ba0599d1cd616d8052b986b6f9b226af9dbdedae584ca6e80764c162edaf281ff1f725a45090a13f016b03a2c13c7ef94660b5c6441ea1a8f5253e99ec1152fed795fe9eb93732d37e3faf91f14896457277c79282afa275b30f41d6e640ff46b9e3fd674fb29acf28bdbc045fd222e7e2065460ee1a0aa3b3dc06fc84c5ba890514d918ea71a09e65cbc2ae2521b8071e9aad0ef34d8233441cd4cf8ba5019f54e0bcc77cc5eed87162262f4e5b424c7988e8bd3e757c5f6e2864497be515416e2e67511c7ac21de639e19db76d7320115527fde9aa9547a5a6f2947d84322f8821971e933839d116dd46734896e15e020b108f3906e384d1affaecd51a591c56624c80c039357705bd8b315f1d9d691b47bf54f3b9157aad3e9b33559426999d1080497d4204b3e3ce5d65e945eca2a439c3b34ca89ff6c8daed1c07093c91649f4c1397eb87eaf56b7faf3ef904c98972184d81433ec7e2b6c69ffcadb13d15486f58ed52a85db81c341e625427db98808267d7a1120388b72b5e0aa9efe7e17f2bfb8d1ed97ee00a4204b69810c1b35c854bcb18660bf922cad95764250199030db2050a5fa8dbcd4916ae685a7ea7c0956f2a52cbc2f9060c7cbbb3d7bb04ce8d927a636e566f7411de07ea543bb316ab5e0535b5145238af99b07fa6b61bd2bcc35a73e3fb06d37854064cfaa7d1220baee176afde3245ae08af4515ff9e1264242467978a7bc42d29a435fb11af52b58dcad5bbd3dc4a74d686a93a0ffd2ae992b8b3df49d08559a38fd72af73134f4e8aafdda0e06ca1a42a7e69141cf16d248208615472c6d6afdc0cfb2402c11c2f3f203946240ba7a6b37db83becf32a55a6e40b0ab34e749c2c4da215dad244aa7494d64cfde344f057ed78f96c4ff815fd7d161a2836a63e660b75b424fc2c294172fdac1ddcd35403618d355449a51a1f8abf79db794897e4fd4cb0dbc06899f2f2e1070ebe933f5a0a688abe57dd828c867d973fed57e4f81d2f915974a9448cf18743f4803611abe5df3b404294088b14b8b9ff0bcec4ad3c6aff8ed52cb00c2e11052d3dbf265a68f5d8dcb2a95771113ece061d11334665ada61aa9e9c73b2a7135c6a94d962459841fc62ce4cdce74db1fb683208992b4ae53e37cc9cde6de1d850643c304a9b6c944199326d97bd5bc1f2b9ccceedcaa588929cc9a8a8b8336468701ac1e47ecbdc57e9bb84a0e31e661718907593e40523c7cdc051dfd12fa85549d2e9362ffd6f5184c805df46ca99cf839eb6ab97df8a438bed071ca2f80b6b4fa288412fdb60a15e195e27492600d681642228b160ae5497909d05ec5e78005bac4e2d37d3ac71f142ec00c472b5bcb6006152473d7f67b9812b100ff7519e8689ec9db940d7ce58120b349584b6b6ca4ab036865f9dacf6fa69f8677532a1e7a041912c7bec882546064576804aa37e58be8fe1e3c9f1a0ed80bbbd016f0e4eeb990129adaa0877ff90f95c7b3ddaefb3495547c20d22d0b9d03b9fc0cd376034d3d0569b094b4f0859458d9b99cee3a8f6cd087a7e9948da09d07e6bb4c6901ad2790da5adced858da6edfc2fda55b7bdff13b2977604cb42edf40601d9ff88d1cfe38fae05dc25345d86fb44aeccc9cc6fd00def405df2b2c6bf055209678411cbe3bb6540c6aa222adfede5993e2b2ebc02503bf844f9d5233729f396eb8b7fa5ac7807fe5567b98317fde9f3ece2ce571ce35a30326342690a453a31ab73577f6fa99f440d15ba55f7476e9359c6918ec60c5e6bdf808a65e9f46a3ee9ae026b7645902d85ccd3233f9de8a893a5733b916f55fdab6b77a093d5e4c4149e962a2c39f5c0fd93472c6a03ca4de8877f3d789d205b084db1805de889a120c5bf7a4e071b9be5ddebb8d237d0f7a92f2a6c8da6328a53656ba66932abbc428370ca73b189c03f35ce894a314f35dcf010f46520862cd91c7670a6efed067f481cb1f3a824dc57b96061e721442a6a17140fca39c5d6f2b4908139e40ec92deed6a73e0cdd875dc4e55dc651ceec496a03cc3923493d1cd109b337f431c17b2078ba8875579d380a54eca8068b0c9f6e9bd1c8f7ff4ec509d35cfd24fa1a8a4a61e753510558c30db4fbf651cccb0824499d1cb83aaba851f247e491f8a3d806b57186cb90b557ffdee03530568d2258f4c4b79122260cab2176999fad580cc2bc9ebcf2a2c8f0043e6469509d97301fc92649d2a610ff52a78a01f70609f970376399055465c6ce2bfc4c11ff2b924a42379a8de6bfc96bdb0f1565785acc99d73cdb658fffe924310130b027f295bad3cd8b1fdecfe94fe6e1ee74bdd4bcdd2b61ce886553b0a8d645ca284fcc0f67d4cb4711b9b047340f85c8a18017cbda9199813c67d019f38ccbfb6ca41b9036ddfab3ffd51a9fafa3b92a53aa163d93d723a270fd07d077534c7aa2ac21395d1daa8be3553b9de578fb03c93262601c3155fcdf470ce866d4c04b0c93cd84cb29546ef501bbeef00a63380a660c93af1a2c0b216709560b8167ddf8a9363538189ec78926b82f28c1d1b3ded27cd0d8996989a56fcab346f3da5de1e877108361f612f703ef9989cac29e3c085ca66337b0906f6de76b47a1a1ad31ba9b255df9e4f66ffe44b06a513c8ae0b89c1b00050ae7c44165b4cd4ffee4da0d15aba030e6b4119f4a91457f3ae6cdd0bb9d28576d39be77fe78e857f47ff20691eb5ed524c2caac4b0c83ca84fb5e25ee8a4a69235c93c0cd28459978bcd90d4ad5eaee3a0360183969ec0bb5bed2ff51bcfe20801c3e819ac4edec6a506e03aecc7c0ac7c91a7ec8ce8851a7ff53e8ab875eb316362a0f480083858a55b8e16c2f66541111d18b6949a8ca81a5bb7c36a18548fe996a8bb28553c052a8ca3c4bd542dd4775dbcb5bcf111129fbdd7d28451bba2c4b27fe2d7ff147b7097db49a4489fb26c9727ae3d128fb9779d4152d4513b3a451aa867bae2b716b8ccd27f3f03c31c232dd3dcb95855b673500501db7c3504127b733389d93ceea1bd8d9e19df808ce270c329c74202818f4feef2779f2feb6511d49d0323c39b0a7481c2ab1c820eab4f34da9861a2ecb490f5ceb36c8041a759c0d3a8b5556a954649433b026f4366fef15a232d65ed296d88789552a0862b455b1135178a1c4f91772b4ad53288a675fc83d3ff6b991e4033d99eb14c46deb849bf7778f4821b9e3572902886aa63f86af764eda74fa7b805a5d66ab9de4611a93b82ee5914b4dedb8e0c07557b4238b04c5cac52ff067ae477e5b9acfc349030f84d67d4ffe427cdc85f96753cfbd198fa59a8dff43dd1bebf203fac6c6d12af4ca3a10798f92775e5f872537f05d7ce1f1688bdf73ce644ec6664a02b4251ea9f68276f396e5a367c8fc589f89c780eeefa078e46033088015301df8ed751a947395afed0c7c427cd4a2505394d581ebd95abf5912b520ebe86409fdc3547ec153e568e290275519b1081b551590d4266929d2ef0ac81de91e3bf270233c956bf20b8448e871da5dfac6bf141bd5d89e44b9022f301ae9302c21346e766af2917fec444bb9c1817822c1ea8da16d6d7ca4e59e11073d78281c7c36d8cef6f65198a2fbeafffd0a6a0314b80544745d17fc0cb958e852795383cc588cdfaec435ff849617afc07f029f2ac4b62f2408417df33edd9fe3c459e006e049c356584d9e198edfa88196cad8ac405aae70dae99d5d9eadac596730b0481513cb768041ed4296b96bd58a054a6b1d1500de12af47a5034ee6e77d5c50e37a5502a3292ac078b2cfa2b17f51af7e9e5b0e2d90c07a99c83c580cdf359c59fb7b4cf1aff23c51966833e5080654307aa98f60a6f69b4b253da270e8652cbc056c70121a814d09d3da54de51a440c38873364aca0699dd8721e2f0361d8e1a74d48149409b5916a01df6418642aa14961272e62121649403a7dce6c1806a6165b1c3ca4b2eab4457f321966755b1c4d0f40f174065509e8f931cc3428b712b82c581bfe2f4f938fc79f235bf6b08324ee6bb10996bd7139497533d58e0e842f2a8d947e319f29b761e47fbe4965db87d962514aa38294bd7daa1731d8d7cdfec221b87824d795a7c1346340e292361cbbb12bbbf54fecfb5e97889f577559cdfcaf083e41269f3307b86e40a500f0aa8270f4ae6373e335e866c80623dcbaed273f3fd51ed5be63c14a9ccdb7ea4b9d2de621e4bdc4667bf3fd8e63ade5ede974d671deabf499a63e85f2c0c82a9909625e2f39d96889482f7096e138b4fdacde44c939510e132b3db7b4556073bc3f41e6c7e03d515bad3934c1337639af2536bfd4508250cbfc32fd0f88020cc1e8fcfe1c21079ca018229d3c6bb9f4203fda6de764db73d28e6c38257ed9c1ad6148132ad6861f4ee1998fab78110a3a19d77e7de24465a04846f581dca46704a0a1fd67bcd729026a0bd64a3ffa7fcae427aa4166a203f9547f0d359d3fe48960915bd5f99d8a435cb163c42e48227eb27763a20663c6a20d0dd665694a5b88c5149215e22df0193e2a6c0f6c457b6c854e0ca56ed9471223a906a38486eb5308bfcf6a03dc7e5e1813e61dd1d89744b8e59d935d34790b10a2744e92b9e3ffb7bf721f491c7364d3347c62edc7ed23edd173e5a9311e184ed1171a67f97402ea2d755918ee6a8045a0cc5a578459d87e169b17f12239264a3e275eb72a2e75423bd8f5dbe0067f8f2d0fe063a42ff1628e8c964b0ac13fded578e2ef491c8fd9c4c3f7fe6da300fc9878b097ca243dc687c0085295d1c3fead3748f4b9aa361424c35f4513b7a146bc6688fd6f3989e57bcb68105a4cacbc7a2be06856dee7d4bd0520d2c334ab56282c85825dd28dca6f65323b947efaced0edea3862e86d3232013c5f5426a597818a638ffbd4b57c413a038283efa834f36fd9a270a2120b037c3fe18b232b2df1f5b81caadbea99e309cffc9f502b601e8a318c1db05d79e48895ecc4142e02199942a57472a5639958bc86f5e6354cbcc88cb890c53cf16a01901db7199019e87741213edec104767f45e3dd7ebfda75f57986a52a30138991cea6c82bef2a01ed30db73196c1e326f91b3e2e52351603b8d5e6088f6e85ea57c76bafad7d9b54dc0dae52f45875bcfb5374d8a750656187f051b89c261e6cd058f65fcd4c773f4c750fed7ada10f521186e84785b87135aa735bfe16ea1e3469a85db0160b6df72b3cc85dd3d1d2eb7daa4d64ed4d821a541ecf305566f543b28414e4ceafba1fcc083c2073119ab56be63614e7bd6a4b7d870ffc0ae60d60f0da6a094d9598ff5d78e8819fef800f2a97a7a15dda3b80f3905df4956a8f7d588bb6c8f702dcab9c66daadc060ee446c5b36719c31bbb8e05b092311830169c76ff20ee1850f8055e79c50cf077324ae702bb2e99f54ac1a2ff9b81f0c86dc78eac6b44f2c8cf3547cec71b7c00c44d40cae8bcdf02af1577b7728bb6ad9f32494fda84f57220749373dd9ba63156c70534f499bbfd45e50d8306f0de0d4e2c4560c74d7dfbb3533a6881c1ac53b4c5f2ba5f9bf48637770a0c7528b8e764c3496c9ba7d25e2b062e594e07f58d84c487c2f24d435cb39fe6e4b115837ff24587d22c2e625fb822b70dcd8f3d20d2218fe9d15f495687ef149c8f5b71e14c562b6a9d910d59b5e8efa580d04a314ff09222fd55cd62e74f02c4a4842b489c037076411e9357b6a6965fa3c6620441a532e4d1152e05ac4cf963d222ac19791ceccf0debef5db55a9515f49fbec42120ac10f69da042433509cd18a58e798b4aeba466175ea9088a3436be22315395d53622e2cbe09683a73d876d772ff711587a5b4449c153f4ecc5264e7f6149171a86f82d90cd66e2ce647e34bdaaae2cd8a5438aaf7a885dd7c3e20578b48ebff0a64b6b1fb18cbd50c04e3c22b25048eee190461b1c0939913d4a45f05609e40edc7a6e112c947356c3651ec45d440af4a486830c4a80d656d4afb7903e150526117b86096041de80d0907352c993a2857daa5b75dcbf009aa0506a72d83b7cd1f34acde1fd318e6c5a2172007f98f3cc5730678b341b48c129ab0f2f32518e74e1d6eba643d5134c5f69a1d2c6ceba8e61f6cb9070f6e46e9bfb190def91ccfaf01393e8e6c4a20eb90c08df0b24b4b347112f26f47006fdbad6b031f6f3f53c0f5251d4e7011c2ac64e48227bc7abb82a1a94842b6b602df22d23cde42de94ec5697b4710c2da3347efe18182783a1056bca6a8b5191db9f9a64385022bbcc8e949888621bb24ca659ec45e616068a9974d0fb3a1c890b1f431f10a755ac38a3b7e34258fff8466f44bc65d335e57f80561636d74a4ce5480fd1a34db23c162f64f6fb614e68da674b9a4664a275e82c5610c94ec8026aa5414dc7cd297aaaa75de86d0af165254b285e159c7fb405bf15650f5455e7542c5dfc28d4671bd2f6735097e4c9a4a7bea4b2804c562b87e5b1ea6fdf7f603395700e199a391338748db3aea6789f50a8d95536763908ec22512950d1f18315d4ab0fd1caa09fe4cf0b7c0ae73cb42e5dd89476f44c6425621c3ba9e981cc48faa346e7566eb7d40f1347353012cecd6c2746e66b5fd57251f4710a467b0a012d9823bbf40dd0bd7d132b86d671dfb2b9b846362825cee8cec388717a5f7b23a54ea648da9fdbd8af48efdeb5ea6e04b1fc213635e324b55a099c383bb812a888b32cfed3a678fad95262430e265e3e8704d9a18a1f5a022c8a50bf40ee338a4f954864ceb0e20a9e6d99d7b7c9420f1ca5922bd675737f8df71c41c676cf567e7b508d14274bcfdc3e45c94058761c0fb88b4ac3694597f90b7281d02d4f70dd2f085d4c76c77413f5f67d490a572ed514b109e8fb7d27168222d8cbee433016b26450fb5f4a5bcfdc695163b545e9d3686f1f81cab35ce8f30b8aab933d1d9608d0e845d80cfe5d8e769cf65fffaf65fa4b989781d2acbc0d91a84192944b14b0918ab6cd163701ed16fabb0a6b65569d20d69b95f9a003e840f6a2aeedb5011733cf9c6370be90c0f60a0437ebfb6e06c2dbdb42c9719fa43442b2915e5f5b1dbdece550b1ad4d0c78e643656ae5fc232253433dda39ee5c330442ad2a0f11fff3b0b57534c6cb635dcc0326948f5d26f834bdf035405106b37c512c98e95655ffd5d8434187bbcf7937d3821700c8ff51b24ce8c0f26733c43b62528b020545f746c10e07a352cfceb6ee6a82f5eb01e344e53e0b334b54b3e69b40cc14136fcd0ab1aa41124995f0cd24904f488ddad81ca494390a022ffb4bf66d1edb6e24c8b4fef0a51bb4767bc4e9b2e44a9a6e3af10b8838dd7ffd6aa423358e0e879ad14b37abf1c648dc1a5d004ec6f60d6ac5fda2a5dd3c135ac3103b506c2e24495c26b09ce929b9598c6f774280363d829ba6b49a329d6d6b3266b58b5d331d07b548e0f686109e061b5f7b2e00cecae0f8429cbda3e59d98bb25c7f90cada90f1aa068ad2721391f1975be09b9dd32cd6294f015dcdefc7457cf25f82baa6225b7ef8e4792a25ff4660c81086488cc44e625504cf564cfbc583ef3276832a5a1e0063c1151cf35a35bf9b91be8a2b32fee3cd71c59deacb26d6cbe6c0b3b7ae0862653fdb140ddf9a7ccadc3ee5e88a86d65f74fcf094f059332983252535fef3811f34367d3aa7d896fb8dad96b03acc1427292b6acd124f96b2c1f623d2b49c717ec98f415a41c38627ea8f6b254d7a3a96f5e18ba1be4de96e81bdced365a344cd7da6bed5027241b6c18a399e7eee8bf17a95b748b7d6063e031993f73d876f931450a8fa86eb77a7754ea82bf7d13cf87157e56e6a0bfc900b83fd4e67fb4050cec323798aaa06fbf5d5aa3b39ab917c67fcdaba9a10e816daca82a1e4dfbd5de7ed21a08679eb1d192b91e7a539b0f15b61a82da7700f5681134d0929b02b7df9534df68f66a8235d6d9a9f68fb3be889ad7b78cd975440a18e4774b76d1736abb0a8f187ae289980a5e8323f5696ee8ca71e574319e630e75279761dc7b4550b55a1489820a4c3cbb57cbaa3648fbb8e35bdcfe03dce6f425ce17fa84ed40f9b1d775fe4048e4570b1c6c4594261419385f50e658be48ce8300a45a7f4a837182d2fd3c4a0229e7cfa5fc35a9f6cf7602274297e51784cb3093bcc046dff98ece93a29cbc1750d024d345ca327f90fe9ccde2cbc712e0be661b5bbff9308099dcc0b027642c9e84783db4f4b50496cf73f5cde644813d11ed5c1e8ac44c66c0e2515e05ad526d5682fe4e901922f88f5443b5ea617e4540ef422472d17fb0e1e6feb409794f1fbf2d2a1d66c6c8f88a8633fca577e93de3ccdb35be3395b264815d6daac7f98d9f76849f8145a22f0c1f1cdb0cc8ad8c6e3f3bbcd41e1477dd6de73f631c6dd0ca6fa6d6f4ee35805affd6fc3a5674c45293aed04aae82ec16acf5c4ba6e9ed1ebfac8cda7b3d7bc0b967ebc88a874b3bcc5db6f56ef528d8be2d1b732541c0e70dc91a92cca8df616927213944e6956cc65002c67e59c417285cbe84b32636a80d7a68bcf393ccd1c0bda47e165fcff523df5527a2f93bfe121a41a9784e48645a18adc10a384937de6fc10824d288f85a9d022f58a3784685c6b4be5f1b4ee0c0d001b038f7882b0ca39598d41ccd8a836b37945d1647f27d1b51bdf9132567a460e025759fba5fa831331230ddc3244c34f2160c1fbffda8539ebbc731d3cabd691c12b9c90e508ddda0df9dd0dda25fa6935c5ed26bf919d04bb05ee72ed207eeff23686ef2c8a09c7e7f4db08012237485a2c4b95d3f9851b10bc9ef87113c2c2ae835209d5f2a335220f4d16bed18f6990e153ff41b4316366ac25764eb0c18b8013ac35e70946bd632daa084e8684f682fc6cffa368132fcfac4620cdbeea8aea9865928777bd358f1f8406ec17d78d9acadfc727c6f5b038ceeafbd5f092a348dad8db87e6a72e7b0545e1e3e452cf2bf2a9dff7adf9021c33f4cc8cbaa5eb96f7e47e78cc34815c049d306a80cbf2e30765750cdc02891cd79dd8d8e4c3ce67651c23f9af67f0e91aef1587023b6b5b92d8c5411af53cd73b58b1a33bcb5a630b78acfcf5157d629c5dfa830123947c1bb5c5abadd416edf8539ea40adbf0eed03808b82b43825ceb360fd5726e4ccb048e69ffe859832018dd62a4973060acd782cff2b871d17f3de7341e0f3382373a33e02edc47e32cda8c7e8d3ee3a6a5ed4d4c13691575c005aef55c6c4f643c85fd3b9a091e47084a8ab697aab5ec389d393e13e74870597ca0512c76aa567b8d1990a15756464aeb175b1cc279560a550bf24a358c9622bf5364ac9c2d5943b256c6ba45efc33bf37b1c6797318b7ecd1fc8dfe75d197a015e473ad5451c9478796a732ca515b12a548c1fd2c8c2335e1c9ab849c12d05fc049a966eeb80a5047e3af24acf4ab2086d9d0e21e31bfe4634a4ac7c8b28cd60bcada1555fdce156f066fb2faa54adddbcf703f5d77383b049d47ab8f119fdc0dea28c899bc920bec144c0d1d847e6d33310df134afda4f886b35487eaf87732d96993fb4b1e041e1db5d41a32b9f971bac69330fd2d012abf305c3f6beeeafc75c4253550d98822a12bfaae50cf7454935ad00b0ea755fd85310b3c2ff56c8836f87096bf60b4e547da72f7831a5d57c2b78d4f3fd1a701bf675b7caa973ffa93befcfd4fadeecb0739984ed956ba341e3fdd3d75bec3bf1174865593d0caf4b9aad1592f47521945f03c23e6424aff033a54d95ff19fee8eafe51c7b8739510d4ecf8b46ffa23d54cca75076e333bf557aadef1e958c5f9eb4a7639482f2ce92a93a97b697f537a19f4b1623d820fba31e3589f6a2a0ce6d42b4059d74e981825375b20996309a3d362dfcc28b68b81d55ddd7ecb9f0e401718fe339f645a8b2be87b73091cd4a8465e71c40d4e3b1ddb4b81f4795ef15081638a475ff5df62568dc0074e22b2d44306bb84f815a159a8d990845fee314c6e942f629abecf2bf15476d84177c7fd11c509150eebe1e6491d632e39057287435737efce62760a8494043ffbde25ca06fc2128fd92d50dd05c1d613fa660d19b4c594a40c1ab7fbf024ae6ee00224081f52cb3854eea6216e1369caedb576e6bca074fb66b537f1eee2a761dedf48e0642f4d6ca52b87cec116153215cf6cb28992fa5acd0d57f02f751d47fc0d52d386269b9b096c8aa600dc77b18c128b2ec2d53b6f4432ada8875688c81fffd1b31747cdec837a7d7f6091db4393421715f02c565f5c982ab88d7efa56acd2484789cd87eee44627835a259311c62f7bc77dd47ff3d4d7a178751a8a5ba21f828746831f270131a8b4b7f033d2fe08456f2a450d66ff8404d87afd6bce857286adceb3a4ca843e79baff76f9ab18d824a94eb40b98f515029f7cc9c73463815f9bc42b09eee805b5401c02ec3f2ac4aa53ad85a6ce8e06e5f17c8e8b4aef7d297aa8a7d874e4b8ea800c0873acdf2a8208d0e1714173b611ce9a3860f9585b104aa10d2890ea9002f83e1742f91d2c63674c11751a45cb3f2d59737753b6ee3fae705a0a240a1c54db20d4b19b12294fd5ace7a2a2ea0966cc51552c413b1af64b23037077253504ab4d5f5343f1c176a42fcd0251601b3206fb362c986fbaca716abd59dd3234dbb1e35dc27249d448608b2b0a44ecfa0745852633999745dd97190187c28e9ef12c743ec7f7c03680ecf718539c15624257b2e0bd4a58feb1bb77c319204fe5721f42a4707f0f5bc537d2e01ec9fb7048da6f1e266c35953e8a5823fbdfad3d82b48c54fac45bd7dc0c5aa5082ee3ef7edc8109b7e6cce36669ba2a7b10b310d85523b0184902f1050af892f3714a348f73b9e8f1b8ae8e166ff31962140f65f385b69d552f4e04cfdaeaa4a6795b56824855c3a8f14af305f68a9dbb361e0bf40bc4ab6c1cd79679884615765982ab21dbdb1aad652dc3d35c60eabd7ca6ec7fb3886d6fad4e5e1ab2ce5735f3841dcf9b3587058d0011d4fc2ca2eb64ab7f34f10d7bdbe02d527086b3c1f6264ad399c3b201b8ac9b3b82b10fd6690dac33c1037ed20c95c2c5d422369146c592ebdd111e0df1b37cf24176cab4996a223ca621ee088db84913aff9c7a810e7d9f99602160673a206ba77c5f65ece24ba5e3bb7bc14e9b7467188276a7f78bd21bf3343d36ccfea2a555ccc71a2fe121f5136a3d507aa0a8f2819595cc4fba48aed5bf1b5070a49f60538dbbf1f5df9c94f28421ff29c027680ada1519a52ab0ca247a4bdb6ae9eb6b7960c1c2043ca6f26af776ad8f12c603cbc10d776c9be87b51644929726dbda5f34ae23ec1591aca630a5dc5f4edb5f7cee892ebdb775a90142e9f0416d83c36dd3d141ad8c2b6efd520506f8293efa7d08a4eb2c58e675c8fdfcbd348e27e1768c79980fbe16ab92257018c40911abbba294691f2cfd30c2ec02b35b1f1844d2d695794b80cc6799a7ec0f29a92da8e31d61bc59c11ae575c1f3438799375272f27289b6b7e9333c22d71c5e31bed58242e9cbf306ed2051dca007cb50a4564607e9dfd77fe9e6d731586d98cd9b7796f69d76c14dda5709cfe4d0b8d10a50946150b15bdde687dc05a976f92686522332c3ebb3affb774693fb4e78ac92175dacfc244a392716b4c74d82d4e36d79852efb021e9ee89964a8d2414d5027b95ef173e9a46d0b905a3ac9bc52fe2e87e05d8c4bffa87c2e981993aedbdc7e78c21e9c87b86f2df5e2cf2afe72e12a0857e8e9eb942538246a4ff02f1ecd99d9383d4caf6e44e012806576859b912ce7d73e99f2615ef24bdd961fa2ca751bfa4741799001c99879455f0b627aeca43fb34ca0421455fbf161817b07150f578415dd8e44f44a64b4c989553a263589632080531741b3ca34b2032179ae2d1b57a39b2f834b58718f70bb6ca42fe4be405496a4028d75003f3495e80dd15459f697023319b23deddf7ab70945a94fd332227efc5c451b14436b6a3b74fe8556e11de4f476535c2b875168b2305e750084397014aba14df4080ae539546181cf072e75e7b0c8cf8b67ba19106a6acd62967321377263183a3e0074dae0c8359654e1f718db9b6c9bd78b35a69ad815d52bd7725c6a0f90f115909fa4a54acb3c59473bebddacc565d6295cb2b086fced7d9ba1baacb233f17f3ddb1dd95c23ee6df5b534dfc32bc9bd3b8f1bcfe9fd7f037f4ea18c85e44e194bf92dcde444881eddb0d292015c386e212bc8fab60eb66b14dc4f76a149850709aa1ab4a3f702503d1864a486cf2b4f0c77f1a106ed4db6dbca8438a4f56d308f33c7c308839fcb9ddb8d4696a4f7ce9a843fd01976ecbedad62b25c0ec4e734a3f0a003d0a258fc573ecc58458bb621b71cbb4f54b73707ae68b7665f0f44aefa295c15f576f615dff0d27bf190a67d0bf81c1eb6c77896038509503786e7b5fed5bc65d5990bff59f4364c607285ef2ed29bb158ea7756dd8284897ae00377936bd0eb329263c4f637a41fbe39e6f83173dc3cf1876549bf52fc40ece47959330a6ff7ee54b251cb01e22427c868725cd1a692664a95fec644a05d51d0fa61b62665126fa83c183de647bd6d1a0accb462def899c2f2f775bc276d0038763e190ccdea740ea28397103d071614824c97be19bc06974183f1759aafa51333b1abb539cac2484324d700a1826e80fdf6343968d9a4a044b42b72d6fa25c43b1b3de22c5b77923855f2e338b1859f2cfdb3deeda94286ecca40a3d05f43e3dc25a11167e27ed57daf00c9dc72832ba037d9627a1e765a08662c5e2234060e1f90475e56b59c1e128ba399a1eaec2f136b26def6cfde30737b95b4f495d458c7d77827df5fbfc6f8ee14f157b14150df20f34faf4c3e4e266cf312538712cecc7b3d42b2d85a9d1f9e19e63a4de3204197bd4cbed945e08d773d53877a37450186dcf20e669c5ad07504df8de528df7cab84ad850951fe9f31b7c38091446fe2f996b521722540be7fd789a10f921aebe91709ddbd24dd0d3f5f43d7bc5ee0fab2f1347f7a4076c06fb1c3af6245987bb3a8eeebb0da524a77fb06ee0fe10ac0bf4845d9db873a1288351e0f245c5a2fcdbe0beabf322f511d1b0fdb020089c2a530e4fd601c6dc7469f49f2789c54853abefc2745eef768728709e7b7b9e4c0a54e5dd0b43eb575d23cfe233d6312019aed5a93427f0993e2f6deeb0f35e9da9c7fe776ad2a12d670a278824fe4c557108136d871c5a51afba3ee82cee7930b51d7b6f76b20cdb0e31de77844dd0ae60d17ff31fe0fd4565b41850fe22877089c7bf1bbcf2878a00602a8741df9ef2683c898a1c196cd2aba92aef715610bc7bd9378e555b8c07b0ff39693bf0234b5fa70cb2cdbd8ef82af003f32c4cf06f82427f2b1cf65f16f746503287bb349913b310e8d366746127a741154b4d21aa4fccda61c5956abd1555310772629c7fef90d0877c5a7f7c086c291cffd8561b0ec05086ce0416f33fd7612e639ebe7957400c173004cea8ddb4b61dee54add25d0c6486d3cdc7fb3f6dc3f4d79cb15a14df8fe2c0e1846b668da93c275b4054a7519c336c67bdf33c41bddfc93d63a9fcae8191c4f5048e975d52f8ad6a947c30b2cc4ab7a5cec71988abd088cd1fb551a284c0b0f7425c1e78513c197d8e0ef2d572d213b5fc1c95688e5afe50fd0feffdf68b1f1f133e31ed4c59fe23303f3f98ae46a8581250fe7039dd0ed932511a4d2c5b10d4f9bdd0b79831d2b3d95474ad96e3047d5e7b4f06df7afe4f8a5ccff1a459512ae5165ef35cc424f794050a9e42c3f73066bc47a3a26f054d6004e9ec58e228a8bd1bc23ec053ed977c21da5d7217abba4e547ee4d13c45c728d74efb89ddc5144b2956ed21ae21e04438dde520a35bfac7cd6e170d028b2015f94ee116e1937ab1e589a98ce3dc17a70e731ab5b7cce7d2a4c2d3877ca12ab7578cb7bcf2c42852daeee64a42e204b5e563cf506a4488fe5037f77c429319497bf26740174e638332dc8bd781a02c51cb5160699d915170824855e2c8d4f41450ba45e6c4745f5a0aa4a68c47173930be3231841c07f641acc725698a3709d64142c17baf65e5d330f86a3b9f9c877b6297969217c6212137c003771b2c3f06cae07f2841c9211f8c116a43ec89b7042ce2d6d3f002a9367a87b504ca9edface77284508042c99af266cb8f33eb8290b4e2aab36d2acfc32768f8accaca7a1e846707c05bb17c8bf74ad7f210d87e38f808f72b1b146f91606b582176399726b5e63ea0f4d691eded9f1cdb82a609399700540329da61af9b26c316900281d5ad5552e0e405baaaa12d18054ee14354cc968a9c80aa1909225746c69a51582b75232b548d2e512ec89778aa4dfb3e09fa528614ecb76f3422882ba2fd22da89e7b0c413abd2d4607eb5eb8aa8ad3479c6cf8bee0da4ca136f60eed6928e0057baeffecc42c8b43e6675907edca154c67dd23108236267a253e1e95744afee479cdc8ef6c48c506d8e43b99c05311ad608e75e121cfb9569892a86f543f0c064d8b6e69ec057b1d081220fe01163a1d8ea08caa9e685ea21fc99183555e6709254a3b589e13960992660293ebaefe8bccef5d70b9320adb8f1177688441678ca28dbc4a48734f4f604f29e405344aa6198af50b6210791c5be4b84d6bb3e8176f46a15805ab03be78d56b33d41aff4d6c9012c874d4a4952c451924c0b10c52127d1a2afbd1209b8f20174234593f7ad09de0b469ee8117405925fddc8ffaddac5019c9853cd185e6100e6bd7f78757058b73573fbcd40cb54c9d4145bee9aa436c8305241c94dc3ea3e5572b274795da30791b5b8bb16709f00de28b15f0743e989dfd11226a4085f9b92cfeeb3478f399dc59350594a7fa04d67e26c9123be350f7baf8f53ceb8e7801eeb516621f2e8bd2dbfe62694127f4fd36aa109781052a6b9288a43329d934797721f6bacf7f88929c05a3722ae452e830d016faaf7b770cbce910e655248ad5d1e87768aed1eb7f3904902129a539d4ae6d14493f9a68be4e876251ef731cc1d17ccf4a8c4fa4bf4341e10f9d2f2e1bf20e1d48648b2b4e53a24aac8dd4e1b3a2124f0b8793f28314fac61724641cfd9f5440c621be1b6fe64066dcf9b1be121d4a18403b9803a573b6739866bb6c72f54308c598ad56a2f0755bf4b3da3cd96d67ac5c4537eb547601def4a7f8ad877fc877db8d6c6481270274a76139830dc67a72602e5aec02b293e0ae98781946f960444aa3f64a4f642820acc7e8f330e188f64ef16eab60411b58f585a6088705fee63bac003fca3274dbaee8394a28e4971db37bea82a8937239d9636730bd6ac4c085bd2c9820c20bfa6fde1edd9fd23ff6148376d4eb4c732fdfa4ffda58d025204321689f268cc87e31f9b66f392ca13ba3cad5b3463d835ba314b8b72f7975840231839b682594fc5e096d7daf264fe30a2f99a191d6ac8326823ce6ac9b9551b40891718a32f500a93cab05b38a65d31932ee4ad5938507d701d245efabbbf225cdb653cc04fd6ee65141a5f96f48d1017cff9338ab04f4aac02b369e2d279796c55ac1e805b4986d124e437377ec9ecfad4ddbc7bab2f1739cce68c6149caf65b72d5379fb38c2437104c17a6914759f01e992b0670d7db22a62e81bfdaa586dd778d3c1dd7e","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"a04e2aebb4f065114c065b7fbf49759e"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
