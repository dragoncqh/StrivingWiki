<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"5b1e8cbd90ef64f85f9687957932de3f73dd0ac4bd039ef9480d106cbd07413dceaaf25136781d0417d15fd0474c1e5d526cb01fb4fed9bf70ae00cd9a2345e02407f4bc7c4f57f8d8d76ed330990375e7d78eb3335d4a0e3a58f4f5a42b9d799ebd3966dd8710df7a574c549dc932014856e1181648b7ea4908c61152bdfc7162f4cb6980f7fc76a8fc3d3ed17b1cd9f8b10e859781e7b157fdf1980c0be5a2009fa9daa70b46dddff6ec3665d279564e3796c437e9466392e11f111fcc814745703b707f044755383181150ffd2b4d9a37b9c9bcc04a1799ad89fd75ee8c5a5c72969fb40e8f6c391b888a85c2ef2bf6af37b8d36c46b09f6b7218043e08dd0c2047eca754c54d470e2f93b64842e6fb96fdcdcfd40190f838bb39166a7dd02288e44b7184678295d4832beb17feafdd9eea99667e7cc2f76ee5cd256cd0f8146ae029929cd712ba7ab4955bec32a420e7c2797ccd9a0573057e505757675d1a04d01abc60a3945a09c19034a80fa80ea56944a1b12d717e5bf1275829e2434dfeec3074a6fde1bb82531e3979be694596ee115039203ea5d7a33642b3b028304180c1162f79b5d0c7b90871cff64fb93d153e4397b7ae587a4a30e864580fc84a1e9fd78c66ef32c21de08ff99e5fa0474488df5f8397f092de5b7de5f17401881e6040c3554523ff03e303e8942ae0191565598574d410254cae9ef208c27ec28f4fa3da1484ea2eac6cbb8bcde8960b7ef2a1d8ebb6e4d17dfc34ad79d9597ef1d96fa88bad2faa7fc40ebf3d1a2e3519130748a30511ee6136113bb5f31b7d59f83828ce3c8a5426a73506c7b6da54e24ab7ec6461f1f0db0d47f8f5c8460dff71b56831d581dcbb0cbfff75ba1097c5ee117fb11979b4f1776d266508623f337d1e843f89145f2a55c14ac97b477e6e69a605459f0033e4ea60d6caa590b8cf8b392d9c2a76867059c9f09495df66e0e03bfd85b348b6e30a29856f1892d618b92230e97039d725c9f0be13071adbc04ee7221e4b5f2c3a64c48474ac89a86165bae10001397bccd7c0caa1a3d702350d0c992e11112b8bd45fef7db6e2e400721b34021d43d78dc1616dc538a960cd4b1d2f3bed4ca97a375f66029b3bdaac0801f48063daab4d9201e8dd40380d726f4f1c6b1969d2990b9a5bdb6681380530af9172933a253cc726222aaae64d28f61178e28fa408e174309ca53b1be4cf7865002e3ebbc0cf3b5fbc3dfd1d5d814c853c8d33b077f5615ab798f8a2dce6ae6fd88ffde7b70a671d10fb743360c36fbbec8bdb8d0015d7fbc73c43dce3ecd816b350d39166abbbec10115cd5454ee283bd0a15633f4db5d50a96171afcb6d7c07b1b3a8aad3f2b835ae39793fc99a2013d7d0f278e5022d9ce33214334bf073188eb64289931c3b6031429ecfc1ee174b1483584f07d8fc6da41a4b3475e0f4f222122633073c3f392170f5e93b4b1157c7ecd54712172c910c09d9c5d8155d63d9b3db3aaa4c1b616a8091621f1ede7de42602231cc9364600a8cb1c248cb3b17cf943e3711f975269b7f4c2e76c62ff2fcd9f4690223376e3b4610f10aa42a3d317f91ee913fcbbeeba7d49333e41f2de5918af55b4026bdbeee00a0ed738cb60e2ac8f76998b7796b58bd760f1810235df422822be5a853c813e759b54703b47ceabc6346830d52aed9e5583d70ca9088f275c557e4c9c3de0f99b8dffe1ba9c43b16f776dd17740479f3d4cc155f01266b2f8ef2bd6e07a710f7f67b555c673d83bd43613f9753baa70e1280d67cc96e929abbde2df41761503a81e3a984faedff0818dd628622510cfdfc7b61e260e609278b1d1e17a78e5b014e20f5a14cf01bc6d9ce61cbfd9e132dacba576bc1a4129345f6b68cd881e300a7bdc131aa46d541c820adf083a27a0b7fd13da46e0dfe063b9b209e68382fce59a52fe19066f25047ec1c26fa0f49dc16344b8cda0d28130843c37cf7723238b77cad07a4234d6bbe92f717c526c5a08d5d1b77d988df05a02c8fdc71293be7a9618e43e41beb6bd20043fb578655bdd7e72a313017380ff29e0548838caae350c68995c91d9223400bc2b52d1f5a3c4deb41cbce7bb9f36cd48ef6d7f23224fadb41a0c8248ffb7aed203e18f54a4ec571a0de973a2e2f862f08e39ec8bfafe9d47b2153950d36b70352e9bedc4bcb2e1d786414f0feae9bb126f19924b9229a2b815853b633a8f423f8c0cf17d415ef2eaf8b6af9b74ebf1582c8a8b7db303d79f46dc7156312f1d66749663f5075f2fb33d87ce3de46d5504641b388862ddd2010b90a48a0d212ce6b88f2fc9e8b18196cc7ef4d35f4d492e5b01aa2a078e53fb1a6feabcd2b8b2f1064ec8819cf2e83bc71b4736aade5e09e26b54ee5041c9c1b94587d6481d30d2c45fbe546f171d7d0ba9c03a1b80e3382a003fc541c2d62e2da5602a707861450acd67930a7b5ae29a7c706e9ae5459b3b781a4a9cbe922f6a186e80d9493855a3403a4a4d91f84ba8f5251f0e1fa542518f712faca9663c8e75defb844feae61405290f39bab205f74e34161f0fc2378eeb10f10bc5a4e7bd106c96fe6b09685831746525c73eef2051ba477df8c697677a0d4023b95d0d167ba10fca10586fe10ffae24189e4a9ca025e21c09ae58cd32b78b48c6a875895ba49bcb12a48972eb3ff35298555f76ee1d5ddc2eda8391838ba41b7beddeb52bdb8e2f90d439cf76ec5881b8e4853bb7ddfe0b98307b25b6d033cea8fc503c22e8f3cd9d3053bda3ddad4031cf60d0ac6807b07bb24ca67b8a68683ff2dcd814967b7ac730609cbd4a2a594ce53788f97b815d660c926aac7834819e0c2824618bb6d9b08936831be1e0cee8cf7022e832e9b01d76d1708fbbfe29d440bc0af2c27d5af004f1c847972f8ce44b5429de81a3e7e6de642c36b3901144296f8649b58b151135d49a6f4a796768fd582cb1e8ad478276e9dca12b22affde74c54437de117bf9686790e76640e6e6049aebf329b5470586d2cd7f85ca0d14fd6cebca8322e1df3c24e94dfca62cafb5839a09bf9912c4bf7bfd3e5aada58413b3ff93b2e70c5a02fd003bf463a54a8a9b4a31e49649cbba4aca7c669bc987c31cf89f77b82dbc83d9250c5d03f6bc40d11592cda3ce48f5894ea14b2534d96d1428dc6c17dc634495a793f2ce000ac9411e472aa92c1f1b7febe03c20ee8c973b8c0bff4a7643c85e240ee7a86e97179a70fb100bf471c1c30061c1a5e56efd9ba4ce6a8678d120997b46db4e9acec473b74299eaf4245a58a2457739259cd83270d205e3de459c2416b08b49a41b79b9dac77268226737efd09a86ffbddcc56369502a4cd8e8f2f9fa04a756c7aac28063668b45f1915c26c6de9050f4a118eabc6b062b72710c32ea3f5996dae0f275cccbeeb5d2f886518be37a256e416be1b8036d4aefd810d8af4002243282d3ce623a9ebadacff407bb6468b9bb05f1f1128dc1dda37928671b032230b65c0b66aabe6560e3c2ae627ca2a1400c4a26051b959abc992c75e4ca16e85856a5fd410aa0a98d283459dcf284e47f5e354751a5ea492b14cf738f4c8d3e1d81eb8615d155ac13fc989af278e302d62fed9a51e9d42f565a91b1518e63f8595b492098c45bc6a4e559edf90e08f5a55b0b1e160c2e6f8c0197b51043efd02b03648f8c1fb73ca38bce2f9a8b86e8d35a9fcd758bfbb1fb04c2663048f815b0e4fe977e3fe9db86fbab5ee177437c6437923501a0cc06e24d5843d5432a78f89ce7fab42b8e3747847bd4bc10cbbf993b05504c7a1056080f85e82a145199d8b16afbfd2cc559cc5eae86764e475827a9b15c302440f64bb3f541b352ae73d1c2d75c343b860d992f042da65b74f7be5f0aa849948cee502fce9ff317b6e11c6e9957cb0ce607b5a71366649f1790f2d5a09faaa2617e5b99c70de63d6e81d3c308a16c015379cd61eb20171287361b1d6b1b00921904804e95fb295a91b837d721ec7ea18f757ed7a15efbfb5448d104614a13302554b243238d4f2a7bd9439be94ddb6d2a3b12c22cff41d14638a5f004409a840e04daabc404ed9e9fe62f4d98978554a0557ff70f9f4c85e8acdc4b083325816b97691292345a0c23b01f0507881c3dc5deffc9c3a65221378cd90ba5ac44c50d9195ef15de1e4fb3a5bae0849466c196cc54bc02048a131fde87b28ee09ec7a49100124aacd27b911f523dd328b4ad119132eaaa08ea3fc38f45a7cf5bd2ca7e84a43d88e1bd7c5e8913732d3872d8b89d31b1090cc7749c4699bbb49b780ef7dca05db3ae49918274ba0e7cb9ac4c241ca497f67f0a977a62b8bed9b62ab2fdeb7cf3d49c8760e6ef4cd815f3cf82061d1b3349bb98c9063cdc6c6faf697e573c486759ce8412285c29cff0434a9c4caa3d49275f6e74453d0b872eafb9cd47a68a0f9f875a0a5e6c6d93fad8e790d5ac3fd171988710c416a00784c00ab30c4e6aafa974b5153f0ccbf62f596a6ca3291f7000cc6d72f9551f7f8a837831cef5462887cf36e8a25b7816eead01127d0208dbad11088def797f1e9ed2b5f6b910d34ec4704487d4a3e8aa7301eef27f120f3bc445ebc07e8c820a817ad7e2e82102172bcae9d983f2ad71d3a50c85d99647e30dd772fcded376d043a8c05ff80a43a400b771d8afc0a764a197596bb8c57799288437e6935955faa9a8908753aebc91e4e290a4e9b5410c2c4c20a92adc48c153ad7c176611ea45c4f81e38b5bada943ea05f384bca5e6af2ff604d307037e3794552a39daea3f5048af0299a32048d629d0c0d353bc19c17f41eb7b203a84807db1901c65f19b66b2e7a69f20666485a80fa3720bd9e5be20b6eb785678955d81ec83155a9f77a7cd5c444d3a2a4e9b737697923aa7f364b79bff740825e53060c7264b601934e9225f407e951d26a5b9412839c952bae7b740ba7defcb36007fcac95abca58ba0ca5ce1bf5467ab8d9e5f53d3d77758deac2ac54af52f280d23909da110954df8098dbc7e894a34bb49ee151c4da96f3a7d6f315e86479a9a9b209c2c12d2c5acce5c25d980fc39f5e7d59575a00170c356e7abfabde08809de8cbe95be31bfa355adbc7ab3dc828fa60ef73930b3e961c3723496234b848892f9e0d145c2dd42cf17b7f1b527817a64feaff22d7deedfedca68f190a82aed6dd4e739e9ce30ea4bb256a5ce0b9c80065ca222a6f0fcde6ab5ce1c401f4064ee3486ea7cf8823b9007846485ae34532279d97828e277534ba4a16fe9a3a9201b0509fedb575a93820e50fce32cd6eb0958414acf2be2d7f3dd10488402684b76e4008bd51a9796529dab216a11141f8307e74d07d670300286f8b5f32fcb9acf60261d60898250dc6afc4fe987eaf8487b823f62403424fce8533346d478b38203046f7f5765a5c1728fe04db6f450c3f272d8f7a045105604e0397a749f4cb1381a0dfae9d6b5ed32dcab9a16e921db897437f6d70f8acc3fda0348f30432e0bb1c499f79154f3f37609c13fe556c9ad7adee8f43183330576550b8da14bf83b7c394f3cf75e5311f773a44d876f36cbc4f0f883ef8f1e9239cccb3918b07b3426cdba9411d39cce5bb19b83d93bd9f7ba51a0941ca3766446a299219abf12fbdc446bb486e7c11a5e26059b59c2950475f420267e47e0928c749bdc62ac990505df8c38334790bcd2c1480f9c271f43463c8bfebf5d646060ac62b83da0968ec881402db67b7d9c455d13a5027c8bd99ba6f4b9fc7a0a37f06a24f8f007d4c29ed8305565edb197535f6df5e344fac8dce0aeafcb469d5b8cffae64fef415d7c714013a8e4d892854ffa94faef8ba32841ad91039183defed2a2c012689217abc363e87321fd43b3d68ec9627e4d2ca2db06ecacbce99626e9d99c9a210933dac06a1fdd43672b8698b0d3db9b55352e993f5041f30d060449e544c06d8a72db6bf8635ebd7bb90210ef3c3a9563ffed49d03ada6ada3b73ab2e026bdf633aa057a531c2d747884a27fd0a8070366fa3723a6103349e839cdf4fe243a0b45070bbb3b40e416884df6e148780729e9152684e5a90a8389c54d94cd64da32afe83e17c6814be044ee916f9659403904f3c1d645fa284b2a1a1c9f33f276ab98e116c133cf26d5a5dd896a1a9f12b6161b7d0a2f38f35bcf9c0c46288fec3a7575785f8c580b23fade15c7db2d6d48489b0baca78dcf0cc50d9a65f092df06f044a2c6ab9272c9add2e6ca2b4d6e254721ce3aa313bb6def8b152bb61483721c228596dd8cf4f81075d505957f785108536703cdb46c24df6f2fb3e948d86a1162ac651ab139f866244ceb1842746cfebe041c70a890b36055c145dc299f2724cb7616378862b261ea8df797910a70975f7f13943e56970e9399ae99c7064d44dfd9c4ae89c8cdf537a2c5a6f7932532b9fe65842066bf6eacf2e1bbee7168400b95d65c581cc35f66b5689add99d51268fe959fd32785edb58a2d28707109d2125d896465d8d1e4d1cbe444bfab77f9cb9e3df705113a9c30c33b474be1f6352626a32725873db430239b8eb1dc941f189eb14751a2450d98b9f9dab4189a78d8d3a436674533994aa125805663f74a0a35ba40a66becb3742442a1f1a3f3dd4e2de5fe1255500c305a05895a21b19a39f4669fc7055d50ecaea49cf190ba7da2898a8ad006e6d35b91d25a97286c7a0a8e2de6ee3b01abb46143a59b1d1e1c5dcb38fff28dace36411cffffe13101c0706ffeadb324168154b5db5abb16112d7ec2e74968d3c006afaff00449cb2923aa22ab79cb813a5555a4cf05ce3e5664aac9fba4e9a1b4ec4002d8e80724bb5b01b93dde91c16660e12f4e547c996a013183eb6b65eb30aef5c787d65e8cc0f20dc336779a4400b7b19a4674555184b53ddf85ceb6ef68fb7304c30ccdf18fe77871da4cbe16fb159b7440243d00937208e0fadf5fb6679ebe53b493faf1ccb10638d229695e6f926cdd9f1f5354d228fb5b8f625b958dbeb3dbdc0d7e788502c037a6a2d2b09a68591cbcd64953d6121de256fa06734d234ba902bd50109016eb12c1a846d9353d6cd2e6a52277a7f04c7fbd117541a94430060440e4d3e2af6d457ced789803c4aa977a4b2a2cc369d9f0984d637ca69bddf732c9f86a558832692abae68259b21593c3efabad8ef3fc7c5507e64a76eec9d14f5644cdcb6dd745b66cc93d9ceb4405b9051a2220a6e4f46dba5b33ed9362d44e51ddfa3aa637ba0db673faf92f96b9b15def1b0d4d559e3f525df9577b808a90546aeedd0706303037077a0dbadb9b83e108438d40781a046e42988dd1657c019a76d0ae929fceeb10e0b1a81c5211756f8cce873b830abf63e66fbf05fa2d29d124776ff47bb73ffa656aa28714165e63519678e3307fe9b43f650e7be1d16d3596824959b3955ea7a85e201fe3175850b60d9c24453606b1f20cdfdf0dece00324cd5afa5fc3db1c14bcdfbb21d73d188d7f9f250b37189e81a1d62daa987f3fb68c9d20b5ce43c6243d46f05272e460425b53bba40e4e3de75e3de29c86044dead2339880f10df05547c109c6d70c9c0f480ddcb3f70fb2fd56658e8cf196c79fd01a585068f4a66905d6e23c9a01ae00368f73a79477c9ae970fcc02fb6b70663e0cfba522f075cadc0a9a61f9bd9a9484b4e53ae270cecdc6dda4fb6e4cced6a4b46f96a24809aa24014a126dd4813a95580f54d2d0f50b5f1554991a6d4c562907b8a3aa1165df407c2a473a746292804f2b503286dcafcb4e10b7061a5a39e786d8b5cc2ebe3c4e4f5c1342a8ee5673df37923c67e6748104583cfcdfb222f5474d65af24db577f64eeca2c1a1b69f90184dc3e2f313a6a01175156ffe51c91a040d9142631bbe661e87af63effd6779879494f5031b41b0b53f4a5bdaee07eec15973eb7e143eba2ecc7e05ab0edc331f9ac2e3c8f221f6d18493d980c2d643cfcc952c5596cb8b1a104d5f18236670ca8ef6b7445d64ff4dad9f3bdd5baed0eb76673f5bcc9e447111195714542995a37952e6efe8b53b6f7718b6a8d4fedcda8978540d1b23bd22a55e71a03c58ad4c8db29ba0663ffc6f664383e0431168041bd663f1257b93bc2c24d9bc911b9695234a185f07f5c3fe4a2f0815749af5fefc82e58aeceb98c17e7f319a224ca3740e1b4da48ef158db694533a97c7bbdfb9a4de0a4ea58f8f26550ec0a66bfc72021075b563643d0f9dc5454276cba742bae83dc6d71fcbcb4428d4f335a9740b7cca1fcb0b2182ab591096cb944c63a61b480923a1241d934f6283d24f380f9d9f98cd0963d0b56028e282e5a7f6f6324b1ca3656f06636228f23d563d5478b09739e3bf06c0293315bf5eaf8ef55b6e760d933fb2f1309135d20238b0c8e91e5a4755f5a2e37aec4744a4882fc659fe50bdd9c203f99a0c30217be0770474508f83d94f08604057adea2036c0386b5c5e9abe188b5c948507c85f16ff6bc37ba3955ca7c7bfa18355447f687a91055f9fdc7e47ad287cde71d0da7c39928002f834a5268ec344f83ca8b9ba2bf754432bf68b840476ab441aa7b72caccf682eae33c0c69d9498afbe5845a44d396503a74c92cccb53e1989180bd03972a19cf2fa56d10e7cd026b9845c8468937bc2043b0451448d5ac609247978ae02614ec6aa1f2cd122ca58640cf7d0941f9f1ac8749dafc5ae9618efa277a320fd406447a3f9fcb6c7589486979f2852af7d7232d61c914e3c2074021d3c634794c1c4268f1d81a346713e861c619e94ef8bfa61a80bf5865314918502f59460d0ff465672bb923d7edd6acf32cc3e5ff11bee4c68b39e09bb010f8d056464ea5807f44bf1eb7bde28a8ee8c908fa7efc1e832b2c5b9fd4731394507f28f420a2524a9fa8680cacc8ab5100c61e6142d56543d82b3287d63e86916562463a87a117fd0b5f1fd9e64d8b850307ceaa4c375026ca726e1e1b8e10c9bce492b28b270226baa7a1d56668e1f5cb8abd0f6a38485bfd3ade18af14e629d541a5634c0f50219c7973d875590d71eb34cb240202fd283ad4768b17f6c6152231e9b9a95fc2365e0d17ccb1bc56a6b37078deef43cf7ca4fa0b3251f18249a5ebbd6c450edb039307247a10cc92e5032415d725f084fd3e0f41460cf627051bf88bbacfc1296ecb4cc2f0d1aa544c02fc6ec44b90d3451cc7b0990692b317c3ca76990ae9578286ef70431e2bb5962a28bb0a50074dd7878cf88c3c645afe6481aa391af28faea75a036753c5ce7d94a12c0ba410f40452cb36a4ff09ea18b2247602b4dea043ca3d727102724247e9599b23508ed3fbe2af5616d7daaccd7eeebb4ee8af3169f76d7da77c0bb154659d738057f45cc38b1e66c132ceeccbbb3c60449c9b9729d80f6a3d332726544eeb7945cf5efcb113c9a8e30549570db7ec363a68cf4f34f2e5020c55a45e93563882a365424ba9c258d9b1c2349c5cbd62560dc1007452f4b93e77299c10bb8531444c0fcf9cf95dee619a3b736855adf4b048687c65221c13d211cf3a86dba819b8fd25b37805d378935092a3e8b6513b1847ee2e21dc6bc7c484734ca75fbbd211e9222ae82e53fbc742c580ae53632b284599ac042895e39d1bcd03786118e900f0e06a09ac8a5089fb935cbef112440d794255c99c46d13a1e528f432480893049ee3b1fd0727beb762c227db07307fbb610b2a6dc143881f25c77385cca627f78c1774c6b14002a19a7f5f1209c373866704ccc5416db5af449e36d70c586638c909b3c57cb331c158e9447dd75dfd1f122ddce7be9348f7b4b4b99167c95f955bf8cf82a0d6fbd8ac872d6ad4d05a9b68cf41259605d193b79f7af524a24c0b184ae5ae8834e5164f4d050a8e9a29e2694fa7017595b9bcc54ad3b57431f91463c61aff1058eb78cd4b595d4c55e2e5734a5afe26bb4bdf687d549516e03bd702f898b9fc2b158fbeee71a7c7428c4cbd95d646f7b4d3b23cc3bac30331d89e7db7bf2f50e5999e2c06f37450e820d5a3bbf604ba1f7c86b4a44df177d29f29e79a14ff53ff206b9502eaf5c5daab938b4a2fcbfe742641a1a549da618af5ac0356d1a847fe0c9d483524c68e3c3849253fe161187ebde2c41f62ecade2f9541622bec4e63921df928bc910b03e0a385453ea16175111c2c37f378e7013f07be53ddaae42092869457b2dee7c2b290503cd4821d26f6c561a830085b27489548b47b09d75cd1b624e2c2959540670898d3dd2a2c279565d8bf8ef4c35454334c11e6adc67b00dbe103d3a64b3254eba23ff0325e3775f949c0717fa5ec5513d533092b6045ec177da41f9c0a987404f4a5c5a6c1ecd953989da47925ccf1ce50c34b7eaa8caf3274d3c52e3485b4f670924ebaf626473615462c0ae9484496995327493c2aaede26f4340034b052094c13098323651ee9a3c21957ac2c1c6704e6039cd3d1136233e9fd321ce8e5befd07914cdc897e45556a06955f9b400c614551daecf47702023cb51ed6665634541cf8daad0789b42799efee5712970104f659d413087dcc7caf13551e24f5de2f8c04de2f2ddfe8115b56a33d05eda02d62123ce3e9cef95f435b760f5358c2cbb4bbcec6cb01e31da1be9de5d8be821dbcf1e65883af896dfc13c3d6ccbe9a18296285d7e434b6de4dcfa310628d1adf7cb5a4009e6151b65189effd47267c62c14f21c68873866531f22814de35f2a1b0a324908a276272707e482e365277e93907c3157aa14f94d6a00e42494661919d05ac7c760aa06c5a63417789810e9a31113949a41667612ac8d3937044ece983e3bf4f8550642b86ad14df08b44903897c6b5939b8fd8d4670da5b1461bea22479c3801f6ca8e830ecbadc11e0c7148df766dab4bd191e707e2eb67fbb6b99a79b8607591b2f3f5c8eb3933dd1d92b830b2dbd9a93a339223a0659084be0bd764d953253f75f5f64c29764e23ebb1762bf6c93b264e67d29039137335314c2232ab4ed4bb8f92d836055fc2d937f75be343f08f42cece442a642ccd95f04b33e3f53af524e99e59f17459a6778e939eef44beebdb95554c61171025796d2a753b33236a6db8a113b135c4d30653e6a5fabeb4219ee4017f2f9042a556152e4e583146ff469f5b0035fc69a7968dadd4aaf4ed50c47846f6cb0e1012062d90b1410b0f3245a8a39145418b7e715ca2d32b2b7c031bc8d293eed7964b06b70721ca8cefdd9b9280f874e09aaa7bad2d2cd2aee0579a8ba4621d72debd92265f4ec0dd0e2b65ef721e966372a452927aea06535872c189e738ee8137eef316a9942d78705549bb10d5c35a1ee732bd61adf0bf4e929921e6ab8cd49183c815111d2012bee00c05565c303d435ac7bc2527c98df7a3f6fb1f6f4a6556fba140a872b87b1a7b7a235bd6a64f4f398f938063e839827ad75853630394e44448294c541b1a7210caa48c92074fa6f6a75482876dfd092ca98d45273d6177e74568a6bd0de4f8844053880e0f330a0c45cd08a771f22e1faf11c027843cc07a9ea8291946ec86f285d3516a554e4e20d21475a213feca317eb889310377b8c2d86e460e3d3a62ecbada773f2122537f888cae4209c38786200c0dbad2271ec5298785426e7af8e32a1ddf23a726940143a4fb5a145d7586cb81550e7db846502af360a6db3cae7f14ce4122f5f3b3adef069179f906853fea208461180c644526865940b36667a871c0b5a7730f505827b7f708cb219de282ebe67bceaaeda18dd4595a7b8fe0d46856ab3c94cdb64df4e79bfa3fdb8dc67c4dd5a87bee8362a8f540717366552295f9b7a74de939f6eec6e505fce6dc5ab92e8f6dbaa892700638c09c750d708296db4c0f073fec55dc23c7ad05ceb793afee23c205395a7f588211c78ddb93c03652e843bd6412c911bae629ff43a91f946bbc6c2cddafe5a3a06c06c03359aaaa0eed450ac9c5bd4d0994cf72bc7d7bd816721c1a3d9bbf1eac3d2aec9583825b729c71b50ee5710ea6b787338936dcf092aaf9f8bbc26ec75b60faa45f7c7d4e49deffc152dc2ae5666834eee3693d94d73fa379d0150229d35e95b6f94c91b7b5390fa61539380467d604d0c23892f28f05ea7849a4875caa3364e47d1c528cada61edb4e117da85dc318dc32c1280637446db5fe26dddf3787bd1f2dfc7266a68c7eba75403bdfd9d539e077a88705525052ee07b44b7b42f4c4da633123a02b18a0ef0aa4cd507fb52b4568fdb591e6cee31f698e8e7af92042d5a223aa21a62d43e1102787bd61aa377b9adbc0fffcd86c8e75ab154a5ac55418d87dae952daed8c4d794fbea7f27e41e23bb353beb683c9326669d305591e6143cdcc562a29a22ede4829e323433afe427674878024b5f4c68a398c6e099e4fd5d66a62c51efe3c1b7f3e1db465ff8a3335a49a44b9c1500de9798c7df65ddc22286f616ec2e8893ea2fdbe321fc9cf93c470d6fffc0bf22a0c388ae12a21ebba82cbc73b445fc2726d3ac9ffe18c9f11d6aa5d672569f969a5e11e35c2a0f724db8faf2b5a7abe9e4b36a531adc47ca40b5dbbaa37d049bb45562c76f291ad4a19e00859fa7e6d42bd81045c22f4050831121717b8b53802394579a9b2d645d03880c23647178b2359f3d14a8884c8413a69f60a600c9e29eaa1db7c962acacccee2580268e0fb97a41d9dd4f7b8c7e21212c338d1f5ce6bd33cf1ba9a9a11a7f42e44d3545d39b4ef63581f09274399dafba55a93e5f3c5c323aedfd5f0f27290b40cc6ddf1bae80a6652cb6c1d66e18f2cc078aa48b2cb3735023e67ea5206a8aa268d9681c19b69d516ba7fa4effc0980bf3efbb809daecc1938bac8a43ce70ff4a8ac759fc8c29222efb8b9f83d8e61425efb9c925be3148ebf5c416a9f7411c8a91931eb023be83cb957717cf977034dc73e32f1474c56145ab60dec6bf874b3793957768807b2c35bb057b6a740ce4b4b8a1aeda8c0e5ec88a9ccb891e57c17f2c2575d051c7e341f91ee50b39722eb275d536612ce540f284da9df8123dca202dc7607702cfa24bb8df5dff05e6ef47b59a649c8c16af21e3f216aa2f5b10a3dff521d0cb8806a72412cadc6c53c6ab78af12980fe64424bf062ed326a99ceaaed3e1eb96d609a164a1a41bf32ea844c13f5a0087cb80c5a8dae749f8afbaf8a6ada3b8babda5ec19a8ecc651dcf9f7766c500fea051a346ce7307faa9ce7e45310dcfce340461c0e4eba366c16c30336447c2d7cf59a99a00dc9ebc71214cfb03d36c9fd46772f56337ae8f1f331922fd2356cb14aee28f88aee5e7a6017c1743660ace5e8339e55e7b00a75375fa43f572ea809d50c7d951d8338771e77cc309996739877636ab867a3e9c2143bdb89e433358ce9052c667b86ca53ca9bd054e242570682bcf0afe99c1da5fae6c12bcf577ee9bb96d7ce6c838f51dc5b7deacba0776052c461748a0e709f7cab6cfd3b06159a4f2b49d7968e968a0cca66cecff90502e076d5434ffd89f98aec442a74c11602771cc4735027649395396b968c601b7560232439b03f913814967c2dedd23553c766b508d59701262ec4c918aa699cd0ad8c1b6297d212067ef0a46e037fcc0e5b72b66355a0143a4299602d70c782593329bda703ca06843c1a070f30d10905a27e5d55632147d7128814f17a4add3a36d88a679cf52b625210a012cabc98a70f5674c385ac58e83ebc9befd139425f46e1fdd7aefa5c00bdc3917b96828061f2d63da3b7514e459a730f016f0d2ad09dca4a64fa6f3e004fd436fc71714ac3a026db9cc44ed841ddeb065ba6a9b87417b8ef60abc1e188cedd089d4126d999c9fa4aeae0d113ce60c7ab35427f578d4db72de8ffa0d0c92c10f7ba3829c837176a0d3ec2184cd63976da9f3c8520b48c7fecbdb939658dcc9b1fee9729760c0127aa2331b7e171c2ce4b1ca2c00f85a102911ccd74198160e32ac2d0e5bf51e81a795b31b3fbee2207cc89f3bd97c75958b25df1c97a0b141679f94b69e1d264f44d4506102071e08dc3f43cca026f6cee641d1bbf4cbbce25a8b05d3dc2b21a275aa7386c9cde0b5303363da38d72cfae4a4ecfc7fe10fb322bd08d1ea50618a696e8754476830765b1b5e23f3ebbef85e59565a47d9311998b2ad16ace8875ea3a381b05b9ed051526a051feb57daa054699c61813f0a5588232f722d19d32a7e281cd7e82fb3d47615cb6ee0770cbf226ade98de0ccfb0dcb42e2c03d27821893b1e54282dba813b6435e16ddde5e74323010ca3e7a73e23efd43f1cec3bdb0a1c8db8a352d9851e012715119bacdfeb4c273b0f0307c2cd387a9584f6eb78278443af7ce04501510fd077618dfc08970b2c04a9c1fbbbd8d1a5f3dbac2d47388d2234919cd9bd46f85457d8a60d0f9418e70bd540a79cbaa3d3dbd530be583fe0c8bb46c70fc84a22cf7ecc3c91c1c211b5bfa7252c7ba6b320a1a9e83eb1e27e69d4aba353fbfb1bbe01ae589852727636360376c6eff6353bbb7f97fbd53e3af0be9dd85251e9031db68f53565924942cc8dd3a32b8fc5256fb5e3b1fd3575467e4ee6931b02531aef7cf0757fc924522c189ce853eb046bb6a3b2cbea4812e113c1bd5922864f6be15a27acd180433c0bc25b1af5144ccba14f28a192559fdbc9385f6d2b4e30998548677a4f56e2d447db28ee1992d1d3609ed8b8228000ac15296110f85a258ab19233d46b4c3c01ce58f544ad1dfd6444b4822bebe1dcd38f71684d0a39bd755ba68203736327a5c328be3751a1a292af058c53c83fc88676c61999ceba060cb054ee09a98a7dcc4cc7b15d9d3ead1a98d789d8fe2355859791d349aec8e5cb7d9deb6be56572bc2e6dc9d1d6b765737ffceb2c982be535df06cd00f6716fedf6c40e66563de2ae7011cf9ca247adcec828d4947cb0095f162e7cc180d678829d3c22901bab72f95ebdcd5dfd656d648a4ef6befe0d76c3aeb1a56dc489d2b750aa750294e124b9be8faf367fe16841d8151f67ac4e021cfe6d0d300eebbf41f58fbb72bba8528a11f090877958800ee65a3cf47bab8b5a4f94e476bf1b6397b8a3b42f7118ca0e6a163f61d4e2da786fd65f8c901b7b5b1fcf17b35b3a09e6170dbdb302c26056da17cf78eab4048101a93482428750fb21a7ec8fd6046750ee524a0998e112ce51649c532b159307a7e63bd38fce14c85051b544f40e8066748602602de8a931d85139038c655f394b3bc71f9a3f4f7b11bc4f90412cfccb4d2b26a197c192bb879e623bbe2d8231a6b4d69b1fab131fb37dedccd4414113956f72e3d0f6ec9b1c8eb1cc04096f4925b85194d79195d9a443148b5efb54fb36f5ece2fe9f931f46cf5686aa57834d650190e7b4b07ec1a78a162adf4fd838123a8b938a7d758a29e730eee82a1a590ba9a461d0ddba887160578ca5c10945e344577ae267127cf465588bed6c37185c9e7551cc4a413fc5596120ea7c69d53178db4ed031c0b75d142238517216be5a67c1f450982d739e92d3fbd0eec4347d7aaf8f0a1fd39309aaac8f5973fdbfc1f2e609fae462762d0aefe997739326f586780f253f130441d757573a0594ea7eddfa2e7c87d44a87ab4679ca64cd4534b04c649a1a995be93596692553938787b7f7f11e28be1c70e417c5083b6402ccf481c7f5dec7f84890bae3b19c9f2c7d57c7680cd465f224ed08f0b3e551b0e0d0e2ec824ff5435b78ebe58e25fa80e0b0500b98c0e03122fe2548efae97c3e31e44cd990034ac5cd541e2ba234d01856a35cebf95545be1824d75252e7c40913adc9ebce21bcd870a100a47d99aeece0b6da7fdbf0406b1617d1f81c5189b1eb8b6bf635982dc6bd50cc09f16f9771ff0c551ffa8bdcefb3c31d266ba9a9d5e601135e5adf1e7fed1611d40b6ddb132c49c77437101779509aa6957df19b4cd7154ea7e284e80f5a9d6f6006b3fe1aa899320071894a729c74e60ed1c862c553b4f10952aeeccf42285cac6e6466684be5c66fa7b2caf5a2244aca48f369d047d5e9d7233682778036196007d76d3bbc650d2c691e4160e43471f0935fb402af5c0f2873b78b37935798fa696b00991978b94c1ed39bcbccf449c108d397198c08c997f92eb321951f803a28c38e3f85c6efe2dcbf6b36e624ff0180c9f78dfce9f41eb104f4581519233b2999bd6d63a1f351c7fd4e0430e91a3af886aa8a04210ab2ebd13b527b1b852b9ddd8179374f5333004c70ea6e1e00e5b6d6163dc56c8777b877bc80c05c75839153ec5ce8a65bc7e22b344b199d5be861713b5ebb9933c0bba8a5c62b2b6a24569e21796422f88f37275b5317c5b327c2e03b25e79cdb0fc5d719452268eb898691c06bd602bec7507c5b15a9ba39b59b590572dac76c46d636d71d8218119d23049a17a30b096a5fbdb578b25632cb03966f2ec97002ca0f30b6986fb36c2b0a416e72b4e1a47689f0e52fac65f2ed4cf1cc28dd2753abefdd2bbc87eaf8dd02aedab18779c8789adc48cfd82ee1a78834ecb6e1f12cdee3d14f82e5841a88f9dac2f60241ad1b27a97fad68a7aeb8816da8cdb3975d8d8b5dc51d2664a346a3df6baf7c6603e1630b5ecc68e3bbad6c2bb1f255d72215a00","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"e51cb6d05ed027db058edc159e71b81e"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
