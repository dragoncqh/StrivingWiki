<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content=""><title>使用MIDL导出COM组件的接口和TLB类型库</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="使用MIDL导出COM组件的接口和TLB类型库-0D572FE2"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">使用MIDL导出COM组件的接口和TLB类型库</h1>


<div class="body taskbody"><p class="shortdesc"></p>
<section class="section prereq">要求正确安装了VS以使用(OLE View、MIDL等VC6中的工具)</section>
<section class="section context">有两种方式可以根据COM组件的OCX或DLL生成tlb文件：</section>
<section><ol class="ol steps"><li class="li step"><span class="ph cmd">使用OLE View 产生对应.IDL文件,</span>
<ol type="a" class="ol substeps">
<li class="li substep substepexpand"><span class="ph cmd">开始运行oleview调出OLE/COM Object Viewer. 这个工具是微软提供的，在VC6中和Windows
SDK中都有。 找到要用的COM组件，比如说COM组件EpiDBServiceV4.dll，直接拖动到OLEVIEW中，并点击导入成功确认键</span>
<div class="itemgroup info"><img class="image" src="../../images/2019-01/oleview_1.png"></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">OLEVIEW会打开ITypeLib Viewer，其中自动生成IDL文件，点击File&gt;Save，保存成idl文件。</span>
<div class="itemgroup info"><img class="image" src="../../images/2019-01/oleview_2.png"></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">还可以直接使用VC6或者Visual Studio打开dll文件，注意在打开文件对话框中一定要选择Resource方式，VC6默认是auto。找到资源中的TypeLib，其中的文件可以Export成bin，这个bin就是tlb,保存的时候使用将扩展名指定为tlb即可。
使用Visual Studio的Object Viewer可以直接对这个文件进行查看</span>
<div class="itemgroup info"><img class="image" src="../../images/2019-01/oleview_3.png"><img class="image" src="../../images/2019-01/oleview_4.png"></div>
</li>
</ol>
</li><li class="li step"><span class="ph cmd">通过MIDL命令产生.IDL文件的.tlb,.h,_i.c文件</span>
<ol type="a" class="ol substeps">
<li class="li substep substepexpand"><span class="ph cmd">开始-&gt;运行-&gt;键入：cmd,调出命令行。</span></li>
<li class="li substep substepexpand"><span class="ph cmd">直接使用DOS指令调用MIDL.exe来生成tlb文件： MIDL YourName.IDL /tlb
YourName.tlb /h YourName.h /iid YourName_i.c /Oicf</span>
<div class="itemgroup info"><div class="note note note_note"><span class="note__title">注：</span> <div class="note__body">MIDL是VS的命令,如果出现文件找不到,是由于您的环境变量配置问题</div></div></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">也可以在VC6里面使用MIDL对IDL进行编译： 先把IDL文件添加到项目文件中，</span>
<div class="itemgroup info"><img class="image" src="../../images/2019-01/midl_1.png"></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">然后：Project-&gt;Setting,在左边的树列表中选中*.IDL文件，选中General选项卡：在Always
use custom build step前打勾。然后选择Custom build并对其作如下设置： 进入Custom Build标签页.在Command中写编译命令，在OutPuts中写输出位置。</span>
<div class="itemgroup info"><p class="p">Command中编译命令参考： midl /Oicf /h $(InputName)_h.h /iid $(InputName)_i.c
$(InputName).idl</p><p class="p">OutPuts中的输出位置参考： $(InputDir)/$(InputName)_h.h
$(InputDir)/$(InputName)_i.c $(SolutionDir)/$(InputName).tlb</p><img class="image" src="../../images/2019-01/midl_2.png"><p class="p">如果是在VS2003及以上版本的设置如下：<img class="image" src="../../images/2019-01/midl_3.jpg"></p></div>
</li>
<li class="li substep substepexpand"><span class="ph cmd">然后在VC++的工程中引用可以使用 #import "XXX.tlb" rename_namespace("XXX")进行调用，或直接使用上面生成的.c和.h接口文件</span>
</li>
</ol>
</li><li class="li step"><span class="ph cmd"></span><br></li></ol></section>
<section class="section result"></section>
<section class="example"></section>
<section class="section postreq"></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="VC%E8%B0%83%E7%94%A8COM%E7%BB%84%E4%BB%B6.html">VC调用COM组件实例</a></div></div></nav></article></main></body></html>