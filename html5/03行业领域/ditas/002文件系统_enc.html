<!DOCTYPE html>
<html class="staticrypt-html">
    <head>
        <meta charset="utf-8" />
        <title>Protected Page</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- do not cache this page -->
        <meta http-equiv="cache-control" content="max-age=0" />
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
        <meta http-equiv="pragma" content="no-cache" />

        <style>
            .staticrypt-hr {
                margin-top: 20px;
                margin-bottom: 20px;
                border: 0;
                border-top: 1px solid #eee;
            }

            .staticrypt-page {
                width: 360px;
                padding: 8% 0 0;
                margin: auto;
                box-sizing: border-box;
            }

            .staticrypt-form {
                position: relative;
                z-index: 1;
                background: #ffffff;
                max-width: 360px;
                margin: 0 auto 100px;
                padding: 45px;
                text-align: center;
                box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
            }

            .staticrypt-form input[type="password"],
            input[type="text"] {
                background: inherit;
                border: 0;
                box-sizing: border-box; /* This ensures padding is included in the total width */
                font-size: 14px;
                outline: 0;
                padding: 15px 30px 15px 15px; /* Adjust the padding to ensure there is space for the icon */
                width: 100%;
            }

            .staticrypt-password-container {
                position: relative;
                outline: 0;
                background: #f2f2f2;
                width: 100%;
                border: 0;
                margin: 0 0 15px;
                box-sizing: border-box;
            }

            .staticrypt-toggle-password-visibility {
                cursor: pointer;
                height: 20px;
                opacity: 60%;
                padding: 13px;
                position: absolute;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                width: 20px;
            }

            .staticrypt-form .staticrypt-decrypt-button {
                text-transform: uppercase;
                outline: 0;
                background: #4CAF50;
                width: 100%;
                border: 0;
                padding: 15px;
                color: #ffffff;
                font-size: 14px;
                cursor: pointer;
            }

            .staticrypt-form .staticrypt-decrypt-button:hover,
            .staticrypt-form .staticrypt-decrypt-button:active,
            .staticrypt-form .staticrypt-decrypt-button:focus {
                background: #4CAF50;
                filter: brightness(92%);
            }

            .staticrypt-html {
                height: 100%;
            }

            .staticrypt-body {
                height: 100%;
                margin: 0;
            }

            .staticrypt-content {
                height: 100%;
                margin-bottom: 1em;
                background: #76B852;
                font-family: "Arial", sans-serif;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            .staticrypt-instructions {
                margin-top: -1em;
                margin-bottom: 1em;
            }

            .staticrypt-title {
                font-size: 1.5em;
            }

            label.staticrypt-remember {
                display: flex;
                align-items: center;
                margin-bottom: 1em;
            }

            .staticrypt-remember input[type="checkbox"] {
                transform: scale(1.5);
                margin-right: 1em;
            }

            .hidden {
                display: none !important;
            }

            .staticrypt-spinner-container {
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .staticrypt-spinner {
                display: inline-block;
                width: 2rem;
                height: 2rem;
                vertical-align: text-bottom;
                border: 0.25em solid gray;
                border-right-color: transparent;
                border-radius: 50%;
                -webkit-animation: spinner-border 0.75s linear infinite;
                animation: spinner-border 0.75s linear infinite;
                animation-duration: 0.75s;
                animation-timing-function: linear;
                animation-delay: 0s;
                animation-iteration-count: infinite;
                animation-direction: normal;
                animation-fill-mode: none;
                animation-play-state: running;
                animation-name: spinner-border;
            }

            @keyframes spinner-border {
                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>

    <body class="staticrypt-body">
        <div id="staticrypt_loading" class="staticrypt-spinner-container">
            <div class="staticrypt-spinner"></div>
        </div>

        <div id="staticrypt_content" class="staticrypt-content hidden">
            <div class="staticrypt-page">
                <div class="staticrypt-form">
                    <div class="staticrypt-instructions">
                        <p class="staticrypt-title">Protected Page</p>
                        <p></p>
                    </div>

                    <hr class="staticrypt-hr" />

                    <form id="staticrypt-form" action="#" method="post">
                        <div class="staticrypt-password-container">
                            <input
                                id="staticrypt-password"
                                type="password"
                                name="password"
                                placeholder="Password"
                                autofocus
                            />

                            <img
                                class="staticrypt-toggle-password-visibility"
                                alt="Show password"
                                title="Show password"
                                src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg=="
                            />
                        </div>

                        <label id="staticrypt-remember-label" class="staticrypt-remember hidden">
                            <input id="staticrypt-remember" type="checkbox" name="remember" />
                            Remember me
                        </label>

                        <input type="submit" class="staticrypt-decrypt-button" value="DECRYPT" />
                    </form>
                </div>
            </div>
        </div>

        <script>
            // these variables will be filled when generating the file - the template format is 'variable_name'
            const staticryptInitiator = ((function(){
  const exports = {};
  const cryptoEngine = ((function(){
  const exports = {};
  const { subtle } = crypto;

const IV_BITS = 16 * 8;
const HEX_BITS = 4;
const ENCRYPTION_ALGO = "AES-CBC";

/**
 * Translates between utf8 encoded hexadecimal strings
 * and Uint8Array bytes.
 */
const HexEncoder = {
    /**
     * hex string -> bytes
     * @param {string} hexString
     * @returns {Uint8Array}
     */
    parse: function (hexString) {
        if (hexString.length % 2 !== 0) throw "Invalid hexString";
        const arrayBuffer = new Uint8Array(hexString.length / 2);

        for (let i = 0; i < hexString.length; i += 2) {
            const byteValue = parseInt(hexString.substring(i, i + 2), 16);
            if (isNaN(byteValue)) {
                throw "Invalid hexString";
            }
            arrayBuffer[i / 2] = byteValue;
        }
        return arrayBuffer;
    },

    /**
     * bytes -> hex string
     * @param {Uint8Array} bytes
     * @returns {string}
     */
    stringify: function (bytes) {
        const hexBytes = [];

        for (let i = 0; i < bytes.length; ++i) {
            let byteString = bytes[i].toString(16);
            if (byteString.length < 2) {
                byteString = "0" + byteString;
            }
            hexBytes.push(byteString);
        }
        return hexBytes.join("");
    },
};

/**
 * Translates between utf8 strings and Uint8Array bytes.
 */
const UTF8Encoder = {
    parse: function (str) {
        return new TextEncoder().encode(str);
    },

    stringify: function (bytes) {
        return new TextDecoder().decode(bytes);
    },
};

/**
 * Salt and encrypt a msg with a password.
 */
async function encrypt(msg, hashedPassword) {
    // Must be 16 bytes, unpredictable, and preferably cryptographically random. However, it need not be secret.
    // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters
    const iv = crypto.getRandomValues(new Uint8Array(IV_BITS / 8));

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["encrypt"]);

    const encrypted = await subtle.encrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        UTF8Encoder.parse(msg)
    );

    // iv will be 32 hex characters, we prepend it to the ciphertext for use in decryption
    return HexEncoder.stringify(iv) + HexEncoder.stringify(new Uint8Array(encrypted));
}
exports.encrypt = encrypt;

/**
 * Decrypt a salted msg using a password.
 *
 * @param {string} encryptedMsg
 * @param {string} hashedPassword
 * @returns {Promise<string>}
 */
async function decrypt(encryptedMsg, hashedPassword) {
    const ivLength = IV_BITS / HEX_BITS;
    const iv = HexEncoder.parse(encryptedMsg.substring(0, ivLength));
    const encrypted = encryptedMsg.substring(ivLength);

    const key = await subtle.importKey("raw", HexEncoder.parse(hashedPassword), ENCRYPTION_ALGO, false, ["decrypt"]);

    const outBuffer = await subtle.decrypt(
        {
            name: ENCRYPTION_ALGO,
            iv: iv,
        },
        key,
        HexEncoder.parse(encrypted)
    );

    return UTF8Encoder.stringify(new Uint8Array(outBuffer));
}
exports.decrypt = decrypt;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
async function hashPassword(password, salt) {
    // we hash the password in multiple steps, each adding more iterations. This is because we used to allow less
    // iterations, so for backward compatibility reasons, we need to support going from that to more iterations.
    let hashedPassword = await hashLegacyRound(password, salt);

    hashedPassword = await hashSecondRound(hashedPassword, salt);

    return hashThirdRound(hashedPassword, salt);
}
exports.hashPassword = hashPassword;

/**
 * This hashes the password with 1k iterations. This is a low number, we need this function to support backwards
 * compatibility.
 *
 * @param {string} password
 * @param {string} salt
 * @returns {Promise<string>}
 */
function hashLegacyRound(password, salt) {
    return pbkdf2(password, salt, 1000, "SHA-1");
}
exports.hashLegacyRound = hashLegacyRound;

/**
 * Add a second round of iterations. This is because we used to use 1k, so for backwards compatibility with
 * remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashSecondRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 14000, "SHA-256");
}
exports.hashSecondRound = hashSecondRound;

/**
 * Add a third round of iterations to bring total number to 600k. This is because we used to use 1k, then 15k, so for
 * backwards compatibility with remember-me/autodecrypt links, we need to support going from that to more iterations.
 *
 * @param hashedPassword
 * @param salt
 * @returns {Promise<string>}
 */
function hashThirdRound(hashedPassword, salt) {
    return pbkdf2(hashedPassword, salt, 585000, "SHA-256");
}
exports.hashThirdRound = hashThirdRound;

/**
 * Salt and hash the password so it can be stored in localStorage without opening a password reuse vulnerability.
 *
 * @param {string} password
 * @param {string} salt
 * @param {int} iterations
 * @param {string} hashAlgorithm
 * @returns {Promise<string>}
 */
async function pbkdf2(password, salt, iterations, hashAlgorithm) {
    const key = await subtle.importKey("raw", UTF8Encoder.parse(password), "PBKDF2", false, ["deriveBits"]);

    const keyBytes = await subtle.deriveBits(
        {
            name: "PBKDF2",
            hash: hashAlgorithm,
            iterations,
            salt: UTF8Encoder.parse(salt),
        },
        key,
        256
    );

    return HexEncoder.stringify(new Uint8Array(keyBytes));
}

function generateRandomSalt() {
    const bytes = crypto.getRandomValues(new Uint8Array(128 / 8));

    return HexEncoder.stringify(new Uint8Array(bytes));
}
exports.generateRandomSalt = generateRandomSalt;

async function signMessage(hashedPassword, message) {
    const key = await subtle.importKey(
        "raw",
        HexEncoder.parse(hashedPassword),
        {
            name: "HMAC",
            hash: "SHA-256",
        },
        false,
        ["sign"]
    );
    const signature = await subtle.sign("HMAC", key, UTF8Encoder.parse(message));

    return HexEncoder.stringify(new Uint8Array(signature));
}
exports.signMessage = signMessage;

function getRandomAlphanum() {
    const possibleCharacters = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    let byteArray;
    let parsedInt;

    // Keep generating new random bytes until we get a value that falls
    // within a range that can be evenly divided by possibleCharacters.length
    do {
        byteArray = crypto.getRandomValues(new Uint8Array(1));
        // extract the lowest byte to get an int from 0 to 255 (probably unnecessary, since we're only generating 1 byte)
        parsedInt = byteArray[0] & 0xff;
    } while (parsedInt >= 256 - (256 % possibleCharacters.length));

    // Take the modulo of the parsed integer to get a random number between 0 and totalLength - 1
    const randomIndex = parsedInt % possibleCharacters.length;

    return possibleCharacters[randomIndex];
}

/**
 * Generate a random string of a given length.
 *
 * @param {int} length
 * @returns {string}
 */
function generateRandomString(length) {
    let randomString = "";

    for (let i = 0; i < length; i++) {
        randomString += getRandomAlphanum();
    }

    return randomString;
}
exports.generateRandomString = generateRandomString;

  return exports;
})());
const codec = ((function(){
  const exports = {};
  /**
 * Initialize the codec with the provided cryptoEngine - this return functions to encode and decode messages.
 *
 * @param cryptoEngine - the engine to use for encryption / decryption
 */
function init(cryptoEngine) {
    const exports = {};

    /**
     * Top-level function for encoding a message.
     * Includes password hashing, encryption, and signing.
     *
     * @param {string} msg
     * @param {string} password
     * @param {string} salt
     *
     * @returns {string} The encoded text
     */
    async function encode(msg, password, salt) {
        const hashedPassword = await cryptoEngine.hashPassword(password, salt);

        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encode = encode;

    /**
     * Encode using a password that has already been hashed. This is useful to encode multiple messages in a row, that way
     * we don't need to hash the password multiple times.
     *
     * @param {string} msg
     * @param {string} hashedPassword
     *
     * @returns {string} The encoded text
     */
    async function encodeWithHashedPassword(msg, hashedPassword) {
        const encrypted = await cryptoEngine.encrypt(msg, hashedPassword);

        // we use the hashed password in the HMAC because this is effectively what will be used a password (so we can store
        // it in localStorage safely, we don't use the clear text password)
        const hmac = await cryptoEngine.signMessage(hashedPassword, encrypted);

        return hmac + encrypted;
    }
    exports.encodeWithHashedPassword = encodeWithHashedPassword;

    /**
     * Top-level function for decoding a message.
     * Includes signature check and decryption.
     *
     * @param {string} signedMsg
     * @param {string} hashedPassword
     * @param {string} salt
     * @param {int} backwardCompatibleAttempt
     * @param {string} originalPassword
     *
     * @returns {Object} {success: true, decoded: string} | {success: false, message: string}
     */
    async function decode(signedMsg, hashedPassword, salt, backwardCompatibleAttempt = 0, originalPassword = "") {
        const encryptedHMAC = signedMsg.substring(0, 64);
        const encryptedMsg = signedMsg.substring(64);
        const decryptedHMAC = await cryptoEngine.signMessage(hashedPassword, encryptedMsg);

        if (decryptedHMAC !== encryptedHMAC) {
            // we have been raising the number of iterations in the hashing algorithm multiple times, so to support the old
            // remember-me/autodecrypt links we need to try bringing the old hashes up to speed.
            originalPassword = originalPassword || hashedPassword;
            if (backwardCompatibleAttempt === 0) {
                const updatedHashedPassword = await cryptoEngine.hashThirdRound(originalPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }
            if (backwardCompatibleAttempt === 1) {
                let updatedHashedPassword = await cryptoEngine.hashSecondRound(originalPassword, salt);
                updatedHashedPassword = await cryptoEngine.hashThirdRound(updatedHashedPassword, salt);

                return decode(signedMsg, updatedHashedPassword, salt, backwardCompatibleAttempt + 1, originalPassword);
            }

            return { success: false, message: "Signature mismatch" };
        }

        return {
            success: true,
            decoded: await cryptoEngine.decrypt(encryptedMsg, hashedPassword),
        };
    }
    exports.decode = decode;

    return exports;
}
exports.init = init;

  return exports;
})());
const decode = codec.init(cryptoEngine).decode;

/**
 * Initialize the staticrypt module, that exposes functions callbable by the password_template.
 *
 * @param {{
 *  staticryptEncryptedMsgUniqueVariableName: string,
 *  isRememberEnabled: boolean,
 *  rememberDurationInDays: number,
 *  staticryptSaltUniqueVariableName: string,
 * }} staticryptConfig - object of data that is stored on the password_template at encryption time.
 *
 * @param {{
 *  rememberExpirationKey: string,
 *  rememberPassphraseKey: string,
 *  replaceHtmlCallback: function,
 *  clearLocalStorageCallback: function,
 * }} templateConfig - object of data that can be configured by a custom password_template.
 */
function init(staticryptConfig, templateConfig) {
    const exports = {};

    /**
     * Decrypt our encrypted page, replace the whole HTML.
     *
     * @param {string} hashedPassword
     * @returns {Promise<boolean>}
     */
    async function decryptAndReplaceHtml(hashedPassword) {
        const { staticryptEncryptedMsgUniqueVariableName, staticryptSaltUniqueVariableName } = staticryptConfig;
        const { replaceHtmlCallback } = templateConfig;

        const result = await decode(
            staticryptEncryptedMsgUniqueVariableName,
            hashedPassword,
            staticryptSaltUniqueVariableName
        );
        if (!result.success) {
            return false;
        }
        const plainHTML = result.decoded;

        // if the user configured a callback call it, otherwise just replace the whole HTML
        if (typeof replaceHtmlCallback === "function") {
            replaceHtmlCallback(plainHTML);
        } else {
            document.write(plainHTML);
            document.close();
        }

        return true;
    }

    /**
     * Attempt to decrypt the page and replace the whole HTML.
     *
     * @param {string} password
     * @param {boolean} isRememberChecked
     *
     * @returns {Promise<{isSuccessful: boolean, hashedPassword?: string}>} - we return an object, so that if we want to
     *   expose more information in the future we can do it without breaking the password_template
     */
    async function handleDecryptionOfPage(password, isRememberChecked) {
        const { staticryptSaltUniqueVariableName } = staticryptConfig;

        // decrypt and replace the whole page
        const hashedPassword = await cryptoEngine.hashPassword(password, staticryptSaltUniqueVariableName);
        return handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked);
    }
    exports.handleDecryptionOfPage = handleDecryptionOfPage;

    async function handleDecryptionOfPageFromHash(hashedPassword, isRememberChecked) {
        const { isRememberEnabled, rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

        if (!isDecryptionSuccessful) {
            return {
                isSuccessful: false,
                hashedPassword,
            };
        }

        // remember the hashedPassword and set its expiration if necessary
        if (isRememberEnabled && isRememberChecked) {
            window.localStorage.setItem(rememberPassphraseKey, hashedPassword);

            // set the expiration if the duration isn't 0 (meaning no expiration)
            if (rememberDurationInDays > 0) {
                window.localStorage.setItem(
                    rememberExpirationKey,
                    (new Date().getTime() + rememberDurationInDays * 24 * 60 * 60 * 1000).toString()
                );
            }
        }

        return {
            isSuccessful: true,
            hashedPassword,
        };
    }
    exports.handleDecryptionOfPageFromHash = handleDecryptionOfPageFromHash;

    /**
     * Clear localstorage from staticrypt related values
     */
    function clearLocalStorage() {
        const { clearLocalStorageCallback, rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        if (typeof clearLocalStorageCallback === "function") {
            clearLocalStorageCallback();
        } else {
            localStorage.removeItem(rememberPassphraseKey);
            localStorage.removeItem(rememberExpirationKey);
        }
    }

    async function handleDecryptOnLoad() {
        let isSuccessful = await decryptOnLoadFromUrl();

        if (!isSuccessful) {
            isSuccessful = await decryptOnLoadFromRememberMe();
        }

        return { isSuccessful };
    }
    exports.handleDecryptOnLoad = handleDecryptOnLoad;

    /**
     * Clear storage if we are logging out
     *
     * @returns {boolean} - whether we logged out
     */
    function logoutIfNeeded() {
        const logoutKey = "staticrypt_logout";

        // handle logout through query param
        const queryParams = new URLSearchParams(window.location.search);
        if (queryParams.has(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        // handle logout through URL fragment
        const hash = window.location.hash.substring(1);
        if (hash.includes(logoutKey)) {
            clearLocalStorage();
            return true;
        }

        return false;
    }

    /**
     * To be called on load: check if we want to try to decrypt and replace the HTML with the decrypted content, and
     * try to do it if needed.
     *
     * @returns {Promise<boolean>} true if we derypted and replaced the whole page, false otherwise
     */
    async function decryptOnLoadFromRememberMe() {
        const { rememberDurationInDays } = staticryptConfig;
        const { rememberExpirationKey, rememberPassphraseKey } = templateConfig;

        // if we are login out, terminate
        if (logoutIfNeeded()) {
            return false;
        }

        // if there is expiration configured, check if we're not beyond the expiration
        if (rememberDurationInDays && rememberDurationInDays > 0) {
            const expiration = localStorage.getItem(rememberExpirationKey),
                isExpired = expiration && new Date().getTime() > parseInt(expiration);

            if (isExpired) {
                clearLocalStorage();
                return false;
            }
        }

        const hashedPassword = localStorage.getItem(rememberPassphraseKey);

        if (hashedPassword) {
            // try to decrypt
            const isDecryptionSuccessful = await decryptAndReplaceHtml(hashedPassword);

            // if the decryption is unsuccessful the password might be wrong - silently clear the saved data and let
            // the user fill the password form again
            if (!isDecryptionSuccessful) {
                clearLocalStorage();
                return false;
            }

            return true;
        }

        return false;
    }

    async function decryptOnLoadFromUrl() {
        const passwordKey = "staticrypt_pwd";
        const rememberMeKey = "remember_me";

        // try to get the password from the query param (for backward compatibility - we now want to avoid this method,
        // since it sends the hashed password to the server which isn't needed)
        const queryParams = new URLSearchParams(window.location.search);
        const hashedPasswordQuery = queryParams.get(passwordKey);
        const rememberMeQuery = queryParams.get(rememberMeKey);

        const urlFragment = window.location.hash.substring(1);
        // get the password from the url fragment
        const hashedPasswordRegexMatch = urlFragment.match(new RegExp(passwordKey + "=([^&]*)"));
        const hashedPasswordFragment = hashedPasswordRegexMatch ? hashedPasswordRegexMatch[1] : null;
        const rememberMeFragment = urlFragment.includes(rememberMeKey);

        const hashedPassword = hashedPasswordFragment || hashedPasswordQuery;
        const rememberMe = rememberMeFragment || rememberMeQuery;

        if (hashedPassword) {
            return handleDecryptionOfPageFromHash(hashedPassword, rememberMe);
        }

        return false;
    }

    return exports;
}
exports.init = init;

  return exports;
})());
            const templateError = "Bad password!",
                templateToggleAltShow = "Show password",
                templateToggleAltHide = "Hide password",
                isRememberEnabled = true,
                staticryptConfig = {"staticryptEncryptedMsgUniqueVariableName":"8b73cdd5c421b55750b544e3cef01ab841a858cd08f71815ae4376758e9b508545b23895b460191c5f47a7d2d83e5c6fbcd726296395ceea86a489d688958a0b27dc7867f3f78afa01b05aac7badcfc15cf3bafce9542d12511c009d9127ff0a42e806b0818949c3e03f4412a2617a132af04a5b28b48feef6db8cbee2f697928bf1c807d1524e8573edfe75886251c5d6f95fd8c06c6aee104b0f4efb63dd2787d077fb7756d7874fff208f4f26edfc5aa01a990688f3fddce4e5bf870995c7f0d31aaab44106eb66987a429a76effe6e5da1ea85746846487d1f783e2359a5ebbea7734dd8a38231105f2014ce399f083788fd31aa5706b435ea43c52f519dd0a173ef2dc40ceba0859d11b5ea667fd45c3cbc16a3d1e4e6145e2092fab91a6b641b9101b6c3f9371d581d1d2dceb565f5a8e1ae72468f8bcbf56906916aa91f1af2496bf10a02281b794197601e37ed34cd17513db7725f007b1c74aeb17ea391d304cbebec68edc92262ebacd51a73659751d2639244141a32624fde4a84fec5697c3f4fa7222654d5b86fda36c79c7ef6af3d017dfdfc707162ef178f53a10fd012934f8b17c04c412140db4767b8907748fd193bb5796fd523d45352b82d039bc41668a0407aa5ae324d820d216fe903e88616a7f3a9574376ea98d9c5b14ec0c632cc23a70503c2d90379cf8589c5d872d098d1568229b05deb0b0203d57dead8afe4c6e5154c1177ffc92cd22ad5edeb141ca7669197b4c633140c65abaf098373dec0769b3176bd5ecccc591bf941219d1679a51e3752287c72df6362ccaa07ccae656189435edff2097b144ce50efaccddac5857915f36b62673a2b69ab35b38f302baef08f6d6d4f5b4269074d686ebb5a7d4f5eb47b49faf97d5093ee4efe20f81f6b4c019b4bb39adfab48575e9c390f582b9ee54c085cc1f182d22b94979fed436bb268c0421e1c28aa5fcc041c45bab3698ae901aba345331287389c08f874666167102ff3e35d4990c1a38203c3e2430fc04f9e6d143021d3a1c39f57d033fa04d2f86f608c3d731fa7b5a4b2321de4fac8dd16056252e2d1a3d34f31aaf1c6b7a5dddc6d779eee83359a970fc6a4c7fa3556c17e6ebeb2458f5a00cdeddb3f1e4cf8c931bd10329c62f662613b960e68dd6151ae29fa6b7d6fe9176869d12ea64a1d3574a3392fd61ea649c7e8391b6473e377e0815e73f945d6fac847d620aa6dd7c0408fe2b977e54051eebad583050f6d21d9318ae8cb8f5ec4a1208a25f2a732b036c94cc3e5f87f3ac1f7bc89e4d37933038c83a92c686589e893f9a303504ab3223a48d1ca63faefae0420c1816e183d85cea27401de77725a9818987478c7f151842ca7a1a3fb9349aaae8d34bf41b71b32614f826aaccad9386b9f1516ff63577ee4d2dd82ca6ef0ad2dc5efffd257085560a3a15a0018494e3d620c43ce8ff9702140537cb4eb3102a46a961315ac0a008138212c67b7eb4bc0abb0cdb70b10eb39d89c63954008ae4ba946a44c63dce7160d0932573fdfccb8c7a3b0e9cb9d2a56ee86ca4fe5eb5e3204a1fdae0acc46881146dfd960b46c37788033a4ab83165266b629b4645bd39b427805ed5438f0845f5cef1be04c78e9d1f3797d1c9aa04d8b6c4f80ba73e4c72edc18216d6b53d4aa67ded5c639ef285fa07a74e2d09b11635c44630ace0c12f3915ab6822594c3ab0f963e3c65f63ae864d11ffadfd832b7f98cd856a77bc397e6573ef80d2a385aa511d3ebafcd17f00519d5f770135a93f71834316ac5498dec84f46dd9c0881ea1cf1af7d1f62d8db2ed2c100c69a614b8fa63a308a3fdd6f076e60045489678e71c72f1298709df49fe890f0e025957ab40fab84d11ee8890ccd5d5c99b59e319322aed9d1698854b49a96a5a961648c1dd8ef71913c62a4f87fbb9681dba7b985bb5f1adde533c8f91bfb1cc2bf6c729f24374f2e19700d325ce56e2a5c8f288918ac374a5f6b15337fa1de0d6ec7c4d2a1011afd2f33a4996c551b486d8da9814a8f5caf2fa31cf464053633513f16b939eab530f760ea7286f3e6cdf67588b3ac5288ca975088a497f788cc9fa13856f69dfcdbe983c89705d7784adce8f134089242b60efa893c2872a7ef2f4d186cf3e0811c66fb522848dd907b4ad6647233a00228a40dcdfb33abb3e7da3907794b1bf7b4b6cda9a6906f91d176d077935e1b63fc28deae17247e63b909795e606bcc62414ca2b57edea160b89d35066303b4bc4eac00c8be53740682e0db599e986b5923afcd90224a9a50d1e38b42bfb7c2ca33276b4c69d3e076a5e84048affd5cc13e5c218ab6eacc0224d606015d397d7f3db425c145eb1bc31ebfbb07be898e81eac08420e5cdf7a323df90701dc0b4cb3851973f7be03099a78d0a30d63d04e15d134216eddb0ea28e6af26d71ea86f7c0437943efc48a814e0fc3b0f80275f6b0b6c8930f71fe2f520d3849036608fde6aea398743d4fb3b67c7b5867235ceed788c1be081ca3ab0a7bb1f51a043f8238603587eb12a3b3bec0a85fdeea69583d4186e0e8d55b7f98c4378036173a40bfd54e8e84625ea3fd8eaa213ad76a623cacefdd32f4633847c6006070baae5d4845b9ff1d631f4659b078f17766a6907e71617a2452f0f7c0f13956eeb90060868214a2e7ca63ede94381dad9b54d8dfc245e0a1657d12ae7ec670dd005615dd808cc5a1f2e100ea7ef9f0b44d0264c00fd00583bdfd1c404b7d10f15d3f0de79ea011afc7df77eb7572d351163b557b727bbd2511041c4d77cf7ce6f3f376ab9666794bc92a0f1b2dff40896b5ff3daaa936a019c97c1642f07edf7e6efb156b0f0c8a771ff16a2e5f40cb5ed935c171bf1b3df3556c18f4991381bd9021c9a86975c31180c66f61dcda6be32ae1aed22c2544f8444941d2d554c041735abd85e2aedaa2a4170fe8510d4d8f4c985a1f2cf5a8f5e134357ed183ac5c394fc7708af418b59cffb5561c9289f17655ea303d0082dac50577dbad725563eda408f95681b29fc2bb24b3c91b4e673b272421b12ec470da29ae55d17260dc7acc04641748dc993039c53e62627eb84ab005219eabc1d504c06311b20f81847185e88f69bbd78a10783a2af6d1bbb414ea4868f8ddf76115cb03db7f1b852da958a9dd0c6943e3f90105539bcbdbd279a50c158a72956127ace55c3fa3979125c6bd47b155220e4b1f36f847f85d78ead2fbda08eee7cf2dd4c0849e052f004c8a13dcac76659796219f3e844e6cdd36ca459fa0b1ac38c46212847f1b308ec3dd17a2ab8d65b66f679a5525a5436e613a05323fc50c19fb8b4fcaa50fa96456e0c7be2efe66a3ec431148029b759c213a3e9091f54fba1ea97a703bce532bd0635f208a0976deaa2d377db73c52c26e23ac5c4db2db0b14c027a0e6e01fe23f2d0295e92ac3e2e57429d1bd01e93f86a9123dfbff8ffd8ed900956c1382db1933ba239d934ac6331d667a1b60db64e51353671075b4a63fcdcc10afbd848dc3ec067f81173419dd1a64ee8b96f5568e41f48bb48263dd24fcee6992de420eb7435877c356b408dfe14c705b51feffc9ab1b6e87dfc85476d56ef8b6e334d8f3cf9f5b9f1356790aae3cd2d27cad80622ba08b680ffc07e769becab7632fb62625e3af07e7905307a1d693815543d83b3afdc15548fb5d6d69d3761f2527a3eea898ef2c35fca2e9cbc980d176ee99642ec006c00f33aab39696e2242fedbe70e8633194bd0a841fe8025767b6c0f133cdcc2dfcfcf7592635e5ae02e6ca80b6ed33ce14444b8ddf2c6dcb14f84823332ef44a48851cd3bea3ea9ef7e67c6bf78f3da4b8da53426a0e88037e3e6bd533edbd0d46264f505b3d9fbf43f40b93ad72929afa68f468ab987b1bbaf2f6eeaa112b5859f4360e1ee1c69b00b2a200fe2c7d62f51aae00855be2c6115b02809c22823aea056a301b6c21487f95c1295b84cb1276568a961c17002aadd50e056feb46460665011649865cbcb4b240625c63c6f3d57b001c2ed92357a508013ccd80ac45ea6b502a023d5380b5d6aac1596a049d99f538ee1a426c6515c920b870452a84f4fe41641b175c3d803fbe1d2ef281c69804b8597f12b817bc5971b565aa9878034d25ef7d58b15ffb31733a2ed1e59cfee42322de9772f65681e2a6ac3fc2ea46a6abb214ab20b75efed6a731262255db7a32582f784001e25e2bd5fc1c2a7c01c29cfc081e089ee598f58111aa407d6fa5598bceec1a32833aee4d4f7c5d1dcbe76d20817009a205cce95bb02cd1cb15e12822a7fcc12a1496362a179a12ed1f757ca47480a3d0fb0f6ba9e4025e40ed1677d30bdc9d00db631d563002d9e026ccbee126ab359ba6b995468a4d3acad5e82286c078038db581f78ffe5078d6f4e2031ee5bd36e210fe8219a40ef1f05564dda023ef4e7077a66e840d78cd38ae814dcd3d64b96e9db35387653151d0462f4b2afdfe5c3ead30796c84a77ce91eed3204a4f85985cadd5075a941d030e0a4b300fafe2946fd7915a240295b372a139eab4facb47dae61bb5719495e9b644f2013c9ce65ea0341ff7d2cf0ba38d346d0780df120301dbfba6e450e5629a87cec0f2cc06fa3157b75ee2e969c2d1e9d13a6ae16de76536b6588ca323ed7a8a76f4b8f1e20c3a8888ef4e3282c58e5c01313c950a3577e39787828354b6297b412e54b7ff1c0ff2eab0ea33d8f5fea9d4f6f474de5bb7037e5f5c7a9850cd5c11a4061a1fb9bfaed82c6f5aceb75145abcb0406c512dfe04b732ae5302cf293f6c254a0227cbe22a12ef4b1a879487ccc1c96033080adf04b039c40e3f8cdd1517994f0a1962557f36279b87ea8b4fb81538954ac718aa9e91234f4356492d6b9c0e6eda9d5f4e7c6555b0262c877cb04f1172d160688a6e8d269cff2d1738b169092f29e1c67e3fb952f1cbc61691815cdd8e39fe3d53e52d11d3b00e6ab30246c0f67564d9414cad1e4e88a435437ac754c5944a84c54dcd240b0e76fc03750078593dc6e18ef4735d7feb68a998b219e9fc3760621183a16dff80cc605344e7eb0d3d98292a3ac93cab3f6c39ee905c1f27d3e83e4a216c6518f4361bfceb096120c4cba8907ef3faf7bc2657fa507d6e00966cda03e28490c54a3e2e44967fb1b54e645fdd75e5c86760d480d3315b16695e9c6eb7c25e496ff856a067be10ce7ca0be99753c074fe17edd2fa630dd48b19b022a1f8136c8c9fc82fc446a9f53f4ca9eaa74d7ece695a17cd1b923bdc918895589f2af789c0446efb7a17003da9602b86164295b49972ccddb611dccd39f40230609c12096c1558baeeadce39953f4db0ba21db62da57758c76d94782b2c5624b9b811491627f0dfa9851df84408726586967ec3ed7e4f4bc43e8f7f02706d3448b59986aeecc505b130cd0cd6daf3ccb76465e9afd4debc339935a963ce773a027415508f764b5ff4a91e5c1b9c999e53cf78fc18d95aaca0b61656f2962e3d1a30d550d49bd0420512e499e77ae082f6062b75b2cafdbc0698a8acb83b36a4917b808d541b47c1d5fd04da3f1fa1085e52b7e5c580789626b2ad19da642543a333ebf8232e0478456f05520654ffc81c5b9beac96be0513c994b218d26dce88b45cfdc4ef02ef33b8457058fd13843fbb9c6ffde4c7381bf0e25bf095f1d8c2c1e1b6485bdf652f67c063e0564108eee568116650292d3bc0ff176c0ac4b9ca2ae297928a29f8afe22d57abe1730ca0a924bc6924a90e4d3c9b10b2fa02eddc0cc6bdabdc2c7ef2d16d74b2532031ef2c9acaaa1d985d4b93c0c16c926d5a38d86e79bba80c7e8f0a0dc6d08b23d004c1cfb8a37367e685ec9971b53a68950ac29e0e75d4f4020ebc03c10e58ea16f47b16072eacc923ba601a10dbdee88508d91f02d9538e967b09dd708fe9d3df0be2718fecca670c61db33aeb72bd47279e4bb81081a823b215fcccb2a48953cec10b9b840fca5ea062bfad93f6a94cdccdf6fa1881a47a36ce5295195ed650ba70dbb62559c132f17e62ad9c9fe8cb5a081e88247034471a3f3844232d0dca926e2bd3f82d8134ec10bae511d6baeb1028cf133a7f346559633b29bde58107775630d368bcb93ae139c1eec95fe5e1162c40b30d0bb32dfb665a36f93f74d663ce31f12704277bcf3a7744692c79208c2603cad9bef58a42f3fdb76a56470e85119e00448ec80226ff4d943da3112d4e272a467e79317dbe4fefb263af95c55c29a3be7ff7b216adaa7e1aad87642c7e7472f6453e00dae37ec6af04dfffd5ec38031f3faccab6cf1c0b12c669be003e46d70b5867d42109f014cf109ae8b9abd1b783a1db809c0d56abd3106a0180b6515de834b588cde943bec2d6281286b7b51e877c9ffa7065aad92e65c0e4dd147677a3da7bc6fe398c78c47ecf8a450c8544a15304d61344f73738b66bc4cd38f36174af615c787299ecf324dc1ca9114c4289f39554d2b43b85fe81f1750475436755c36e1ab5521e7437ef59a1623082831413146798b874fc14209d3a5749b1a19840ea715f3dacae36b9552dfa48497caf4dcc48ccd764ac41055ac14bb17f6b09c5ebb4c09321954ba3429140ef4f60da4f0e362d079f8bf16e9740d2fdebc84950338d970706d3dc440c1ecce8749583da048769ec35bb3406103890be97d3407ec8fad8ea63d678e4ae2a301029e2deee2344a3b874500f91e53f9cdd35d8f0dee2ec49918da5bc822ecf0477d6617a945a42210249965ebc6264d81e9de04ceb5d2adae3d658c63cbda9b3d643663db885dfd67dda88039c43f76e2b914432821d20b1d2f461cdfbf466aee9f40a00277e171ce35ec9a2100f65ed19f66362a2dd8bf7b90982eb0c75bf65438e1a6f308d4b88743c81192f390046e43dbbd033932bff3c5cb690891b8f57abfaf935ff5e33cf0946331ef3af9d4251bef38ba2e949675a00ad8bc520ec15d099fb3ccd0f8a054804b74279c2189f3bce8fadbe0e29f01fb3d6e2ab5e548b771179052060d6b12e3ee7aa5d3bb4969a2fc3cab66aac5522d5e458b4f7c5da7f230c68b9f8ef223a2e543ee375b16e0a9f8627ba52e51a4b05dbc7546cb36c6311dcff5e5e6cd28706a7b7c82b4c102d15900d777ef0667181c9c3a6d5aa0f166c1cfb69fe83b486b085766d1a267ceca4364914c5e65b8bc42175d3c209e21e364421bdb5d11ffc2c47d2a3533446926ad629c9eb9bcab492ddad7f66e7d72bc5e4b66a5bc3392733aed020249d3b3163b5ecae553f98af7a018ac21096c53bb82e0c18775fc51f3e1c8c8299c929235052f1bb1231b22318729c89a870c15b8fba67c5aac64f56467c4ae4df9e8b1f59477b75bb86bf0d6bd8453d8c40fb10d394e7719d34bbb8b4a945104ba158b35e7baa623b2ecd18dde221fa82c9ae00dd3bf2a17714b1e9f72a0d7eed81953b261ecb4df7b72eb14d52b9aa2923d142f86f0206e1c003ae9f0136dcd7eafd3589a1ff730545a237fec8d8a0c7f2623d3fe9e4f2a722fde7842ccea9f3276380d2f51f0effa921daba09c510e0c4076bebe591d4e489909d2b698468d7730301917afbd415cbf27388368bb9df676fe4905adc6461d07617129ac77a7bd28690de83736b02a5ef5e17b6849e0f515d1d233a83a98b27604e53861895c2828c9e6218d6d3185539847628aba15d680a88108ee96a32aec11fc9a7d40892dde4342b5890799a41e4908a11ce02f2981a4325493e662e27bee9589e2af15e4b4a07c646fe69b888c5706fc2f4b9d910316a6d2d0dd506c7391244743eb8a0c7a8550c9d929263cc9251b7aaea89d517851ba9e2e573335af906c4ad553169726303454d9b3d2775e280b5269cb2dc7fe88f88f8adf6eb4fbd4a16f736f3e46794b4926231248c3249304a696ce8b8f0c4af7dbdc748a053854bf84b90d8b5479feedf0ffbeb4b88b5b1cc46c93aee87dceada8b2be230b45df09586ba6532e7edfaae343bc636989892ebd3f6baff1e59b1513315aec3bc8a956e87992d79244bf76c6390c6412559aa1cfcd49df2379d910aa629955b18db9582d64f886fa51f2ef02a2b2a01a58f3e8ad71e9a7d289be2f0a55294fe15bdb47a9518a8c941fd185737f7071e3acdcda6cd165cdd29731417ce29dfa67ffdbb487862f01d00892cfde5e3ba65fa6f8b5a5970ee6795b2603afcf01b62822bb44b5e59d2c119a514b58085b97fcd0bf05e0c08752a6716d2ef220b1b733e901d137e25d4f09965eab31a33b649be1249b8b424878a6c5a35efe41ae1aa54e651d4dcba3c1fa2668f0864ed712a52a62c46784171b2b6877749beacee50a12c6d9144ad063a8523c8bcb8058023409e859195ec49b703ed31eba375c8b008abe661441c5ff5922d4b3adf8039ce2c50de88bcc697c70e5059e2741c1a4e9147dc573e32ccc2ab6c4469943049b55461c5100d6d36f05dfa3b46ae33d57ebec255c4b3ebd10d9e8f21184511b574ef0e5bb77e09b3b097d1094dc1ee83122ea8f2f518efb94359588e4c3197987f24f822b5fdb8e49da5a7463ea256283200c29554ab9c8c748013d75a87ca3e941059fc9f1881a83880354430264131d9f5a6bb96b2e9cb72928ba3ad1578c0e69810a1a1cf1b0c79e73d54e1d75b476ac046c01c1e9777fbb3ef9801ca228e0290a239ca777bbac9e13f20768243eadda091d9d75b1c4d6f9e7d46f960960537414b385b86f2fa987f92e439a15a323d878f0d38c9ec0e3851cee59302b4548df9e988d7f9bbf49a303752cc2be891ea355444894fab88e294e9694179d96fdb2ef997b0f61652543c058e25a6780fb671c2671c0526f9357a5d8b05397eb00593608bc77b8ddb1932bf194a39a2b889dc552b211734bab8a6ea9ebd271dfab2f19bcccfdf78b2873f0b05421411a4054ff8864be9f7e3e9b984c546a1f234bba9cdfc26797c132c76ed13239cd500012fce4926fd3f16b1306cf9302f54f1af3a5937d3c00f8a39a3bf2eefba145ad630bccfc3ac6b7942c309e740a60a0a0ab969501799cdb1f3ea5d741eed18ca4d19af19efe95d155a33884bd86961d0f079df31ebd282848120492315db2bb12d9d262be9a71157aaa0222cb4a140651d217944ea0d7984c59793ee810d1c26182d25c24c6ab646b93ec717da1fb9a69b76b18e3a7e74a2ab70d5c1f1b44c6cf1cb6bc04b0137554eff78e859814afd9e72dbefad9a36bc6b6e74b15cba7a6166e4f8369e6dc2705807d300747fffc57a1e5058528ca9901211fc2077290b2e1248cde16e735104e87ce1ced109aab38b7dfc3ec9da337ec7c20944b15e88e0be8cc0118a8b06b66d73b2eee8fec7b4ab3aa5c679864964c5dc83aac5af8ccf8147d37d94b54e9bdac32b40df0a45eea85c9c1b76f5c8947014e40addf1f89562abd51909c2358d5150d4bfde76331b9b827c55e202c95442a875dcd6451a3ef70c3bcf95672cfb711ae7696bee1df2ad3b21142f2cfa4dd19e04e10c7fec60d1eb774c84d8391f41b77eb7d78e828b363ba8c37a1cee8616a92c2717c50f413dbb91833ddec148db6d8988de861ca7f5b450d74f7ee73d5cfb172ab3e841547e19f4d0dc4c7304768d81b004ecff3b3593324dd08fc12caf0e64ef54e9b34b6af4a85200eafe599676b277080aec727f1637658d7fa418e3a027b50ae83634a9ccea5c63745829650804deb171c048cccc1c31f70ec5b0102bb8c0d766987e253b86927aa2010dac7d808be80f39515e7c88bfbefa06ee8a55dd8d523919070966402d71557879366648b399cd27100f2db9fdf74c604bfb16be666dee69eb100eb988e14b9d30890b6fb75ebf3897c82f49d73241612ed5f0df651803709061da10a3c4f9f3b45eecc9566379df90b70e0d3172297a1df238cc8a03d6b30f7ae22035aec125740ba6f5a03470e9a347ba590ef62fa4080ae45fbe1eb79142c8953a55e37b8fb3d819e631fb5b0f01376bc3ac7a002188ccd2746dd599a4ce140141d0fe89d696cb4e9575fa49f65cad2d91baebd28c1e8d8048efb5e76d7e5b39bd84688eda4fd95b319a73c031cf4fab4c109c05ebdb18f4c6a31280630e60feabf87d3e6dadb3b676902bd01545a93f74dd5ab60c4f812b3be5a3252850a97e21eb4d9e096b2ff6ab335090d3b816ccf6c8a791395f5c47c2e30a88b96798696ca3815406150d0e83602c538a48a9ceecf8a70445fe66da0e01024d03b20dae8de1939a5f36087e38df51d24b14f35a25510c4f07efb3dcfa242451bcb8c111602d5116c5b2bc8f63c1b8abb856e916e7da1372a26d04f51751c6f86b2f7335044b8f5dc6940d8e010d31f85406e22d838ce1fc1bf18bb174b59c43d0c67ab0de910349dfd33144bd1041221f99f63120183b91d895d2a4cc210e94364e849cd5e220fe14bec2c4fa664c9aef49ad8acc190b3301369511e816205b360738a44750d81f674637f574fb124129dd1e6edb3001cf34b006c44b2003801377534f41983658b1f0d97ec76e74ee1f45de55e27302d8081061a6fc297b78b4ee67204a926b7c51deddda2f813ac16963288214115703b4971503f67789f623e714c397ce103535c02bdcc3b4914ecc4109a6ef3b7f8b2acf55df2d48aae408fd8bd7e3dba9c0b91f68d069bbf874f04d8145e278df57263d7a1cd8345190c70828e16755d92c816121ec98acb7ab27b62fa3ca5d67b6f71a4f8cb9f0f37a951737a282f6d19a38f33e351c52fa6e5a0997fe0a5d9b4cb1e9f1a59e84f9213f4b006cefce21212948ecfc72110143e027339a7157561d8be34d524ef76b75a061a4d82b46a833949d9060544410df33711b44a7070fb6eac19623ff9b6e6a1c6f46845fbc2b3f7d1bb484bdb269bd0421ab7f4c41e867dd3a4997068551a6306815840962f1b59efc01d113ed868cef784652023a63a9a832bc985ecf897be843febd28f6e8cb98534285d4194284cfde7cd700a1cfaca8d04d17c77e7b846e54b7ea0a9609b17948eeedc19087ca912b73f40afff3e6d6dc081885749793a4f06d07c7b9f5cfc69fb70edf7a96fbb3d5d3764ec88e43193c9f4f4cb3d28ef23fa1771f5a55d9a4cd6bfa3071e51f86446666217bec099bdfcb3ef7937f0d01678a5a0518a2888a9bc244279807e94724468df2ac5b780e07c6219fc924e6191c99be8ac4f4f6cbae94e4bb753b95573bb6709da7ca967e8b798c80adb63087d05939fbc0df9416430038b95e67d07e92510190425140914bbad91d6263ece051d5a6d0e6007c2ef3cb9a952d0b662aa43b4fc4d4dfb3095d3546452b3587b0f482d0222048347bc739f1f15df415ede3783c3b6fb506c30bcbf1a3ad7b8317331dc279b25bf980a769b2146585a850873a520b6778a0815ee7f11e828d9ad14d34d7a093cde909b03071f082f3ccc0e289e14420786ad02d74994a4b98aa3442128a2d97c996f9c917ea1de172b0cc24e0f01fb8ae5993262e86cae600a2abaf83c089a8f14fe36180cd8e0411eb5d61714502926e86be7260a6945698613294411c8fa22a923b1f18aafa2300b1e42d7c0cdebe9ab8c1d89703524b573d8486270c92f7968856660a6d4e8c9926a64ac894100c1a749a354e97485791206e0ff13a5dc0a66e649a2f008d3aed52c36e366c2dd3cfa283e469b46b0a52d236a0f1b62c664bfca63ebda17ded022cf8e8d9f6e8a2c1fc3bc24733da69205285ff2c76d3206bb6adfd524c1d9ac61e81f8bd7bfc77d853ebe7400cf824653d0d0f02174fbd6b140e6e200be0144ed6a4dcf03ab1f072b5bb5d007c94fcb862a322b6f8d517f24bfb3abbdcd5853e0ed97f45cdbb358a190b0d52b1948beb678bfe06339c211c19510ce4c834ddce5003cfc460a0f426df0db6b1db0d9fccb47d27d6b09c39b4b5af05d182f2ac1f9e02c08213a2727a5ae037bfd6fe7d9ad1f25c72800b663e38900447913e4a18301838f8c89ffb5838d02bd1b9831feb1f63bd04bb1722b3c76056a32a3888934b09b6e3b7309ecaa7e3df1ab38f39087ac231d949ddcad6648dd8cb73532b6e1386e1756d023803857bfe9220896ba00ce5b8f77122173ad92f32404d625f7c60a111513da47812aefba245c9ec4a97563a7a3289e70139dc28d36ee1c97a8aad6ec35e7e188a830edacf67868db88f9d800a5dcefac38464f104ed690017ab219935244c22050405e966046ccc7b03571fc303c7e87f94cfe98335fa4a66a35e0c1f10b562e94e869e9a7293dbf9bf2bd0ff80c98a45efef11b767321a6aac2b57303e77c403c3d215ff79ebb9d25a77a4d3a3c849a738625369252339445c6a6d4a54699eea39f49ba56d361f8d5b7e80f6bc582ac195bcc94fbdfb7a89da7a2b320d51b5b51309f3aef3307d3f99579a109e91033c7bf8e994d0940ba352d4f7de30c9c178e5d66acb3592e2d75f43b8a01f3fe3a2f1ed6e16f79133b40b61d34a099f9f443a201bbf8f3e6c3ab10855a3fc58d36728b687a79068f1db89844715ea2a4d0da3101fb0c1d44c85382e5bd0dae99bddcf4979c233af574b17c4d82acbb809834efccf120aa70c51eea2584d263f5b59c0152b8be6bbf7a711f86104669cbf93b8357862681d673e76c24e266df4764ca2b071455e9e8710688a9822a381b3bca75c71ccf229083ec2a2a4193b90942b4fc617f04c96ab6d26a7f5697b83dccffeab293f1df3ada4fc6c55dd77139e37f7feef445ce56234383bfafd7f7a5b14714abcb36c3f82647ba7f7c338410e3d4132a91524f8071649cc9ad9a8b5c1057b1a7d8ee5a2d09bccc4f329f437478913d275888b0027e9892ab95cb100f4fae096695987f7519e8ba9a34362aad7807ba3ea717ae50dbb1676769b6d08082ff911e3efe3ccb3f517b5e1fecf9b66cc174d1cbded7b5d48b85ce8b4634b61828fca6d496126ed44465099b29b35b351d6ed925889cd8e5c1290d62889c1a98a098f6b59552a6b5265ed8b1d70248ec9f2527dea537bcaa879e54b58135e595d782c8b47b4f0dbc8806b28e7a6c1d8b87736b4ee15a4709174d323396d3d195c142a8a1132b63d5d9fb1fc9dd904b039183f4e5bfec3751d63c1ec711b4abbe6a8a0e0c9800ebab4bf9961bae5e518a383faf2ca64c8d1d240407ab1db4accdef68f82585136718fd48f126c90748af95a741ed97011b3a2fc9ea549b562179f2bf8f053e059a24435e284920af3499a15eb33f5acc643cf03c5849af0526e28312318a2abfd539ef59a904f1889575e812a19aa9f564ef5d74e6a4d62e98d4c5a2c8155514360c85cf47cf6d53300e5f3014e211ff1fd61f507fcafc6622cfcd23cb6dce658d7a5865de1cbcbbc9e194ec5f3209d5aaae48cb8480cf1ee1b1491201215d3979fa98d15b3316a677380cf1a873769307b6140483561d5ebf6ecb3d8af19cb422fef2878e30e0471af7a3aabf9dcc332cfd7420bf198660ad759d8e1d00bb229e0c0b68380c79b075f2f4c80cdad82850507d21d47aafee0790612c81ce1251074b6343a34290734aa25ecaed87293d30bfeea7c3c64b1453970019e502c9da3250221a06d4cd987ce4d0be6483a77da1d5116066e3f7d34964feb3d74f699cd3f169ab03253371330b1c4402146d6424143a790c63903c49aefcd24b1e8f8a28959aec174f91357ec9328b4c01343fc436a7ed7f5b520f1c5c6147cbb1e31493a935d1826f59e8b84efb5e8efb2549c91cd1c38d79dc36ba59a91143c56363baab51d48a7f96962e9d8b985d7c397921600c8b03dfd6998bbd58218a03c8a09fb9ade1890273dd5d4df651f95f3a79e5fb3249fdacf245af60503231345b91f0a6929ed57787e3d99d2940dbccdf10d49e0f0ca0a0ffb41607ab403b968f9dad486809d219cafd653834cbf9e900382ae5970c87a84a76cb830a02b15928e77c733d8b2897f874ea215ff65fb8b6818405403bc69f93c7342526b02162a927f14799cbc73cad8990af4753d801a07a2c7247350329e9c8b37fa1397500a72f4e1807bfbe855de510eb3f6aacf5f1f233d5585f4caeca57bbc8ca4d97b631b7cd17b2b27127686b8e68b50f243efeb0faec0076e3ac92838d890641e566ee1dc895aece62ff2cbe6f8570237032a60884cc2b7d86203712eb159d511f1e4d043a5a5537d7da7c667200ddce96f26f3aa9e301e3537bf016a179eaa80ba4435cfd2d3d6df291285bc56c363f4b77528217b98dee7c79bb4620c27b27bd747ab7a6d0204f86639c01388eb8de8dec136105f246d05e9e1294a0559a3def4e5e697ff04931a0da5567afa6727bf23b9a1f704cad11ed2905b1486e251e4b25d5600318ba8658f8acbde9a14b58083a5ad05987d6ab8c3ce1e89a636de99afec4492e76fe87d045c0d5869781159cbcd80b3a9acc69518273b1474ac489e0abb82b1947f7647fbe8e1a67bfc2049284ae5c23be825585ce20cdb7737dfa585314d3ee779dcf6335eed92a8378343d3d3ecbb9f9d72223ad6de17dbaef24de5f3eb2228a970f9603fd6d61b512b7df0cd4483356aec05aed6b5fb3cccc57bd08b7cf3e2b22bfeec34e887d19a24964e9a289168263da2ecf65fcb8f5a1d38308935db399e0348dfd9bf7bead7e74954a8dde6485bd52cb877a8e20e03e287d13a5c0a84f9bebaec2d9d03d77ec3c8359be7f5e7d1c6b51b6ee0ee9be08e4ab91c1db24a21a22f32572938d8a7c934c5a4beed5ad03a3710c6f08b541d336526feead7d64458bd84aa053e94486f238eae1e039bf0d104a79279aa96fc9a0150d46cd33e988ab2559cba52d1513098da64e37b92d805605630fbfcfceb5f7d9d4f8a5b9a36205d944e2e0d542917962e5e0be94dc6d109a19887719df56a7be72b5113efe30a53e5193da1dce11de9013294b45b59fef5d3a0021ab4a7bb3a0a10de58022413531d1191ce404f9934b8c8043d51b1d7b19f1dbad1d39b2be4dc14b4bb37a9208d6986b339087065690410f222fa765277c630106f29c8a1f716590494008832dafaf90de17f02c32e0ed0e67bc2251cd53bc3cb0dc9cf5e2eb21748742575c8ac66dce77e9f04f063f707e7242c191a6670003f1f9a024d9508ca57d83ed6b157b121fdc9da6d79597f9586d117e71d97e2bbb0c3fecd1b89cc6173ebc063c6402dcfe6b3c6620e9f094b85401cdb0e49eab4703e3e32afa03bb71759156df85320b501a19da564783fab5bea475b331794a12d6d1c00a0431f0f8c3b40a0e083b14bbd07d2f057c9f3b9583a9bf5edc50a2763fa0ef82e517321ed99d3e5c60af9306848a9857e69f236d930dbe1aa9cbc21157146234ce329879b2f8c107292cd378b4dcdbf5a5395f5e56618dd70600e47e5e597036c707a31e97c063b565e0c69acb7a0a7959228295c5ae291143d12f645d14e0f5c11d3b62649af114b57dd4de4e7d04047f18dd6c84f1aa36f04a21faa211dd562592398914c8c3ce7de31ee96f66c7fcd1645e6c7abca4e68799605f280b6e7ae56d70d7f6911613f784264dbbc76e6fc3c609fc7a11112ab4b0f444bb7c48fac39d116bc569af97ea2b1d4e3097a80f5f2e0f78441b8dacc99537c44daa7d79933df252562ff86b03a91a9663848a5bf60366c6b206885afd7b0e2fdd698dda88997e278c0f29401a3c4725ef546d485c68886ab87bfbf15fff534bddce42a0f9d8ab8f339b2d67048e3649e9bb0d552dd79f0e00d51d0ecee34e77da8e9659190c25286ee61b462a07b070e9e9380549a0485710ea6e7812d1d71ff6bf9f3bb7331d0fe3dc9fe6d15dc9d3a7a543ecfa9dfa8aa84a3e5ec880bc86bf1197177fa7666d0dfb51c84a0e654b6d79f4b79b1872e93156c0cb90991680bc7b9c778e24f159edd800a95211b1a859c7448a89c2c7ecb9b322bdb68cb0060743b27e19456e9c75552ed6e0480651329f4ee9c87f11b4697a4ee63473bc9fce0b59fffbdd451f31e5cdc89336506871cb9a78d67d5588473f51f8b0ce0cb8d69579b658d7d292e3919ea2280fb1fa845482af76edc859aed81e2f675b347f78925e3bd0ba9ea6b7203933844d3c80ad939b23555153ce8f9756808f315379f5f2941d6868200cb9b2778be6bf6c4039587a8b78199968bb854d84133a7979b32a6e47d3090c94d84f8250d4fcd05eb3d8558755c074285440a0eea0dab5552780e3489a8432b2dcfbca8968dddeff351d483de4c7354e5b87989c312cb81b73b325a9dcaee98b17ba33956d77cf34701149ab22ec608c4443258af52aa6b","isRememberEnabled":true,"rememberDurationInDays":0,"staticryptSaltUniqueVariableName":"e51cb6d05ed027db058edc159e71b81e"};

            // you can edit these values to customize some of the behavior of StatiCrypt
            const templateConfig = {
                rememberExpirationKey: "staticrypt_expiration",
                rememberPassphraseKey: "staticrypt_passphrase",
                replaceHtmlCallback: null,
                clearLocalStorageCallback: null,
            };

            // init the staticrypt engine
            const staticrypt = staticryptInitiator.init(staticryptConfig, templateConfig);

            // try to automatically decrypt on load if there is a saved password
            window.onload = async function () {
                const { isSuccessful } = await staticrypt.handleDecryptOnLoad();

                // if we didn't decrypt anything on load, show the password prompt. Otherwise the content has already been
                // replaced, no need to do anything
                if (!isSuccessful) {
                    // hide loading screen
                    document.getElementById("staticrypt_loading").classList.add("hidden");
                    document.getElementById("staticrypt_content").classList.remove("hidden");
                    document.getElementById("staticrypt-password").focus();

                    // show the remember me checkbox
                    if (isRememberEnabled) {
                        document.getElementById("staticrypt-remember-label").classList.remove("hidden");
                    }
                }
            };

            // toggle password visibility
            const toggleIcon = document.querySelector(".staticrypt-toggle-password-visibility");
            // these two icons are coming from FontAwesome
            const imgSrcEyeClosed =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDAgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTM4LjggNS4xQzI4LjQtMy4xIDEzLjMtMS4yIDUuMSA5LjJTLTEuMiAzNC43IDkuMiA0Mi45bDU5MiA0NjRjMTAuNCA4LjIgMjUuNSA2LjMgMzMuNy00LjFzNi4zLTI1LjUtNC4xLTMzLjdMNTI1LjYgMzg2LjdjMzkuNi00MC42IDY2LjQtODYuMSA3OS45LTExOC40YzMuMy03LjkgMy4zLTE2LjcgMC0yNC42Yy0xNC45LTM1LjctNDYuMi04Ny43LTkzLTEzMS4xQzQ2NS41IDY4LjggNDAwLjggMzIgMzIwIDMyYy02OC4yIDAtMTI1IDI2LjMtMTY5LjMgNjAuOEwzOC44IDUuMXpNMjIzLjEgMTQ5LjVDMjQ4LjYgMTI2LjIgMjgyLjcgMTEyIDMyMCAxMTJjNzkuNSAwIDE0NCA2NC41IDE0NCAxNDRjMCAyNC45LTYuMyA0OC4zLTE3LjQgNjguN0w0MDggMjk0LjVjOC40LTE5LjMgMTAuNi00MS40IDQuOC02My4zYy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM2MwIDEwLjItMi40IDE5LjgtNi42IDI4LjNsLTkwLjMtNzAuOHpNMzczIDM4OS45Yy0xNi40IDYuNS0zNC4zIDEwLjEtNTMgMTAuMWMtNzkuNSAwLTE0NC02NC41LTE0NC0xNDRjMC02LjkgLjUtMTMuNiAxLjQtMjAuMkw4My4xIDE2MS41QzYwLjMgMTkxLjIgNDQgMjIwLjggMzQuNSAyNDMuN2MtMy4zIDcuOS0zLjMgMTYuNyAwIDI0LjZjMTQuOSAzNS43IDQ2LjIgODcuNyA5MyAxMzEuMUMxNzQuNSA0NDMuMiAyMzkuMiA0ODAgMzIwIDQ4MGM0Ny44IDAgODkuOS0xMi45IDEyNi4yLTMyLjVMMzczIDM4OS45eiIvPjwvc3ZnPg==";
            const imgSrcEyeOpened =
                "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1NzYgNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNS4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjQgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTI4OCAzMmMtODAuOCAwLTE0NS41IDM2LjgtMTkyLjYgODAuNkM0OC42IDE1NiAxNy4zIDIwOCAyLjUgMjQzLjdjLTMuMyA3LjktMy4zIDE2LjcgMCAyNC42QzE3LjMgMzA0IDQ4LjYgMzU2IDk1LjQgMzk5LjRDMTQyLjUgNDQzLjIgMjA3LjIgNDgwIDI4OCA0ODBzMTQ1LjUtMzYuOCAxOTIuNi04MC42YzQ2LjgtNDMuNSA3OC4xLTk1LjQgOTMtMTMxLjFjMy4zLTcuOSAzLjMtMTYuNyAwLTI0LjZjLTE0LjktMzUuNy00Ni4yLTg3LjctOTMtMTMxLjFDNDMzLjUgNjguOCAzNjguOCAzMiAyODggMzJ6TTE0NCAyNTZhMTQ0IDE0NCAwIDEgMSAyODggMCAxNDQgMTQ0IDAgMSAxIC0yODggMHptMTQ0LTY0YzAgMzUuMy0yOC43IDY0LTY0IDY0Yy03LjEgMC0xMy45LTEuMi0yMC4zLTMuM2MtNS41LTEuOC0xMS45IDEuNi0xMS43IDcuNGMuMyA2LjkgMS4zIDEzLjggMy4yIDIwLjdjMTMuNyA1MS4yIDY2LjQgODEuNiAxMTcuNiA2Ny45czgxLjYtNjYuNCA2Ny45LTExNy42Yy0xMS4xLTQxLjUtNDcuOC02OS40LTg4LjYtNzEuMWMtNS44LS4yLTkuMiA2LjEtNy40IDExLjdjMi4xIDYuNCAzLjMgMTMuMiAzLjMgMjAuM3oiLz48L3N2Zz4=";
            toggleIcon.addEventListener("click", function () {
                const passwordInput = document.getElementById("staticrypt-password");
                if (passwordInput.type === "password") {
                    passwordInput.type = "text";
                    toggleIcon.src = imgSrcEyeOpened;
                    toggleIcon.alt = templateToggleAltHide;
                    toggleIcon.title = templateToggleAltHide;
                } else {
                    passwordInput.type = "password";
                    toggleIcon.src = imgSrcEyeClosed;
                    toggleIcon.alt = templateToggleAltShow;
                    toggleIcon.title = templateToggleAltShow;
                }
            });

            // handle password form submission
            document.getElementById("staticrypt-form").addEventListener("submit", async function (e) {
                e.preventDefault();

                const password = document.getElementById("staticrypt-password").value,
                    isRememberChecked = document.getElementById("staticrypt-remember").checked;

                const { isSuccessful } = await staticrypt.handleDecryptionOfPage(password, isRememberChecked);

                if (!isSuccessful) {
                    alert(templateError);
                }
            });
        </script>
    </body>
</html>
