<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content=""><title>钩子编程</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="钩子编程-C048DFC4"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">钩子编程</h1>


<div class="body conbody"><p class="shortdesc"></p>
<p class="p"></p>
<section class="section"><h2 class="title sectiontitle">概念</h2><p class="p"><strong class="ph b">钩子编程（hooking）</strong>，也称作“挂钩”，是计算机程序设计术语，指通过拦截软件模块间的函数调用、消息传递、事件传递来修改或扩展操作系统、应用程序或其他软件组件的行为的各种技术。处理被拦截的函数调用、事件、消息的代码，被称为钩子（hook）。</p><p class="p">钩子编程有多种用途，如调试、扩展功能。例如在键盘或鼠标事件到达应用程序之前拦截这些事件；拦截应用程序或其他模块的操作系统调用以监督行为、修改功能。也广泛用于benchmarking程序，如度量3D游戏的帧率。</p><p class="p">钩子编程也被用于恶意代码，如rootkit是各种通过假扮系统API调用输出来隐藏自身进程的可见性的工具与技术；游戏外挂是另一类例子。</p></section>
<section class="section"><h2 class="title sectiontitle">方法</h2><ol class="ol">
<li class="li"><p class="p"><strong class="ph b">物理修改</strong></p><p class="p">应用程序执行之前，物理修改可执行程序，这典型通过找到函数调用入口点，修改入口点使之在函数被执行前先执行其他的代码。另一种挂钩的方法是修改可执行程序的输入表（import
table）。还有一种挂钩方法是采用包装库，使得应用程序不需修改即可调用该包装库完成其功能，而在包装库中插入钩子然后再调用原有的库。</p></li>
<li class="li"><p class="p"><strong class="ph b">运行时修改</strong></p><p class="p">操作系统与软件可提供方法，在运行时插入事件钩子。Microsoft Windows允许插入钩子以处理或修改对话框、滚动条、菜单等的系统事件、应用程序事件；插入、删除、处理或修改键盘鼠标事件。Linux允许类似的钩子通过NetFilter以处理网络事件。</p><p class="p">如果没有上述机制或权限，也可拦截进程的库函数调用，在函数调用开始处注入代码。这可通过修改内存中的进程的中断向量表或输入表（import
table）实现。</p></li>
</ol></section>
<section class="section"><h2 class="title sectiontitle">参见</h2><ol class="ol">
<li class="li"><p class="p"><a class="xref" href="https://zh.wikipedia.org/zh-hans/%E9%92%A9%E5%AD%90%E7%BC%96%E7%A8%8B" target="_blank" rel="external noopener">钩子编程- 维基百科</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://www.codeproject.com/Articles/1037/Hooks-and-DLLs" target="_blank" rel="external noopener">Hooks and DLLs - CodeProject</a></p></li>
</ol></section>
</div>
<nav role="navigation" class="related-links"><ul class="ullinks"><li class="link ulchildlink"><strong><a href="%E9%94%AE%E7%9B%98%E9%92%A9%E5%AD%90.html">键盘钩子</a></strong><br></li><li class="link ulchildlink"><strong><a href="%E9%BC%A0%E6%A0%87%E9%92%A9%E5%AD%90.html">鼠标钩子</a></strong><br></li><li class="link ulchildlink"><strong><a href="APIHook%E9%92%A9%E5%AD%90%E6%8B%A6%E6%88%AA.html">API Hook钩子拦截</a></strong><br></li></ul><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91.html">驱动开发</a></div></div></nav></article></main></body></html>