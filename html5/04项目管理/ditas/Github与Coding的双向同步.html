<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="zh-cn"><head><meta charset="UTF-8"><meta name="copyright" content="(C) 版权 2024"><meta name="generator" content="DITA-OT"><meta name="description" content=""><title>Github与Coding的双向同步</title><link rel="stylesheet" type="text/css" href="../../commonltr.css">
<link rel="stylesheet" type="text/css" href="../../common-extended.css"></head><body id="Github与Coding.net的双向同步-A493970A"><main role="main"><article role="article" aria-labelledby="ariaid-title1">
<h1 class="title topictitle1" id="ariaid-title1">Github与Coding的双向同步</h1>


<div class="body conbody"><p class="shortdesc"></p>
<p class="p"></p>
<p class="p">s</p>
<section class="section"><h2 class="title sectiontitle">使用 GitHub Actions 将代码自动同步到 CODING</h2><p class="p">GitHub
Actions 有一个特别好的功能是：有一个 GitHub Marketplace，目前有 7000 多个 Action，开发者可以从中挑选适合自己的
Action。</p><p class="p">开发者也可以定义自己的 Action，也可以将自己的 Action 发布到 GitHub Marketplace。</p><p class="p">这里定制了一个 Action 用于同步代码到 CODING：&nbsp;<a class="xref" href="https://link.zhihu.com/?target=https%3A//www.oschina.net/action/GoToLink%3Furl%3Dhttps%253A%252F%252Fgithub.com%252Fmarketplace%252Factions%252Fsync-repo-to-coding" target="_blank" rel="external noopener"><strong class="ph b">https://github.com/marketplace/actions/sync-repo-to-coding</strong></a></p><p class="p">每个仓库可以配置多个 workflow，在 GitHub 仓库的 .github/workflows
下添加用来定义 workflow 的 YAML 文件即可。</p><p class="p">同步代码到 CODING 的 workflow 的 YAML
文件内容如下：</p><pre class="pre codeblock"><code>name: Sync Repo to CODING
on:
  push:
  schedule:
    # 每天北京时间0点同步
    - cron:  '0 16 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Sync Repo to CODING
      uses: serverlesslife-cn/sync-repo-to-coding@master
      env:
          # 在 GitHub Settings-&gt;Secrets 配置 CODING_PRIVATE_KEY
          SSH_PRIVATE_KEY: ${{ secrets.CODING_PRIVATE_KEY }}
      with:
          # 注意替换为你的 GitHub 源仓库地址git@github.com:dragoncqh/PaaS.Device.Portal.Plugins.git
          github-repo: "git@github.com:dragoncqh/PaaS.Device.Portal.Plugins.git"
          # 注意替换为你的 CODING 目标仓库地址
          coding-repo: "git@e.coding.net:sdjq/paas_hardware/paasplugins.gitt"</code></pre></section>
<section class="section"><h2 class="title sectiontitle">生成新SSH密钥</h2><p class="p">生成新 SSH 密钥</p><p class="p">&nbsp;</p><p class="p">打开
Git Bash。</p><p class="p">&nbsp;</p><p class="p">粘贴下面的文本（替换为您的GitHub 电子邮件地址）。</p><p class="p">ssh-keygen
-t rsa -C "dragoncqh@live.com"</p><p class="p">&nbsp;</p><p class="p">如果使用新的Ed25519 算法：$
ssh-keygen -t ed25519 -C <a class="xref" href="mailto:dragoncqh@live.com" target="_blank" rel="external noopener"><strong class="ph b">dragoncqh@live.com</strong></a>，不能PUSH进CODING</p><p class="p">&nbsp;</p><p class="p">这将创建以所提供的电子邮件地址为标签的新 SSH
密钥。</p><p class="p">&nbsp;</p><p class="p">Generating public/private ed25519 key pair.</p><p class="p">&nbsp;</p><p class="p">提示您“Enter a file in which to save the key（输入要保存密钥的文件）”时，按
Enter 键。 这将接受默认文件位置。</p><p class="p">&nbsp;</p><p class="p">Enter a file in which to save
the key (/c/Users/you/.ssh/id_ed25519):[Press enter]</p><p class="p">&nbsp;</p><p class="p">在提示时输入安全密码。 如不想使用密码可以连按回车两次。 </p><p class="p">实际命令如下：</p><pre class="pre codeblock"><code>Administrator@John-PC MINGW64 ~/.ssh
$ ssh-keygen -t rsa -C "dragoncqh@live.com"
Generating public/private rsa key pair.
Enter file in which to save the key (/c/Users/Administrator/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /c/Users/Administrator/.ssh/id_rsa
Your public key has been saved in /c/Users/Administrator/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:MBSPMFM8Dk3zOSgX0iJpEPQHKY1fWi8Egnqa0h5rvC0 dragoncqh@live.com
The key's randomart image is:
+---[RSA 3072]----+
|==o+B*B.         |
|.o*o+X=B .       |
|..oo*=B.=        |
|. .o.+.+ .       |
| =    . S        |
|+ o              |
|.o o             |
|  E.             |
| ..o.            |
+----[SHA256]-----+

Administrator@John-PC MINGW64 ~/.ssh
$</code></pre></section>
<section class="section"><h2 class="title sectiontitle">TotoriseGit使用SSH_KEY</h2><img class="image" src="../../_images/2021/TotoriseGit%E4%BD%BF%E7%94%A8SSH_KEY_1.png"><img class="image" src="../../_images/2021/TotoriseGit%E4%BD%BF%E7%94%A8SSH_KEY_2.png"></section>
<section class="section"><h2 class="title sectiontitle">GitHub2Coding脚本启用Token认证连结github仓库</h2><p class="p">github仓库开始启用Token认证，用户名密码模式将在2021年8月停止使用，所以要尽快停止使用用户名密码模式=&gt;github仓库开始启用Token认证。</p><pre class="pre codeblock"><code>pipeline {
  agent any
  stages {
    stage('检出 GitHub') {
      steps {
        checkout([
          $class: 'GitSCM',
          branches: [[name: env.GIT_BUILD_REF]], 
          userRemoteConfigs: [[url: env.GIT_REPO_URL, credentialsId: env.CREDENTIALS_ID]]
        ])
      }
    }
    stage('推送到 CODING') {
      steps {
        sh "git push https://${PROJECT_TOKEN_GK}:${PROJECT_TOKEN}@e.coding.net/sdjq/paas_hardware/paasplugins.git HEAD:master"
      }
    }
  }
}</code></pre><p class="p">改为：</p><pre class="pre codeblock"><code>pipeline {
  agent any
  stages {
    stage('检出 GitHub') {
      steps {
        checkout([
          $class: 'GitSCM', 
          branches: [[name: env.GIT_BUILD_REF]], 
          userRemoteConfigs: [[url: 'https://dragoncqh:4a55c870d8c451204c7092d5bc2123e0d108505d@github.com/dragoncqh/PaaS.Device.Portal.Plugins.git']]
        ])
      }
    }
    stage('推送到 CODING') {
      steps {
        sh "git push https://${PROJECT_TOKEN_GK}:${PROJECT_TOKEN}@e.coding.net/sdjq/paas_hardware/paasplugins.git HEAD:master"
      }
    }
  }
}</code></pre></section>
<section class="section"><h2 class="title sectiontitle">参见</h2><ol class="ol">
<li class="li"><p class="p"><a class="xref" href="https://zhuanlan.zhihu.com/p/355400444" target="_blank" rel="external noopener">使用 CODING DevOps 部署 Serverless 应用</a></p></li>
<li class="li"><p class="p"><a class="xref" href="https://blog.csdn.net/wherelse/article/details/107667365" target="_blank" rel="external noopener">使用Coding的构建（持续集成CI）功能实现coding仓库和github的同步</a> </p></li>
<li class="li"><p class="p"></p></li>
<li class="li"><p class="p"></p></li>
<li class="li"><p class="p"></p></li>
</ol></section>
</div>
<nav role="navigation" class="related-links"><div class="familylinks"><div class="parentlink"><strong>父主题：</strong> <a class="link" href="CI%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90.html">持续集成</a></div></div></nav></article></main></body></html>